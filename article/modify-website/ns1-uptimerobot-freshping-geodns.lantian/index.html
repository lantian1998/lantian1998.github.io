<!DOCTYPE html><html lang="zh-CN" itemscope="" itemtype="https://schema.org/Article" data-astro-cid-porej7z2=""> <head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>用 NS1 和 UptimeRobot/Freshping 组建超低价 GeoDNS - Lan Tian @ Blog</title><script>
  ;(() => {
    try {
      const mode = localStorage.getItem('user-color-scheme')
      if (mode == 'dark' || mode == 'light') {
        document.documentElement.setAttribute('data-user-color-scheme', mode)
      }
    } catch {
      // Ignore errors
    }
  })()
</script><link rel="stylesheet" href="/assets/index.CUlf1-Vz.css"><style>#post-navi[data-astro-cid-gfbmwgei]{padding:5px;border-top:1px solid var(--lt-border-weak);border-bottom:1px solid var(--lt-border-weak)}
ol[data-astro-cid-nj3qel45]{margin:0;padding:0;line-height:1.5}ol[data-astro-cid-nj3qel45] .toc-item[data-astro-cid-nj3qel45]{list-style:none}ol[data-astro-cid-nj3qel45] .toc-child[data-astro-cid-nj3qel45],ol[data-astro-cid-nj3qel45] .toc[data-astro-cid-nj3qel45]{padding:0}ol[data-astro-cid-nj3qel45] .toc-link[data-astro-cid-nj3qel45]{display:block;margin-left:1em;padding:.25em 0}ol[data-astro-cid-nj3qel45] .toc-level-1[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-2[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-3[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-4[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-5[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-6[data-astro-cid-nj3qel45]:before{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;width:1em;padding:.25em 0;float:left;font-style:normal;font-variant:normal;font-weight:900;font-family:Font Awesome\ 6 Free;font-feature-settings:normal;text-align:center}ol[data-astro-cid-nj3qel45] .toc-level-1[data-astro-cid-nj3qel45]:before{content:""}ol[data-astro-cid-nj3qel45] .toc-level-2[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-3[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-4[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-5[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-6[data-astro-cid-nj3qel45]:before{content:""}.post-info-wrap[data-astro-cid-dckccua4]{-ms-flex:0 0 2.5em;flex:0 0 2.5em;background-color:var(--lt-component-bg-emphasis)}@media(min-width:768px){.post-info[data-astro-cid-dckccua4]{position:sticky;top:0}}@media(max-width:767.98px){.post-info[data-astro-cid-dckccua4]{position:absolute}}
</style><script type="module" src="/assets/PageLayout.astro_astro_type_script_index_0_lang.C1wfUPs6.js"></script><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta http-equiv="Referrer-Policy" content="no-referrer, strict-origin-when-cross-origin"><meta name="renderer" content="webkit|ie-comp|ie-stand"><meta name="imagemode" content="force"><meta name="nightmode" content="disable"><meta name="wap-font-scale" content="no"><meta name="title" content="用 NS1 和 UptimeRobot/Freshping 组建超低价 GeoDNS - Lan Tian @ Blog"><meta name="keywords" content=""><meta name="author" content="Lan Tian"><link rel="canonical" href="https://lantian.pub/article/modify-website/ns1-uptimerobot-freshping-geodns.lantian/"><link rel="alternate" type="application/rss+xml" title="Lan Tian @ Blog" href="https://lantian.pub/rss2.xml"><link rel="alternate" type="application/atom+xml" title="Lan Tian @ Blog" href="https://lantian.pub/feed.xml"><link rel="alternate" href="https://lantian.pub/article/modify-website/ns1-uptimerobot-freshping-geodns.lantian/" hreflang="zh"><link rel="alternate" href="https://lantian.pub/en/article/modify-website/ns1-uptimerobot-freshping-geodns.lantian/" hreflang="en"><meta name="copyright" content="Copyright 2012-2025 Lan Tian @ Blog"><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="48x48" href="/favicon-48x48.png"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="manifest" href="/manifest.webmanifest"><meta name="mobile-web-app-capable" content="yes"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#03a9f4"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#212121"><meta name="application-name" content="Lan Tian @ Blog"><link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="167x167" href="/apple-touch-icon-167x167.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png"><link rel="apple-touch-icon" sizes="1024x1024" href="/apple-touch-icon-1024x1024.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-precomposed.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#03a9f4"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-title" content="Lan Tian @ Blog"><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-640x1136.png"><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-1136x640.png"><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-750x1334.png"><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-1334x750.png"><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1125x2436.png"><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2436x1125.png"><link rel="apple-touch-startup-image" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1170x2532.png"><link rel="apple-touch-startup-image" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2532x1170.png"><link rel="apple-touch-startup-image" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1179x2556.png"><link rel="apple-touch-startup-image" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2556x1179.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-828x1792.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-1792x828.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1242x2688.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2688x1242.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1242x2208.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2208x1242.png"><link rel="apple-touch-startup-image" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1284x2778.png"><link rel="apple-touch-startup-image" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2778x1284.png"><link rel="apple-touch-startup-image" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1290x2796.png"><link rel="apple-touch-startup-image" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2796x1290.png"><link rel="apple-touch-startup-image" media="(device-width: 744px) and (device-height: 1133px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1488x2266.png"><link rel="apple-touch-startup-image" media="(device-width: 744px) and (device-height: 1133px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2266x1488.png"><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1536x2048.png"><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2048x1536.png"><link rel="apple-touch-startup-image" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1620x2160.png"><link rel="apple-touch-startup-image" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2160x1620.png"><link rel="apple-touch-startup-image" media="(device-width: 820px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1640x2160.png"><link rel="apple-touch-startup-image" media="(device-width: 820px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2160x1640.png"><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1668x2388.png"><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2388x1668.png"><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1668x2224.png"><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2224x1668.png"><link rel="apple-touch-startup-image" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-2048x2732.png"><link rel="apple-touch-startup-image" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2732x2048.png"><meta name="msapplication-TileColor" content="#bbdefb"><meta name="msapplication-TileImage" content="/mstile-144x144.png"><meta name="msapplication-config" content="/browserconfig.xml"><link rel="yandex-tableau-widget" href="/yandex-browser-manifest.json"><meta property="og:url" content="https://lantian.pub/article/modify-website/ns1-uptimerobot-freshping-geodns.lantian/"><meta property="og:type" content="website"><meta property="og:title" content="用 NS1 和 UptimeRobot/Freshping 组建超低价 GeoDNS - Lan Tian @ Blog"><meta property="og:image" content="https://lantian.pub/apple-touch-icon.png"><meta content="本文部分内容参考自 https://hostedtalk.net/t/connecting-uptime-robot-with-ns1-dns-api/3883 。 目标 我的 VPS 多且遍布世界各地，但一直以来，我的网站都只用了美国洛杉矶的一台 VPS 提供服务。因为我为了特殊线路、低价等原因购买的都是小服务商的 VPS，而非 DigitalOcean、Vultr 甚至 AWS、Azure 等大厂，这台美国洛杉矶的 VPS 网络有时会不稳定，虽然次数很少，但每次我都得手动临时切换 DNS 到其它 VPS 上，等网络恢复后再切换回来。因此，我希望可以把手头所有的 VPS 都用来提供网站服务，在某台 VPS 宕机时，用 DNS 将流量自动切到其它 VPS 上。 由于我的网站使用 Hexo 静态网页生成系统，同步网站数据并无难度：只需要在一台 VPS 上生成文件，再用 Ansible 批量同步到所有 VPS 上即可。但更大的问题是 DNS 的配置。我希望用 GeoDNS 把用户导流到最近的 VPS 上，例如亚洲用户可以访问我的中国香港节点，美国用户可以访问我的美国洛杉矶节点，等等。..."><meta property="og:site_name" content="Lan Tian @ Blog"><meta property="og:locale" content="zh"><meta name="twitter:card" content="summary"><meta name="twitter:url" content="https://lantian.pub/article/modify-website/ns1-uptimerobot-freshping-geodns.lantian/"><meta name="twitter:title" content="用 NS1 和 UptimeRobot/Freshping 组建超低价 GeoDNS - Lan Tian @ Blog"><meta property="twitter:image" content="https://lantian.pub/apple-touch-icon.png"><meta content="本文部分内容参考自 https://hostedtalk.net/t/connecting-uptime-robot-with-ns1-dns-api/3883 。 目标 我的 VPS 多且遍布世界各地，但一直以来，我的网站都只用了美国洛杉矶的一台 VPS 提供服务。因为我为了特殊线路、低价等原因购买的都是小服务商的 VPS，而非 DigitalOcean、Vultr 甚至 AWS、Azure 等大厂，这台美国洛杉矶的 VPS 网络有时会不稳定，虽然次数很少，但每次我都得手动临时切换 DNS 到其它 VPS 上，等网络恢复后再切换回来。因此，我希望可以把手头所有的 VPS 都用来提供网站服务，在某台 VPS 宕机时，用 DNS 将流量自动切到其它 VPS 上。 由于我的网站使用 Hexo 静态网页生成系统，同步网站数据并无难度：只需要在一台 VPS 上生成文件，再用 Ansible 批量同步到所有 VPS 上即可。但更大的问题是 DNS 的配置。我希望用 GeoDNS 把用户导流到最近的 VPS 上，例如亚洲用户可以访问我的中国香港节点，美国用户可以访问我的美国洛杉矶节点，等等。..."><meta name="twitter:dnt" content="on"><meta itemprop="name" content="用 NS1 和 UptimeRobot/Freshping 组建超低价 GeoDNS - Lan Tian @ Blog"><meta property="image" content="https://lantian.pub/apple-touch-icon.png"><meta content="本文部分内容参考自 https://hostedtalk.net/t/connecting-uptime-robot-with-ns1-dns-api/3883 。 目标 我的 VPS 多且遍布世界各地，但一直以来，我的网站都只用了美国洛杉矶的一台 VPS 提供服务。因为我为了特殊线路、低价等原因购买的都是小服务商的 VPS，而非 DigitalOcean、Vultr 甚至 AWS、Azure 等大厂，这台美国洛杉矶的 VPS 网络有时会不稳定，虽然次数很少，但每次我都得手动临时切换 DNS 到其它 VPS 上，等网络恢复后再切换回来。因此，我希望可以把手头所有的 VPS 都用来提供网站服务，在某台 VPS 宕机时，用 DNS 将流量自动切到其它 VPS 上。 由于我的网站使用 Hexo 静态网页生成系统，同步网站数据并无难度：只需要在一台 VPS 上生成文件，再用 Ansible 批量同步到所有 VPS 上即可。但更大的问题是 DNS 的配置。我希望用 GeoDNS 把用户导流到最近的 VPS 上，例如亚洲用户可以访问我的中国香港节点，美国用户可以访问我的美国洛杉矶节点，等等。..."><meta content="本文部分内容参考自 https://hostedtalk.net/t/connecting-uptime-robot-with-ns1-dns-api/3883 。 目标 我的 VPS 多且遍布世界各地，但一直以来，我的网站都只用了美国洛杉矶的一台 VPS 提供服务。因为我为了特殊线路、低价等原因购买的都是小服务商的 VPS，而非 DigitalOcean、Vultr 甚至 AWS、Azure 等大厂，这台美国洛杉矶的 VPS 网络有时会不稳定，虽然次数很少，但每次我都得手动临时切换 DNS 到其它 VPS 上，等网络恢复后再切换回来。因此，我希望可以把手头所有的 VPS 都用来提供网站服务，在某台 VPS 宕机时，用 DNS 将流量自动切到其它 VPS 上。 由于我的网站使用 Hexo 静态网页生成系统，同步网站数据并无难度：只需要在一台 VPS 上生成文件，再用 Ansible 批量同步到所有 VPS 上即可。但更大的问题是 DNS 的配置。我希望用 GeoDNS 把用户导流到最近的 VPS 上，例如亚洲用户可以访问我的中国香港节点，美国用户可以访问我的美国洛杉矶节点，等等。..."><link rel="me" href="https://mastodon.social/@lantian"></head> <body data-astro-cid-porej7z2=""> <div id="bg" data-astro-cid-j6vmxtef=""></div>   <div id="container" class="container" data-astro-cid-porej7z2=""> <nav class="lantian navbar navbar-expand-lg" data-astro-cid-wu5dj4rx=""> <div class="container-fluid" data-astro-cid-wu5dj4rx=""> <a class="navbar-brand" href="/" data-astro-cid-wu5dj4rx="">Lan Tian @ Blog</a> <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#lantian-navbar" aria-controls="lantian-navbar" aria-expanded="false" aria-label="Toggle navigation" data-astro-cid-wu5dj4rx=""> <span class="navbar-toggler-icon" data-astro-cid-wu5dj4rx=""></span> </button> <div class="collapse navbar-collapse" id="lantian-navbar" data-astro-cid-wu5dj4rx=""> <ul class="navbar-nav" data-astro-cid-wu5dj4rx=""> <li class="nav-item d-none d-lg-block" data-astro-cid-wu5dj4rx=""> <a class="nav-link" href="/page/archive/index.html" data-astro-cid-wu5dj4rx=""> 文章们 </a> </li><li class="nav-item d-none d-lg-block" data-astro-cid-wu5dj4rx=""> <a class="nav-link" href="/page/himawari/index.html" data-astro-cid-wu5dj4rx=""> 俯瞰地球 </a> </li><li class="nav-item d-none d-lg-block" data-astro-cid-wu5dj4rx=""> <a class="nav-link" href="/page/dn42/index.html" data-astro-cid-wu5dj4rx=""> DN42 </a> </li> <li class="nav-item dropdown d-block d-lg-none" data-astro-cid-wu5dj4rx=""> <a href="#" class="nav-link dropdown-toggle" id="pages-dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" data-astro-cid-wu5dj4rx=""> <i class="fas fa-fw fa-file" data-astro-cid-wu5dj4rx=""></i> 页面  <span class="caret" data-astro-cid-wu5dj4rx=""></span> </a> <ul class="dropdown-menu" aria-labelledby="pages-dropdown" data-astro-cid-wu5dj4rx=""> <li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item" href="/page/archive/index.html" data-astro-cid-wu5dj4rx=""> 文章们 </a> </li><li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item" href="/page/himawari/index.html" data-astro-cid-wu5dj4rx=""> 俯瞰地球 </a> </li><li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item" href="/page/dn42/index.html" data-astro-cid-wu5dj4rx=""> DN42 </a> </li> </ul> </li> </ul> <ul class="navbar-nav ms-auto" data-astro-cid-wu5dj4rx=""> <li class="nav-item dropdown" data-astro-cid-wu5dj4rx=""> <a href="#" class="nav-link dropdown-toggle" id="languages-dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" data-astro-cid-wu5dj4rx=""> <i class="fas fa-fw fa-language" data-astro-cid-wu5dj4rx=""></i> Language <span class="caret" data-astro-cid-wu5dj4rx=""></span> </a> <ul class="dropdown-menu" aria-labelledby="languages-dropdown" data-astro-cid-wu5dj4rx=""> <li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item active" href="/article/modify-website/ns1-uptimerobot-freshping-geodns.lantian/" data-astro-cid-wu5dj4rx=""> <span class="flag-icon flag-icon-cn" data-astro-cid-wu5dj4rx=""></span> Chinese Simplified / 简体中文 </a> </li><li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item" href="/en/article/modify-website/ns1-uptimerobot-freshping-geodns.lantian/" data-astro-cid-wu5dj4rx=""> <span class="flag-icon flag-icon-us" data-astro-cid-wu5dj4rx=""></span> English </a> </li> <li data-astro-cid-wu5dj4rx=""><hr class="dropdown-divider" data-astro-cid-wu5dj4rx=""></li> <li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item disabled" href="#" data-astro-cid-wu5dj4rx="">Not all pages have translations.</a> </li> <li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item disabled" href="#" data-astro-cid-wu5dj4rx="">You may see 404 - this is normal.</a> </li> </ul> </li> <li class="nav-item dropdown" data-astro-cid-wu5dj4rx=""> <a href="#" class="nav-link dropdown-toggle" id="color-scheme-dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" data-astro-cid-wu5dj4rx=""> <i class="fas fa-fw fa-adjust" data-astro-cid-wu5dj4rx=""></i> 夜间模式 </a> <ul class="dropdown-menu" aria-labelledby="color-scheme-dropdown" data-astro-cid-wu5dj4rx=""> <li data-astro-cid-wu5dj4rx=""> <a id="color-scheme-auto" class="dropdown-item" href="#" data-astro-cid-wu5dj4rx=""><i class="fas fa-fw fa-adjust" data-astro-cid-wu5dj4rx=""></i> 自动 </a> </li> <li data-astro-cid-wu5dj4rx=""><hr class="dropdown-divider" data-astro-cid-wu5dj4rx=""></li> <li data-astro-cid-wu5dj4rx=""> <a id="color-scheme-light" class="dropdown-item" href="#" data-astro-cid-wu5dj4rx=""><i class="fas fa-fw fa-sun" data-astro-cid-wu5dj4rx=""></i> 浅色</a> </li> <li data-astro-cid-wu5dj4rx=""> <a id="color-scheme-dark" class="dropdown-item" href="#" data-astro-cid-wu5dj4rx=""><i class="fas fa-fw fa-moon" data-astro-cid-wu5dj4rx=""></i> 深色</a> </li> </ul> </li> </ul> </div> </div> </nav> <script type="module">const m="user-color-scheme",s="data-user-color-scheme",u=(e,t)=>{try{localStorage.setItem(e,t)}catch{}},i=e=>{try{return localStorage.getItem(e)}catch{return null}},c=e=>{const t={dark:!0,light:!0,auto:!0},o=e===null||!Object.keys(t).includes(e)?"auto":e;u(m,o);for(const l in t){const n=document.getElementById("color-scheme-"+l);n&&(l==o?n.classList.add("active"):n.classList.remove("active"))}o!="auto"?document.documentElement.setAttribute(s,o):document.documentElement.removeAttribute(s)};c(i(m));const r=document.getElementById("color-scheme-auto");r&&r.addEventListener("click",()=>c("auto"));const a=document.getElementById("color-scheme-light");a&&a.addEventListener("click",()=>c("light"));const d=document.getElementById("color-scheme-dark");d&&d.addEventListener("click",()=>c("dark"));</script>  <div class="d-flex" data-astro-cid-porej7z2=""> <div id="content" data-astro-cid-porej7z2="">  <article> <div class="d-flex"> <div class="post-info-wrap" data-astro-cid-dckccua4=""> <div class="post-info" data-astro-cid-dckccua4=""> <div class="post-meta-wrap"> <div class="post-meta"> <p> <span class="fas fa-clock"></span> <br> <small>02-06</small> </p> <div class="post-meta-value"> 发布于<span class="badge badge-tag" data-astro-cid-dckccua4=""> 2022-02-06 14:29 </span>  </div> </div> </div> <div class="post-meta-wrap"> <div class="post-meta"> <p> <span class="fas fa-file-alt"></span> <br> <small>网站与服务端</small> </p> <div class="post-meta-value"> 分类 <a class="badge badge-tag" href="/category/modify-website" data-astro-cid-dckccua4=""> 网站与服务端 </a>  </div> </div> </div> <div class="post-meta-wrap"> <div class="post-meta"> <p> <span class="fas fa-tag"></span> <br> <small>4 标签</small> </p> <div class="post-meta-value"> 标签  <a class="badge badge-tag" href="/tag/NS1" data-astro-cid-dckccua4=""> NS1 </a>  <a class="badge badge-tag" href="/tag/UptimeRobot" data-astro-cid-dckccua4=""> UptimeRobot </a>  <a class="badge badge-tag" href="/tag/Freshping" data-astro-cid-dckccua4=""> Freshping </a>  <a class="badge badge-tag" href="/tag/GeoDNS" data-astro-cid-dckccua4=""> GeoDNS </a>  </div> </div> </div> <div class="post-meta-wrap"> <div class="post-meta"> <p> <span class="fas fa-list"></span> <br> <small>目录</small> </p> <div class="post-meta-value">  <ol data-astro-cid-nj3qel45=""> <li class="toc-item toc-level-1" data-astro-cid-nj3qel45=""> <a class="toc-link" href="#目标" data-astro-cid-nj3qel45=""> <span class="toc-text" data-astro-cid-nj3qel45="">目标</span> </a> </li><li class="toc-item toc-level-2" data-astro-cid-nj3qel45=""> <a class="toc-link" href="#为什么不自建" data-astro-cid-nj3qel45=""> <span class="toc-text" data-astro-cid-nj3qel45="">为什么不自建</span> </a> </li><li class="toc-item toc-level-1" data-astro-cid-nj3qel45=""> <a class="toc-link" href="#准备工作" data-astro-cid-nj3qel45=""> <span class="toc-text" data-astro-cid-nj3qel45="">准备工作</span> </a> </li><li class="toc-item toc-level-2" data-astro-cid-nj3qel45=""> <a class="toc-link" href="#为什么要用-aws-lambda-和-aws-sns" data-astro-cid-nj3qel45=""> <span class="toc-text" data-astro-cid-nj3qel45="">为什么要用 AWS Lambda 和 AWS SNS</span> </a> </li><li class="toc-item toc-level-1" data-astro-cid-nj3qel45=""> <a class="toc-link" href="#ns1-对接-aws-sns" data-astro-cid-nj3qel45=""> <span class="toc-text" data-astro-cid-nj3qel45="">NS1 对接 AWS SNS</span> </a> </li><li class="toc-item toc-level-1" data-astro-cid-nj3qel45=""> <a class="toc-link" href="#aws-创建-lambda-函数处理-webhook" data-astro-cid-nj3qel45=""> <span class="toc-text" data-astro-cid-nj3qel45="">AWS 创建 Lambda 函数处理 Webhook</span> </a> </li><li class="toc-item toc-level-1" data-astro-cid-nj3qel45=""> <a class="toc-link" href="#aws-创建-api-gateway-接受-http-请求" data-astro-cid-nj3qel45=""> <span class="toc-text" data-astro-cid-nj3qel45="">AWS 创建 API Gateway 接受 HTTP 请求</span> </a> </li><li class="toc-item toc-level-1" data-astro-cid-nj3qel45=""> <a class="toc-link" href="#uptimerobotfreshping-接入-webhook" data-astro-cid-nj3qel45=""> <span class="toc-text" data-astro-cid-nj3qel45="">UptimeRobot/Freshping 接入 Webhook</span> </a> </li><li class="toc-item toc-level-1" data-astro-cid-nj3qel45=""> <a class="toc-link" href="#ns1-配置-geodns-和自动切换" data-astro-cid-nj3qel45=""> <span class="toc-text" data-astro-cid-nj3qel45="">NS1 配置 GeoDNS 和自动切换</span> </a> </li> </ol>   </div> </div> </div> </div>  </div>  <div class="post-wrap">  <h1 class="post-title"> <a href="/article/modify-website/ns1-uptimerobot-freshping-geodns.lantian/" rel="bookmark" title="用 NS1 和 UptimeRobot/Freshping 组建超低价 GeoDNS">用 NS1 和 UptimeRobot/Freshping 组建超低价 GeoDNS</a> </h1> <div class="post-text">   <blockquote>
<p>本文部分内容参考自
<a href="https://hostedtalk.net/t/connecting-uptime-robot-with-ns1-dns-api/3883" rel="noopener noreferrer" target="_blank">https://hostedtalk.net/t/connecting-uptime-robot-with-ns1-dns-api/3883</a>。</p>
</blockquote>
<h1 id="目标">目标</h1>
<p>我的 VPS 多且遍布世界各地，但一直以来，我的网站都只用了美国洛杉矶的一台 VPS 提供服务。因为我为了特殊线路、低价等原因购买的都是小服务商的 VPS，而非
DigitalOcean、Vultr 甚至 AWS、Azure 等大厂，这台美国洛杉矶的 VPS 网络有时会不稳定，虽然次数很少，但每次我都得手动临时切换 DNS 到其它 VPS 上，等网络恢复后再切换回来。因此，我希望可以把手头所有的 VPS 都用来提供网站服务，在某台 VPS 宕机时，用
DNS 将流量自动切到其它 VPS 上。</p>
<p>由于我的网站使用 Hexo 静态网页生成系统，同步网站数据并无难度：只需要在一台 VPS
上生成文件，再用 Ansible 批量同步到所有 VPS 上即可。但更大的问题是 DNS 的配置。我希望用 GeoDNS 把用户导流到最近的 VPS 上，例如亚洲用户可以访问我的中国香港节点，美国用户可以访问我的美国洛杉矶节点，等等。</p>
<p>但是市面上的 GeoDNS 服务价格都有些昂贵，当只使用一个域名时：</p>
<ul>
<li><a href="https://www.cloudns.net/geodns/" rel="noopener noreferrer" target="_blank">CloudNS 每月的价格是 $9.95</a>；</li>
<li><a href="https://constellix.com/pricing/products" rel="noopener noreferrer" target="_blank">Constellix 每月的价格是 $10</a>；</li>
<li><a href="https://aws.amazon.com/route53/pricing/" rel="noopener noreferrer" target="_blank">AWS Route 53 每月的价格是 $0.5，外加每百万次查询 $0.7，和每个节点的监控 $0.75</a>；</li>
<li><a href="https://perfops.net/pricing" rel="noopener noreferrer" target="_blank">PerfOps 提供一个开启了 GeoDNS 的子域名用于 CNAME，10 万次查询以内是免费的，但每个节点的监控要 $5</a>。</li>
<li>Cloudflare Load Balancing 每月的价格是 $15（两个后端，开启 Traffic
Steering），之后每多一个节点再加 $5。</li>
</ul>
<p>好在 <a href="https://ns1.com/plans" rel="noopener noreferrer" target="_blank">NS1 提供支持 GeoDNS 的免费服务</a>。虽然 NS1 免费版只能监控一个节点，但它支持用 API 接口或者 <a href="https://aws.amazon.com/sns/" rel="noopener noreferrer" target="_blank">AWS SNS</a>
设置节点健康状态，从而达到自动切换节点的效果。</p>
<h2 id="为什么不自建">为什么不自建</h2>
<p>我以前试过<a href="https://lantian.pub/article/modify-website/powerdns-lua-diy-geodns.lantian/" rel="noopener noreferrer" target="_blank">用 PowerDNS 自建权威 DNS 来实现 GeoDNS</a>，但是效果并不好。最主要的原因是，各地的递归 DNS 不会自动选择最近的权威 DNS 进行解析，而是从域名的 DNS 列表中随机选择一个；如果某个递归 DNS 选到了地球另一边的权威
DNS，甚至选到了一个暂时宕机的节点，DNS 解析就会很慢甚至失败，反而影响网站打开速度。</p>
<p>商业 DNS 大都使用 Anycast 解决这个问题，也就是在多个数据中心发布同一个 IP 地址，递归 DNS 的请求会被路径上的路由器自动导向最近的数据中心。但是发布 IP 地址的前提是，你要有一个 ASN（一次性价格 $50-100），还要有一段 IPv4 地址（每月价格约
$100），性价比甚至不如直接购买商业 DNS。</p>
<h1 id="准备工作">准备工作</h1>
<p>你需要准备好：</p>
<ol>
<li>一个绑定信用卡的 AWS 帐号，每月可能需要支付几美分费用。我们需要使用：
<ul>
<li><a href="https://aws.amazon.com/lambda/pricing/" rel="noopener noreferrer" target="_blank">Lambda 函数计算功能</a>（每月前 100
万次请求免费）；</li>
<li><a href="https://aws.amazon.com/api-gateway/pricing/" rel="noopener noreferrer" target="_blank">API 网关</a>（用于将 Lambda 函数暴露到公网，前 12 个月每月 100 万次请求免费，随后每百万次请求 $1.17）；</li>
<li><a href="https://aws.amazon.com/sns/pricing/" rel="noopener noreferrer" target="_blank">SNS 消息服务</a>（用于将宕机、恢复消息发给 NS1，每月前 100 万次请求免费）。</li>
</ul>
</li>
<li>一个 <a href="https://ns1.com/signup" rel="noopener noreferrer" target="_blank">NS1 帐号</a>，需要验证信用卡，但不需要收费。</li>
<li>一个 DNS 记录数量低于 50 的域名，绑定到 NS1 上。NS1 免费版限制域名上只能有 50
条 DNS 记录。
<ul>
<li>你可以注册一个 6-9 位数的 xyz 域名专门用于
NS1，<a href="https://gen.xyz/1111b" rel="noopener noreferrer" target="_blank">每年价格仅需 $0.99</a>，然后把主域名 CNAME 过去。</li>
</ul>
</li>
<li>在你的主 DNS 上，给每个后端节点添加一个单独的 A/AAAA 记录，例如
<code>hostdare.lantian.pub -> 185.186.147.110</code>，后面将会把 CNAME 和监控都指向这里。</li>
<li>一个 UptimeRobot 或 Freshping 帐号，配置好所有节点的监控。
<ul>
<li>后端地址请使用第 4 步配置好的域名。以
<code>hostdare.lantian.pub -> 185.186.147.110</code> 为例，监控地址请使用
<code>https://hostdare.lantian.pub</code>，而非 <code>185.186.147.110</code> 等 IP 地址。</li>
<li>UptimeRobot 的最小监控间隔是 5 分钟。Freshping 的最小监控间隔是 1 分钟，但不支持 IPv6。你可以自行取舍。</li>
</ul>
</li>
</ol>
<p>一般来说宕机通知的条数都很少，因此你在 AWS 的消费很可能低于每月 1 美分，几乎完全免费。</p>
<p>所有消息的流向是：</p>
<p><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--><!-- Generated by graphviz version 14.0.2 (0)
 --><!-- Pages: 1 -->
<svg width="195pt" height="310pt" viewBox="0.00 0.00 195.00 310.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 306.4)">
<polygon fill="white" stroke="none" points="-4,4 -4,-306.4 191.06,-306.4 191.06,4 -4,4"></polygon><!-- UptimeRobot -->
<g id="node1" class="node">
<title>UptimeRobot</title>
<polygon fill="none" stroke="black" points="92.22,-302.4 0,-302.4 0,-266.4 92.22,-266.4 92.22,-302.4"></polygon>
<text xml:space="preserve" text-anchor="middle" x="46.11" y="-280.2" font-family="Times,serif" font-size="14.00">UptimeRobot</text>
</g><!-- AWS Lambda -->
<g id="node2" class="node">
<title>AWS Lambda</title>
<polygon fill="none" stroke="black" points="144.35,-213.6 47.87,-213.6 47.87,-177.6 144.35,-177.6 144.35,-213.6"></polygon>
<text xml:space="preserve" text-anchor="middle" x="96.11" y="-191.4" font-family="Times,serif" font-size="14.00">AWS Lambda</text>
</g><!-- UptimeRobot&#45;&gt;AWS Lambda -->
<g id="edge1" class="edge">
<title>UptimeRobot->AWS Lambda</title>
<path fill="none" stroke="black" d="M52.85,-266.13C57.14,-255.82 63.11,-242.64 69.68,-231.6 71.36,-228.78 73.23,-225.91 75.16,-223.1"></path>
<polygon fill="black" stroke="black" points="77.93,-225.25 80.99,-215.1 72.27,-221.12 77.93,-225.25"></polygon>
<text xml:space="preserve" text-anchor="middle" x="96.9" y="-235.8" font-family="Times,serif" font-size="14.00">Webhook</text>
</g><!-- AWS SNS -->
<g id="node4" class="node">
<title>AWS SNS</title>
<polygon fill="none" stroke="black" points="134.26,-124.8 57.96,-124.8 57.96,-88.8 134.26,-88.8 134.26,-124.8"></polygon>
<text xml:space="preserve" text-anchor="middle" x="96.11" y="-102.6" font-family="Times,serif" font-size="14.00">AWS SNS</text>
</g><!-- AWS Lambda&#45;&gt;AWS SNS -->
<g id="edge3" class="edge">
<title>AWS Lambda->AWS SNS</title>
<path fill="none" stroke="black" d="M96.11,-177.45C96.11,-165.76 96.11,-149.99 96.11,-136.42"></path>
<polygon fill="black" stroke="black" points="99.61,-136.72 96.11,-126.72 92.61,-136.72 99.61,-136.72"></polygon>
<text xml:space="preserve" text-anchor="middle" x="117.11" y="-147" font-family="Times,serif" font-size="14.00">内部接口</text>
</g><!-- Freshping -->
<g id="node3" class="node">
<title>Freshping</title>
<polygon fill="none" stroke="black" points="182.11,-302.4 110.11,-302.4 110.11,-266.4 182.11,-266.4 182.11,-302.4"></polygon>
<text xml:space="preserve" text-anchor="middle" x="146.11" y="-280.2" font-family="Times,serif" font-size="14.00">Freshping</text>
</g><!-- Freshping&#45;&gt;AWS Lambda -->
<g id="edge2" class="edge">
<title>Freshping->AWS Lambda</title>
<path fill="none" stroke="black" d="M140.1,-266.03C136.19,-255.69 130.62,-242.51 124.11,-231.6 122.43,-228.78 120.54,-225.94 118.56,-223.16"></path>
<polygon fill="black" stroke="black" points="121.4,-221.11 112.55,-215.28 115.83,-225.36 121.4,-221.11"></polygon>
<text xml:space="preserve" text-anchor="middle" x="159.85" y="-235.8" font-family="Times,serif" font-size="14.00">Webhook</text>
</g><!-- NS1 API -->
<g id="node5" class="node">
<title>NS1 API</title>
<polygon fill="none" stroke="black" points="129.59,-36 62.63,-36 62.63,0 129.59,0 129.59,-36"></polygon>
<text xml:space="preserve" text-anchor="middle" x="96.11" y="-13.8" font-family="Times,serif" font-size="14.00">NS1 API</text>
</g><!-- AWS SNS&#45;&gt;NS1 API -->
<g id="edge4" class="edge">
<title>AWS SNS->NS1 API</title>
<path fill="none" stroke="black" d="M96.11,-88.65C96.11,-76.96 96.11,-61.19 96.11,-47.62"></path>
<polygon fill="black" stroke="black" points="99.61,-47.92 96.11,-37.92 92.61,-47.92 99.61,-47.92"></polygon>
<text xml:space="preserve" text-anchor="middle" x="123.32" y="-58.2" font-family="Times,serif" font-size="14.00">Webhook</text>
</g>
</g>
</svg>
</p>
<h2 id="为什么要用-aws-lambda-和-aws-sns">为什么要用 AWS Lambda 和 AWS SNS</h2>
<p>因为 NS1 的 Webhook 接口不太稳定，而 AWS SNS 支持自动重试。</p>
<p>在最初测试时我用的是 Cloudflare Workers，但是 NS1 的 API 接口频繁返回 Bad
Request 错误，而且短时间内重试无法解决该问题。因为 Cloudflare Workers 只能由请求触发，而且有执行时间限制，它无法在后台每过几秒重试一次。</p>
<p>但是 AWS SNS 可以做到接口不稳定时自动重试，而 AWS Lambda 可以方便地向 SNS 发送消息，因此我最后选择了 AWS 的服务组合。</p>
<h1 id="ns1-对接-aws-sns">NS1 对接 AWS SNS</h1>
<ol>
<li>
<p>进入 <a href="https://my.nsone.net/#/integrations" rel="noopener noreferrer" target="_blank">NS1 后台的 Integrations 页面</a>，点击 <code>Add a Data Source</code> 添加数据源，选择 AWS CloudWatch，名称任意。</p>
<ul>
<li>我们并不会用到 AWS CloudWatch 服务，只是我们会将宕机信息以 CloudWatch 的格式发给 NS1。</li>
</ul>
</li>
<li>
<p>切换到 Incoming Feeds 标签，点击 CloudWatch 图标添加一个数据订阅（Feed），其中 <code>Alarm Name</code> 需要与 UptimeRobot/Freshping 上配置好的域名一致。<code>Name (for internal reference)</code> 可以随意填写，我配置成和 <code>Alarm Name</code> 保持一致。</p>
<ul>
<li>以 <code>hostdare.lantian.pub -> 185.186.147.110</code> 为例，<code>Alarm Name</code> 需要填写为
<code>hostdare.lantian.pub</code>。</li>
</ul>
<p><picture><source srcset="/usr/uploads/202202/ns1-alarm.png.webp" type="image/webp"><source srcset="/usr/uploads/202202/ns1-alarm.png.avif" type="image/avif"><source srcset="/usr/uploads/202202/ns1-alarm.png.jxl" type="image/jxl"><img src="/usr/uploads/202202/ns1-alarm.png" alt="NS1 添加订阅"></picture></p>
</li>
<li>
<p>重复第二步，添加所有节点的订阅。</p>
</li>
<li>
<p>此时 Incoming Feeds 标签会显示 CloudWatch 订阅的链接（<code>Feeds URL</code>），记下这个链接，稍后将会将它添加到 AWS SNS 中。</p>
<p><picture><source srcset="/usr/uploads/202202/ns1-feed.png.webp" type="image/webp"><source srcset="/usr/uploads/202202/ns1-feed.png.avif" type="image/avif"><source srcset="/usr/uploads/202202/ns1-feed.png.jxl" type="image/jxl"><img src="/usr/uploads/202202/ns1-feed.png" alt="NS1 订阅链接"></picture></p>
</li>
<li>
<p>进入
<a href="https://us-west-1.console.aws.amazon.com/sns/v3/home?region=us-west-1#/topics" rel="noopener noreferrer" target="_blank">AWS SNS 管理页面</a>，新建一个 Topic（消息队列），类型选择 Standard，其余选项均保持默认。</p>
<ul>
<li>注意我的 AWS 链接都是 us-west-1 区的，如果你想新建在其它区域请自行切换！AWS
上的 SNS 和稍后创建的 Lambda 函数必须在同一个区！</li>
</ul>
<p><picture><source srcset="/usr/uploads/202202/aws-create-topic.png.webp" type="image/webp"><source srcset="/usr/uploads/202202/aws-create-topic.png.avif" type="image/avif"><source srcset="/usr/uploads/202202/aws-create-topic.png.jxl" type="image/jxl"><img src="/usr/uploads/202202/aws-create-topic.png" alt="AWS 创建 Topic"></picture></p>
</li>
<li>
<p>Topic 的页面上会显示一个 ARN（资源 ID），将其记录下来，稍后创建函数时会用到。</p>
</li>
<li>
<p>点击页面下方的 <code>Create subscription</code> 按钮创建数据订阅，Protocol（协议）选择
HTTPS，Endpoint（地址）输入第 4 步的订阅链接，其余选项保持默认。</p>
<p><picture><source srcset="/usr/uploads/202202/aws-create-subscription.png.webp" type="image/webp"><source srcset="/usr/uploads/202202/aws-create-subscription.png.avif" type="image/avif"><source srcset="/usr/uploads/202202/aws-create-subscription.png.jxl" type="image/jxl"><img src="/usr/uploads/202202/aws-create-subscription.png" alt="AWS 创建订阅"></picture></p>
</li>
</ol>
<p>此时发送到 AWS SNS 的这个 Topic 的消息，都会被转发到 NS1 的 API，从而将节点状态同步到 NS1。</p>
<h1 id="aws-创建-lambda-函数处理-webhook">AWS 创建 Lambda 函数处理 Webhook</h1>
<p>下一步是通过 AWS Lambda 创建一个函数，将 UptimeRobot 或者 Freshping 的 Webhook
消息转换成 AWS SNS 的消息。</p>
<ol>
<li>
<p>进入
<a href="https://us-west-1.console.aws.amazon.com/lambda/home?region=us-west-1#/functions" rel="noopener noreferrer" target="_blank">AWS Lambda 管理页面</a>，创建一个函数。</p>
<ul>
<li>注意我的 AWS 链接都是 us-west-1 区的，如果你想新建在其它区域请自行切换！AWS
上的 SNS 和 Lambda 函数必须在同一个区！</li>
<li>选择 <code>Auto from scratch</code>，Runtime 选择 <code>Node.js 14.x</code>，其余均保持默认。</li>
</ul>
<p><picture><source srcset="/usr/uploads/202202/aws-create-lambda.png.webp" type="image/webp"><source srcset="/usr/uploads/202202/aws-create-lambda.png.avif" type="image/avif"><source srcset="/usr/uploads/202202/aws-create-lambda.png.jxl" type="image/jxl"><img src="/usr/uploads/202202/aws-create-lambda.png" alt="AWS 创建 Lambda 函数"></picture></p>
</li>
<li>
<p>此时你会自动进入函数的编辑页面。如果你准备用 UptimeRobot，将这段代码复制进去：</p>
<pre class="shiki shiki-themes dark-plus light-plus" style="--shiki-dark:#D4D4D4;--shiki-light:#000000;--shiki-dark-bg:#1E1E1E;--shiki-light-bg:#FFFFFF" tabindex="0"><code><span class="line"><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF">var</span><span style="--shiki-dark:#4FC1FF;--shiki-light:#0070C1"> AWS</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> = </span><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">require</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">(</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">'aws-sdk'</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF">const</span><span style="--shiki-dark:#4FC1FF;--shiki-light:#0070C1"> SECRET_KEY</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> = </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">'**这里改成一串随机字符串，作为函数的密码**'</span></span>
<span class="line"><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF">const</span><span style="--shiki-dark:#4FC1FF;--shiki-light:#0070C1"> SNS_ARN</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> = </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">'**这里改成上面 AWS SNS 的 ARN**'</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#4EC9B0;--shiki-light:#267F99">exports</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">.</span><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">handler</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> = </span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF">async</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> event</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> =></span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> {</span></span>
<span class="line"><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB">  if</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> (</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">event</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">.</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">queryStringParameters</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">.</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">key</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> != </span><span style="--shiki-dark:#4FC1FF;--shiki-light:#0070C1">SECRET_KEY</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">) {</span></span>
<span class="line"><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB">    return</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">statusCode:</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 403</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">, </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">body:</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> 'Forbidden'</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> }</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF">  let</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> json</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> = </span><span style="--shiki-dark:#4FC1FF;--shiki-light:#0070C1">JSON</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">.</span><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">parse</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">(</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">event</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">.</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">body</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">)</span></span>
<span class="line"><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF">  let</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> ns1Object</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> = {</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">    AlarmName:</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> new</span><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26"> URL</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">(</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">json</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">.</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">url</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">).</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">hostname</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">    NewStateValue:</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> json</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">.</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">state</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> == </span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658">2</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> ? </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">'OK'</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> : </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">'ALARM'</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">,</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB">  try</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> {</span></span>
<span class="line"><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF">    let</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> sns</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> = </span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF">new</span><span style="--shiki-dark:#4FC1FF;--shiki-light:#0070C1"> AWS</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">.</span><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">SNS</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">({ </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">apiVersion:</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> '2010-03-31'</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> })</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF">    let</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> result</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> = </span><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB">await</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> sns</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">      .</span><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">publish</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">({</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">        TopicArn:</span><span style="--shiki-dark:#4FC1FF;--shiki-light:#0070C1"> SNS_ARN</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">        Message:</span><span style="--shiki-dark:#4FC1FF;--shiki-light:#0070C1"> JSON</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">.</span><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">stringify</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">(</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">ns1Object</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">),</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">      })</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">      .</span><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">promise</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB">    return</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> {</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">      statusCode:</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 200</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">      headers:</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> { </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">'Content-Type'</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">:</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> 'application/json'</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> },</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">      body:</span><span style="--shiki-dark:#4FC1FF;--shiki-light:#0070C1"> JSON</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">.</span><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">stringify</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">(</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">result</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">),</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">    }</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">  } </span><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB">catch</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> (</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">e</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">) {</span></span>
<span class="line"><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB">    return</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> {</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">      statusCode:</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 500</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">      body:</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> e</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">.</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">stack</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">,</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">    }</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">  }</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">}</span></span></code></pre>
<p>如果你准备用 Freshping，将这段代码复制进去：</p>
<pre class="shiki shiki-themes dark-plus light-plus" style="--shiki-dark:#D4D4D4;--shiki-light:#000000;--shiki-dark-bg:#1E1E1E;--shiki-light-bg:#FFFFFF" tabindex="0"><code><span class="line"><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF">var</span><span style="--shiki-dark:#4FC1FF;--shiki-light:#0070C1"> AWS</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> = </span><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">require</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">(</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">'aws-sdk'</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF">const</span><span style="--shiki-dark:#4FC1FF;--shiki-light:#0070C1"> SECRET_KEY</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> = </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">'**这里改成一串随机字符串，作为函数的密码**'</span></span>
<span class="line"><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF">const</span><span style="--shiki-dark:#4FC1FF;--shiki-light:#0070C1"> SNS_ARN</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> = </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">'**这里改成上面 AWS SNS 的 ARN**'</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#4EC9B0;--shiki-light:#267F99">exports</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">.</span><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">handler</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> = </span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF">async</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> event</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> =></span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> {</span></span>
<span class="line"><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB">  if</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> (</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">event</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">.</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">queryStringParameters</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">.</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">key</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> != </span><span style="--shiki-dark:#4FC1FF;--shiki-light:#0070C1">SECRET_KEY</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">) {</span></span>
<span class="line"><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB">    return</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> { </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">statusCode:</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 403</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">, </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">body:</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> 'Forbidden'</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> }</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF">  let</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> json</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> = </span><span style="--shiki-dark:#4FC1FF;--shiki-light:#0070C1">JSON</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">.</span><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">parse</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">(</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">event</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">.</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">body</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">)</span></span>
<span class="line"><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF">  let</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> ns1Object</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> = {</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">    AlarmName:</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> new</span><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26"> URL</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">(</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">json</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">.</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">check_url</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">).</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">hostname</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">    NewStateValue:</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> json</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">.</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">response_status_code</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> === </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">'200'</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> ? </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">'OK'</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> : </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">'ALARM'</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">,</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB">  try</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> {</span></span>
<span class="line"><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF">    let</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> sns</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> = </span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF">new</span><span style="--shiki-dark:#4FC1FF;--shiki-light:#0070C1"> AWS</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">.</span><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">SNS</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">({ </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">apiVersion:</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> '2010-03-31'</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> })</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF">    let</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> result</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> = </span><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB">await</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> sns</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">      .</span><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">publish</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">({</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">        TopicArn:</span><span style="--shiki-dark:#4FC1FF;--shiki-light:#0070C1"> SNS_ARN</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">        Message:</span><span style="--shiki-dark:#4FC1FF;--shiki-light:#0070C1"> JSON</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">.</span><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">stringify</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">(</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">ns1Object</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">),</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">      })</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">      .</span><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">promise</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB">    return</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> {</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">      statusCode:</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 200</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">      headers:</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> { </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">'Content-Type'</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">:</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> 'application/json'</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> },</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">      body:</span><span style="--shiki-dark:#4FC1FF;--shiki-light:#0070C1"> JSON</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">.</span><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">stringify</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">(</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">result</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">),</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">    }</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">  } </span><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB">catch</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> (</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">e</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">) {</span></span>
<span class="line"><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB">    return</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> {</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">      statusCode:</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 500</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">,</span></span>
<span class="line"><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">      body:</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> e</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">.</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">stack</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">,</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">    }</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">  }</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">}</span></span></code></pre>
<p>点击 Deploy 部署。</p>
</li>
<li>
<p>点击函数的 Configuration 标签，左侧选择 Permissions，再点击 Execution Role 里的链接，进入权限管理页面。</p>
<p><picture><source srcset="/usr/uploads/202202/aws-lambda-permissions.png.webp" type="image/webp"><source srcset="/usr/uploads/202202/aws-lambda-permissions.png.avif" type="image/avif"><source srcset="/usr/uploads/202202/aws-lambda-permissions.png.jxl" type="image/jxl"><img src="/usr/uploads/202202/aws-lambda-permissions.png" alt="AWS 函数权限配置"></picture></p>
</li>
<li>
<p>在打开的新页面上，点击 Add permissions - Create inline policy，创建一条权限规则。</p>
</li>
<li>
<p>进入 Create Policy（创建规则）页面后，Service 选择 SNS；</p>
<p><picture><source srcset="/usr/uploads/202202/aws-permission-service.png.webp" type="image/webp"><source srcset="/usr/uploads/202202/aws-permission-service.png.avif" type="image/avif"><source srcset="/usr/uploads/202202/aws-permission-service.png.jxl" type="image/jxl"><img src="/usr/uploads/202202/aws-permission-service.png" alt="AWS 权限配置选择 Service"></picture></p>
</li>
<li>
<p>Actions 选择 Write 下的 Publish；</p>
<p><picture><source srcset="/usr/uploads/202202/aws-permission-actions.png.webp" type="image/webp"><source srcset="/usr/uploads/202202/aws-permission-actions.png.avif" type="image/avif"><source srcset="/usr/uploads/202202/aws-permission-actions.png.jxl" type="image/jxl"><img src="/usr/uploads/202202/aws-permission-actions.png" alt="AWS 权限配置选择 Actions"></picture></p>
</li>
<li>
<p>在 Resources 点击 Add ARN，填写之前创建的 AWS SNS 的 ARN：</p>
<p><picture><source srcset="/usr/uploads/202202/aws-permission-resources.png.webp" type="image/webp"><source srcset="/usr/uploads/202202/aws-permission-resources.png.avif" type="image/avif"><source srcset="/usr/uploads/202202/aws-permission-resources.png.jxl" type="image/jxl"><img src="/usr/uploads/202202/aws-permission-resources.png" alt="AWS 权限配置选择 Resources"></picture></p>
</li>
<li>
<p>点右下角的 Review Policy，随便起个名字，然后点 Create Policy 创建规则。</p>
</li>
</ol>
<p>至此，我们创建了一个解析 UptimeRobot 或 Freshping 的 Webhook 消息的 Lambda 函数，并赋予了它向 SNS 发送消息的权限。但是现在还没有办法通过 HTTP 方式向这个函数发送请求。下一节将创建一个 API Gateway 用于接收 HTTP 请求并调用函数。</p>
<h1 id="aws-创建-api-gateway-接受-http-请求">AWS 创建 API Gateway 接受 HTTP 请求</h1>
<ol>
<li>
<p>进入
<a href="https://us-west-1.console.aws.amazon.com/apigateway/main/apis?region=us-west-1" rel="noopener noreferrer" target="_blank">AWS API Gateway 管理页面</a>，创建一个 API，类型选 HTTP；</p>
<ul>
<li>注意我的 AWS 链接都是 us-west-1 区的，如果你想新建在其它区域请自行切换！</li>
</ul>
<p><picture><source srcset="/usr/uploads/202202/aws-api-type.png.webp" type="image/webp"><source srcset="/usr/uploads/202202/aws-api-type.png.avif" type="image/avif"><source srcset="/usr/uploads/202202/aws-api-type.png.jxl" type="image/jxl"><img src="/usr/uploads/202202/aws-api-type.png" alt="AWS API Gateway 选择类型"></picture></p>
</li>
<li>
<p>点击 Add integration，类型选择 Lambda，并选择你刚才创建的 Lambda 函数，随便起个名，并点击下一步：</p>
<p><picture><source srcset="/usr/uploads/202202/aws-api-integrations.png.webp" type="image/webp"><source srcset="/usr/uploads/202202/aws-api-integrations.png.avif" type="image/avif"><source srcset="/usr/uploads/202202/aws-api-integrations.png.jxl" type="image/jxl"><img src="/usr/uploads/202202/aws-api-integrations.png" alt="AWS API Gateway 选择 Lambda 函数"></picture></p>
</li>
<li>
<p>在 Configure routes 页面，记下你的 Lambda 函数对应的路径，例如我的路径就是
<code>/ns1-uptime</code>：</p>
<p><picture><source srcset="/usr/uploads/202202/aws-api-routes.png.webp" type="image/webp"><source srcset="/usr/uploads/202202/aws-api-routes.png.avif" type="image/avif"><source srcset="/usr/uploads/202202/aws-api-routes.png.jxl" type="image/jxl"><img src="/usr/uploads/202202/aws-api-routes.png" alt="AWS API Gateway 配置路径"></picture></p>
</li>
<li>
<p>一路下一步创建成功，页面中央的 Stages 中就是 API Gateway 的地址。</p>
<p><picture><source srcset="/usr/uploads/202202/aws-api-url.png.webp" type="image/webp"><source srcset="/usr/uploads/202202/aws-api-url.png.avif" type="image/avif"><source srcset="/usr/uploads/202202/aws-api-url.png.jxl" type="image/jxl"><img src="/usr/uploads/202202/aws-api-url.png" alt="AWS API Gateway 地址"></picture></p>
<p>在地址末尾加上第三步的路径就是函数的地址。假设我的 API Gateway 地址是
<code>https://1234567890.execute-api.us-west-1.amazonaws.com/</code>，那么 Lambda 函数的地址就是
<code>https://1234567890.execute-api.us-west-1.amazonaws.com/ns1-uptime</code>，直接访问时应显示 Internal Server Error。</p>
</li>
</ol>
<h1 id="uptimerobotfreshping-接入-webhook">UptimeRobot/Freshping 接入 Webhook</h1>
<ol>
<li>
<p>由于我们在函数中设置了一个密码（<code>SECRET_KEY</code>），我们需要先把密码加到 Lambda
函数的地址上。假设密码是 <code>123456</code>，那么就在函数地址末尾加上 <code>?key=123456</code>，完整地址就是
<code>https://1234567890.execute-api.us-west-1.amazonaws.com/ns1-uptime?key=123456</code>。</p>
</li>
<li>
<p>如果你用的是 UptimeRobot，进入<a href="https://uptimerobot.com/dashboard#mySettings" rel="noopener noreferrer" target="_blank">后台的 My Settings 页面</a>，添加联系人（Add Alert Contact）：</p>
<ul>
<li>
<p>类型选择 Webhook；</p>
</li>
<li>
<p>URL to Notify 输入函数带有密码的完整地址；</p>
</li>
<li>
<p>POST Value 输入：</p>
<pre class="shiki shiki-themes dark-plus light-plus" style="--shiki-dark:#D4D4D4;--shiki-light:#000000;--shiki-dark-bg:#1E1E1E;--shiki-light-bg:#FFFFFF" tabindex="0"><code><span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">{ </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5">"url"</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">"*monitorURL*"</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">, </span><span style="--shiki-dark:#9CDCFE;--shiki-light:#0451A5">"state"</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">"*alertType*"</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> }</span></span></code></pre>
</li>
<li>
<p>勾选 Send as JSON；</p>
</li>
<li>
<p>Enable notification for 选择 Up &#x26; down events；</p>
</li>
<li>
<p>保存。</p>
</li>
</ul>
<p><picture><source srcset="/usr/uploads/202202/uptimerobot-webhook.png.webp" type="image/webp"><source srcset="/usr/uploads/202202/uptimerobot-webhook.png.avif" type="image/avif"><source srcset="/usr/uploads/202202/uptimerobot-webhook.png.jxl" type="image/jxl"><img src="/usr/uploads/202202/uptimerobot-webhook.png" alt="UptimeRobot Webhook 配置"></picture></p>
<ul>
<li>修改所有的监控任务，在联系人一栏选中刚刚添加的 Webhook。</li>
</ul>
</li>
<li>
<p>如果你用的是 Freshping，进入后台，点击左侧齿轮按钮 - Integrations 页面，在
Webhook 一栏创建接入（Create Integration）：</p>
<ul>
<li>Event Type 选择 Up/Down；</li>
<li>Trigger the Webhook 输入函数带有密码的完整地址；</li>
<li>其余均保持默认，保存即可。</li>
</ul>
</li>
</ol>
<h1 id="ns1-配置-geodns-和自动切换">NS1 配置 GeoDNS 和自动切换</h1>
<p>最后一步，我们要在 NS1 的控制面板里添加每个地区的解析记录，并绑定到对应的订阅
Feed 上。</p>
<ol>
<li>
<p>回到 <a href="https://my.nsone.net/#/zones" rel="noopener noreferrer" target="_blank">NS1 控制面板的 Zones 页面</a>，进入你的域名选项。</p>
</li>
<li>
<p>创建一个 CNAME 记录，先不添加 Answer，填写名称后直接保存。</p>
</li>
<li>
<p>点击左侧的 Edit Filter Chain，然后从右侧依次拖入：</p>
<ol>
<li>Up</li>
<li>Geotarget Country</li>
<li>Select First Group</li>
<li>Shuffle</li>
<li>Select First N</li>
</ol>
</li>
<li>
<p>勾选 Enable Client Subnet，然后保存。</p>
<p><picture><source srcset="/usr/uploads/202202/ns1-filter-chain.png.webp" type="image/webp"><source srcset="/usr/uploads/202202/ns1-filter-chain.png.avif" type="image/avif"><source srcset="/usr/uploads/202202/ns1-filter-chain.png.jxl" type="image/jxl"><img src="/usr/uploads/202202/ns1-filter-chain.png" alt="NS1 Filter Chain"></picture></p>
</li>
<li>
<p>在右侧点击添加 Answer Group，每个 Group 对应一个地区。点击 Answer Group 右侧的菜单，选择编辑信息 Edit Group Metadata，添加国家（Country）和地区（Subdivisions）信息。以洛杉矶（Los Angeles）为例：</p>
<ul>
<li>Country/countries 选择 Americas / Northern America / United States；</li>
<li>Subdivisions 选择 North America / United States of America / California；</li>
<li>US States 选择 Western US / California；</li>
<li>保存。</li>
</ul>
<p><picture><source srcset="/usr/uploads/202202/ns1-answer-group.png.webp" type="image/webp"><source srcset="/usr/uploads/202202/ns1-answer-group.png.avif" type="image/avif"><source srcset="/usr/uploads/202202/ns1-answer-group.png.jxl" type="image/jxl"><img src="/usr/uploads/202202/ns1-answer-group.png" alt="NS1 Answer Group"></picture></p>
</li>
<li>
<p>在这个 Answer Group 里选择 Add Answer to Group，填写准备工作第 4 步创建的对应节点的域名。点击右侧菜单选择编辑信息 Edit Answer Metadata：</p>
<ul>
<li>点击 Up/down 右侧的图标，选择对应这个节点的订阅 Feed，保存。</li>
</ul>
<p><picture><source srcset="/usr/uploads/202202/ns1-answer-meta.png.webp" type="image/webp"><source srcset="/usr/uploads/202202/ns1-answer-meta.png.avif" type="image/avif"><source srcset="/usr/uploads/202202/ns1-answer-meta.png.jxl" type="image/jxl"><img src="/usr/uploads/202202/ns1-answer-meta.png" alt="NS1 Answer 信息"></picture></p>
</li>
<li>
<p>重复 5、6 两步添加所有地区和节点并保存，此时这个 CNAME 记录已经启用了 GeoDNS
和自动切换。</p>
</li>
<li>
<p>将你的主域名 CNAME 到 NS1 上的这个（子）域名。</p>
</li>
</ol>
<blockquote>
<p>需要注意的是，目前的 DNS 规范不支持把根域名（主域名的 <code>@</code> 记录）CNAME 到其它域名上。如果你想把你的根域名CNAME 过来，可以选择使用 DNS 服务商的 CNAME
Flattening 功能。有些服务商会以 ALIAS、ANAME 的方式提供该功能，而有些服务商（如 Cloudflare）会自动对根域名的 CNAME 记录启用此功能。</p>
<p>但是，此时 NS1 获取到的客户端 IP 将是你主域名 DNS 服务商的权威 DNS IP。对于
Cloudflare 等全球节点众多的服务商，这不是问题，因为你的用户一般离权威 DNS 很近。但如果你的服务商节点较少，GeoDNS 可能会将你的用户导向较远的节点。</p>
</blockquote>
<p>此时全部配置均已完成，你可以手动停掉一台服务器检查效果。当你收到 UptimeRobot 或者 Freshping 的警告时，NS1 控制面板里对应服务器的状态也应该变成了 Down，DNS 查询也不会返回这台服务器的记录；当服务器恢复时，其状态会变回 Up，重新开始提供服务。</p>  </div>  <div class="clearfix" id="post-navi" data-astro-cid-gfbmwgei=""> <div class="float-end text-end" data-astro-cid-gfbmwgei=""> <a href="/article/chat/how-i-nuked-my-btrfs-partition.lantian/" title="我把硬盘换到了新电脑上，这是 Btrfs 上的数据发生的变化" data-astro-cid-gfbmwgei=""> 我把硬盘换到了新电脑上，这是 Btrfs 上的数据发生的变化 </a> <br data-astro-cid-gfbmwgei=""> 下一篇文章 »
</div> <div class="float-start text-start position-absolute" data-astro-cid-gfbmwgei="">
« 上一篇文章 <br data-astro-cid-gfbmwgei=""> <a href="/article/modify-computer/reverse-engineered-linux-driver-for-hp-omen-macro-keys.lantian/" title="用逆向工程方式给惠普暗影精灵宏按键编写 Linux 驱动" data-astro-cid-gfbmwgei=""> 用逆向工程方式给惠普暗影精灵宏按键编写 Linux 驱动 </a> </div> </div>  <div id="waline" data-waline-language="zh-CN" data-waline-path="/article/modify-website/ns1-uptimerobot-freshping-geodns.lantian"></div> <script type="module" src="/assets/WalineComment.astro_astro_type_script_index_0_lang.Dqib3X1E.js"></script>  </div> </div> </article>  </div> <aside class="d-none d-xl-block"> <section class="widget"> <h3>最新文章</h3> <ul class="list-unstyled"> <li> 07-20  <a href="/article/modify-computer/legal-lte-network-at-home-with-open5gs.lantian/">用 Open5GS 搭建合法的 LTE 网络</a> </li><li> 06-27  <a href="/article/modify-computer/sidestore-without-stosvpn-across-lan.lantian/">在内网中免 StosVPN 使用 SideStore</a> </li><li> 05-19  <a href="/article/modify-computer/nix-logarithmetic-math-library-from-zero.lantian/">从零开始实现 Nix 对数函数库</a> </li><li> 04-06  <a href="/article/modify-computer/legal-lte-network-at-home-for-100-bucks.lantian/">$100，DIY 搭建合法的 LTE 网络</a> </li><li> 02-10  <a href="/article/modify-computer/build-custom-android-kernel-with-nix.lantian/">用 Nix 编译自定义 Android 内核</a> </li><li> 04-20  <a href="/article/modify-website/migrate-blog-to-astro-js.lantian/">使用 Astro.js 重构我的博客</a> </li><li> 12-16  <a href="/article/modify-computer/nixos-low-ram-vps.lantian/">NixOS 系列（五）：制作小内存 VPS 的 DD 磁盘镜像</a> </li><li> 09-20  <a href="/article/modify-computer/nix-trigonometric-math-library-from-zero.lantian/">从零开始实现 Nix 三角函数库</a> </li><li> 05-29  <a href="/article/random-notes/pipewire-sigkill-fix.lantian/">解决 Pipewire 被 SIGKILL 的问题</a> </li><li> 05-12  <a href="/article/modify-website/how-to-kill-the-dn42-network.lantian/">如何引爆 DN42 网络（2023-05-12 更新）</a> </li><li> 05-08  <a href="/article/modify-computer/laptop-muxed-nvidia-passthrough.lantian/">Optimus MUXed 笔记本上的 NVIDIA 虚拟机显卡直通（2023-05 更新）</a> </li><li> 04-17  <a href="/article/random-notes/fix-china-telecom-roaming-no-4g-on-aosp-rom.lantian/">修改 APN 解决 AOSP ROM 上中国电信无法 4G 漫游问题</a> </li><li> 03-26  <a href="/article/random-notes/old-hp-workstation-as-all-in-one.lantian/">老款 HP 工作站配置 NAS+软路由笔记</a> </li><li> 01-14  <a href="/article/modify-computer/nixos-impermanence.lantian/">NixOS 系列（四）：“无状态”操作系统</a> </li><li> 06-21  <a href="/article/modify-computer/nixos-packaging.lantian/">NixOS 系列（三）：软件打包，从入门到放弃</a> </li> </ul> </section> <section class="widget"> <h3>最新评论</h3> <ul class="list-unstyled" id="recent-comments">  <li><a href="#">Loading...</a></li>  </ul> </section> <script type="module">const i=window.location.hostname=="localhost"?"https://comments.lantian.pub":window.location.origin;fetch(`${i}/api/comment?type=recent&count=10`).then(t=>{if(t.status!==200)throw new Error(`Server returned bad HTTP status ${t.status}`);return t.json()}).then(t=>{const e=document.getElementById("recent-comments");e&&(e.innerHTML=t.data.map(n=>{const o=n.comment.replace(/(<([^>]+)>)/gi,"");return"<li>"+n.nick+' <a href="'+n.url+'">'+o+"</a></li>"}).join(""))});</script> <section class="widget"> <h3>其它功能</h3> <ul class="list-unstyled">  <li> <i class="fas fa-fw fa-rss"></i>  <a href="/rss2.xml" target="_blank">RSS 订阅</a> |  <a href="/feed.xml" target="_blank">Atom</a> |  <a href="/feed.json" target="_blank">JSON</a> </li> <li> <i class="fas fa-fw fa-globe"></i>  <a href="https://stats.uptimerobot.com/BLK6VsRkR" target="_blank"> 服务器状态 </a> </li> <li> <i class="fas fa-fw fa-sitemap"></i>  <a href="https://lg.lantian.pub" target="_blank">DN42 节点状态</a> </li> <li> <i class="fas fa-fw fa-link"></i>  <a href="gopher://lantian.pub" target="_blank">使用 Gopher 协议访问</a> </li>  </ul> </section> <section class="widget"> <h3>友情链接</h3> <ul class="list-unstyled"> <li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://0x7f.cc"> 0x7f Blog 🐑 </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://alanyhq.com"> Alanyhq </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://blog.cas7.moe"> Blog of Moecast </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://jerryxiao.cc"> JerryXiao </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://snli.org"> Shucheng Li </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://sangsir.com"> SangSir | 艺术界的一朵奇葩 </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://yuetau.net"> YuetAu&#39;s Spot </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://blog.baoshuo.ren/?utm_source=friends"> 宝硕博客 </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="http://foreverblog.cn"> 十年之约 </a> </li> </ul> </section> </aside> </div> <footer class="lantian clearfix" data-astro-cid-w3csb3e3="">  <div id="copyright" class="float-end text-end" data-astro-cid-w3csb3e3=""> <i class="fas fa-copyright" data-astro-cid-w3csb3e3=""></i> 2012-2025 Lan Tian @ Blog<br data-astro-cid-w3csb3e3=""> <small data-astro-cid-w3csb3e3=""> 基于 Astro v5.15.1 构建 @ 2025-10-25 23:46:33 </small> </div> <script type="module">function v(c,o,r){const h=/^localhost$|^127(?:\.[0-9]+){0,2}\.[0-9]+$|^(?:0*:)*?:?0*1$/.test(location.hostname)||location.protocol==="file:";if(!o.trackLocalhost&&h)return console.warn("[Plausible] Ignoring event because website is running locally");try{if(window.localStorage.plausible_ignore==="true")return console.warn('[Plausible] Ignoring event because "plausible_ignore" is set to "true" in localStorage')}catch{}const p={n:c,u:o.url,d:o.domain,r:o.referrer,w:o.deviceWidth,h:o.hashMode?1:0,p:r&&r.props?JSON.stringify(r.props):void 0},s=new XMLHttpRequest;s.open("POST",`${o.apiHost}/api/event`,!0),s.setRequestHeader("Content-Type","text/plain"),s.send(JSON.stringify(p)),s.onreadystatechange=()=>{s.readyState===4&&r&&r.callback&&r.callback()}}function b(c){const o=()=>({hashMode:!1,trackLocalhost:!1,url:location.href,domain:location.hostname,referrer:document.referrer||null,deviceWidth:window.innerWidth,apiHost:"https://plausible.io",...c}),r=(t,n,i)=>{v(t,{...o(),...i},n)},h=(t,n)=>{r("pageview",n,t)};return{trackEvent:r,trackPageview:h,enableAutoPageviews:()=>{const t=()=>h(),n=history.pushState;return n&&(history.pushState=function(i,l,u){n.apply(this,[i,l,u]),t()},addEventListener("popstate",t)),c&&c.hashMode&&addEventListener("hashchange",t),h(),function(){n&&(history.pushState=n,removeEventListener("popstate",t)),c&&c.hashMode&&removeEventListener("hashchange",t)}},enableAutoOutboundTracking:(t=document,n={subtree:!0,childList:!0,attributes:!0,attributeFilter:["href"]})=>{function i(e){r("Outbound Link: Click",{props:{url:this.href}}),typeof process<"u"&&process,setTimeout(()=>{location.href=this.href},150),e.preventDefault()}const l=new Set;function u(e){e instanceof HTMLAnchorElement?e.host!==location.host&&(e.addEventListener("click",i),l.add(e)):"querySelectorAll"in e&&e.querySelectorAll("a").forEach(u)}function f(e){e instanceof HTMLAnchorElement?(e.removeEventListener("click",i),l.delete(e)):"querySelectorAll"in e&&e.querySelectorAll("a").forEach(f)}const d=new MutationObserver(e=>{e.forEach(a=>{a.type==="attributes"?(f(a.target),u(a.target)):a.type==="childList"&&(a.addedNodes.forEach(u),a.removedNodes.forEach(f))})});return t.querySelectorAll("a").forEach(u),d.observe(t,n),function(){l.forEach(a=>{a.removeEventListener("click",i)}),l.clear(),d.disconnect()}}}}const g=b({domain:"lantian.pub",trackLocalhost:!0,apiHost:""});g.trackPageview();</script> </footer>  </div>  </body> </html>