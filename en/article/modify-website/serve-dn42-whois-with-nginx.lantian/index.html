<!DOCTYPE html><html lang="en-US" itemscope="" itemtype="https://schema.org/Article" data-astro-cid-porej7z2=""> <head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Setting up DN42 WHOIS Server with Nginx - Lan Tian @ Blog</title><script>
  ;(() => {
    try {
      const mode = localStorage.getItem('user-color-scheme')
      if (mode == 'dark' || mode == 'light') {
        document.documentElement.setAttribute('data-user-color-scheme', mode)
      }
    } catch {
      // Ignore errors
    }
  })()
</script><link rel="stylesheet" href="/assets/index.CUlf1-Vz.css"><style>#post-navi[data-astro-cid-gfbmwgei]{padding:5px;border-top:1px solid var(--lt-border-weak);border-bottom:1px solid var(--lt-border-weak)}
ol[data-astro-cid-nj3qel45]{margin:0;padding:0;line-height:1.5}ol[data-astro-cid-nj3qel45] .toc-item[data-astro-cid-nj3qel45]{list-style:none}ol[data-astro-cid-nj3qel45] .toc-child[data-astro-cid-nj3qel45],ol[data-astro-cid-nj3qel45] .toc[data-astro-cid-nj3qel45]{padding:0}ol[data-astro-cid-nj3qel45] .toc-link[data-astro-cid-nj3qel45]{display:block;margin-left:1em;padding:.25em 0}ol[data-astro-cid-nj3qel45] .toc-level-1[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-2[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-3[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-4[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-5[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-6[data-astro-cid-nj3qel45]:before{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;width:1em;padding:.25em 0;float:left;font-style:normal;font-variant:normal;font-weight:900;font-family:Font Awesome\ 6 Free;font-feature-settings:normal;text-align:center}ol[data-astro-cid-nj3qel45] .toc-level-1[data-astro-cid-nj3qel45]:before{content:""}ol[data-astro-cid-nj3qel45] .toc-level-2[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-3[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-4[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-5[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-6[data-astro-cid-nj3qel45]:before{content:""}.post-info-wrap[data-astro-cid-dckccua4]{-ms-flex:0 0 2.5em;flex:0 0 2.5em;background-color:var(--lt-component-bg-emphasis)}@media(min-width:768px){.post-info[data-astro-cid-dckccua4]{position:sticky;top:0}}@media(max-width:767.98px){.post-info[data-astro-cid-dckccua4]{position:absolute}}
</style><script type="module" src="/assets/PageLayout.astro_astro_type_script_index_0_lang.C1wfUPs6.js"></script><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta http-equiv="Referrer-Policy" content="no-referrer, strict-origin-when-cross-origin"><meta name="renderer" content="webkit|ie-comp|ie-stand"><meta name="imagemode" content="force"><meta name="nightmode" content="disable"><meta name="wap-font-scale" content="no"><meta name="title" content="Setting up DN42 WHOIS Server with Nginx - Lan Tian @ Blog"><meta name="keywords" content=""><meta name="author" content="Lan Tian"><link rel="canonical" href="https://lantian.pub/en/article/modify-website/serve-dn42-whois-with-nginx.lantian/"><link rel="alternate" type="application/rss+xml" title="Lan Tian @ Blog" href="https://lantian.pub/rss2.xml"><link rel="alternate" type="application/atom+xml" title="Lan Tian @ Blog" href="https://lantian.pub/feed.xml"><link rel="alternate" href="https://lantian.pub/article/modify-website/serve-dn42-whois-with-nginx.lantian/" hreflang="zh"><link rel="alternate" href="https://lantian.pub/en/article/modify-website/serve-dn42-whois-with-nginx.lantian/" hreflang="en"><meta name="copyright" content="Copyright 2012-2025 Lan Tian @ Blog"><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="48x48" href="/favicon-48x48.png"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="manifest" href="/manifest.webmanifest"><meta name="mobile-web-app-capable" content="yes"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#03a9f4"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#212121"><meta name="application-name" content="Lan Tian @ Blog"><link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="167x167" href="/apple-touch-icon-167x167.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png"><link rel="apple-touch-icon" sizes="1024x1024" href="/apple-touch-icon-1024x1024.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-precomposed.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#03a9f4"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-title" content="Lan Tian @ Blog"><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-640x1136.png"><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-1136x640.png"><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-750x1334.png"><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-1334x750.png"><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1125x2436.png"><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2436x1125.png"><link rel="apple-touch-startup-image" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1170x2532.png"><link rel="apple-touch-startup-image" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2532x1170.png"><link rel="apple-touch-startup-image" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1179x2556.png"><link rel="apple-touch-startup-image" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2556x1179.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-828x1792.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-1792x828.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1242x2688.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2688x1242.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1242x2208.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2208x1242.png"><link rel="apple-touch-startup-image" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1284x2778.png"><link rel="apple-touch-startup-image" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2778x1284.png"><link rel="apple-touch-startup-image" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1290x2796.png"><link rel="apple-touch-startup-image" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2796x1290.png"><link rel="apple-touch-startup-image" media="(device-width: 744px) and (device-height: 1133px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1488x2266.png"><link rel="apple-touch-startup-image" media="(device-width: 744px) and (device-height: 1133px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2266x1488.png"><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1536x2048.png"><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2048x1536.png"><link rel="apple-touch-startup-image" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1620x2160.png"><link rel="apple-touch-startup-image" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2160x1620.png"><link rel="apple-touch-startup-image" media="(device-width: 820px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1640x2160.png"><link rel="apple-touch-startup-image" media="(device-width: 820px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2160x1640.png"><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1668x2388.png"><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2388x1668.png"><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1668x2224.png"><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2224x1668.png"><link rel="apple-touch-startup-image" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-2048x2732.png"><link rel="apple-touch-startup-image" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2732x2048.png"><meta name="msapplication-TileColor" content="#bbdefb"><meta name="msapplication-TileImage" content="/mstile-144x144.png"><meta name="msapplication-config" content="/browserconfig.xml"><link rel="yandex-tableau-widget" href="/yandex-browser-manifest.json"><meta property="og:url" content="https://lantian.pub/en/article/modify-website/serve-dn42-whois-with-nginx.lantian/"><meta property="og:type" content="website"><meta property="og:title" content="Setting up DN42 WHOIS Server with Nginx - Lan Tian @ Blog"><meta property="og:image" content="https://lantian.pub/apple-touch-icon.png"><meta content="In my previous post, &#34; Setting up Gopher Site with Nginx &#34;, I mentioned that the Gopher service is a byproduct of my original plan: modifying Nginx into a WHOIS server for DN42. This post will explore into details of that process. The WHOIS Protocol First, we can find a WHOIS server to observe its response. Choose the WHOIS server for .pub domain as an example, and run telnet whois.nic.pub 43 : # Type following line and hit enter lantian.pub # WHOIS server responded with: Domain Name: lantian.pub Registry Domain ID: c69e5ccf9d834900be26f88fddc5c9e4-DONUTS Registrar WHOIS Server: whois.dnspod.cn Registrar URL: https://www.dnspod.cn Updated Date: 2021-01-07T14:09:11Z Creation Date: 2016-10-23T08:36:41Z Registry Expiry Date: 2029-10-23T08:36:41Z Registrar: DNSPod, Inc...."><meta property="og:site_name" content="Lan Tian @ Blog"><meta property="og:locale" content="en"><meta name="twitter:card" content="summary"><meta name="twitter:url" content="https://lantian.pub/en/article/modify-website/serve-dn42-whois-with-nginx.lantian/"><meta name="twitter:title" content="Setting up DN42 WHOIS Server with Nginx - Lan Tian @ Blog"><meta property="twitter:image" content="https://lantian.pub/apple-touch-icon.png"><meta content="In my previous post, &#34; Setting up Gopher Site with Nginx &#34;, I mentioned that the Gopher service is a byproduct of my original plan: modifying Nginx into a WHOIS server for DN42. This post will explore into details of that process. The WHOIS Protocol First, we can find a WHOIS server to observe its response. Choose the WHOIS server for .pub domain as an example, and run telnet whois.nic.pub 43 : # Type following line and hit enter lantian.pub # WHOIS server responded with: Domain Name: lantian.pub Registry Domain ID: c69e5ccf9d834900be26f88fddc5c9e4-DONUTS Registrar WHOIS Server: whois.dnspod.cn Registrar URL: https://www.dnspod.cn Updated Date: 2021-01-07T14:09:11Z Creation Date: 2016-10-23T08:36:41Z Registry Expiry Date: 2029-10-23T08:36:41Z Registrar: DNSPod, Inc...."><meta name="twitter:dnt" content="on"><meta itemprop="name" content="Setting up DN42 WHOIS Server with Nginx - Lan Tian @ Blog"><meta property="image" content="https://lantian.pub/apple-touch-icon.png"><meta content="In my previous post, &#34; Setting up Gopher Site with Nginx &#34;, I mentioned that the Gopher service is a byproduct of my original plan: modifying Nginx into a WHOIS server for DN42. This post will explore into details of that process. The WHOIS Protocol First, we can find a WHOIS server to observe its response. Choose the WHOIS server for .pub domain as an example, and run telnet whois.nic.pub 43 : # Type following line and hit enter lantian.pub # WHOIS server responded with: Domain Name: lantian.pub Registry Domain ID: c69e5ccf9d834900be26f88fddc5c9e4-DONUTS Registrar WHOIS Server: whois.dnspod.cn Registrar URL: https://www.dnspod.cn Updated Date: 2021-01-07T14:09:11Z Creation Date: 2016-10-23T08:36:41Z Registry Expiry Date: 2029-10-23T08:36:41Z Registrar: DNSPod, Inc...."><meta content="In my previous post, &#34; Setting up Gopher Site with Nginx &#34;, I mentioned that the Gopher service is a byproduct of my original plan: modifying Nginx into a WHOIS server for DN42. This post will explore into details of that process. The WHOIS Protocol First, we can find a WHOIS server to observe its response. Choose the WHOIS server for .pub domain as an example, and run telnet whois.nic.pub 43 : # Type following line and hit enter lantian.pub # WHOIS server responded with: Domain Name: lantian.pub Registry Domain ID: c69e5ccf9d834900be26f88fddc5c9e4-DONUTS Registrar WHOIS Server: whois.dnspod.cn Registrar URL: https://www.dnspod.cn Updated Date: 2021-01-07T14:09:11Z Creation Date: 2016-10-23T08:36:41Z Registry Expiry Date: 2029-10-23T08:36:41Z Registrar: DNSPod, Inc...."><link rel="me" href="https://mastodon.social/@lantian"></head> <body data-astro-cid-porej7z2=""> <div id="bg" data-astro-cid-j6vmxtef=""></div>   <div id="container" class="container" data-astro-cid-porej7z2=""> <nav class="lantian navbar navbar-expand-lg" data-astro-cid-wu5dj4rx=""> <div class="container-fluid" data-astro-cid-wu5dj4rx=""> <a class="navbar-brand" href="/en/" data-astro-cid-wu5dj4rx="">Lan Tian @ Blog</a> <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#lantian-navbar" aria-controls="lantian-navbar" aria-expanded="false" aria-label="Toggle navigation" data-astro-cid-wu5dj4rx=""> <span class="navbar-toggler-icon" data-astro-cid-wu5dj4rx=""></span> </button> <div class="collapse navbar-collapse" id="lantian-navbar" data-astro-cid-wu5dj4rx=""> <ul class="navbar-nav" data-astro-cid-wu5dj4rx=""> <li class="nav-item d-none d-lg-block" data-astro-cid-wu5dj4rx=""> <a class="nav-link" href="/en/page/archive/index.html" data-astro-cid-wu5dj4rx=""> Posts </a> </li><li class="nav-item d-none d-lg-block" data-astro-cid-wu5dj4rx=""> <a class="nav-link" href="/en/page/himawari/index.html" data-astro-cid-wu5dj4rx=""> Himawari </a> </li><li class="nav-item d-none d-lg-block" data-astro-cid-wu5dj4rx=""> <a class="nav-link" href="/en/page/dn42/index.html" data-astro-cid-wu5dj4rx=""> DN42 </a> </li> <li class="nav-item dropdown d-block d-lg-none" data-astro-cid-wu5dj4rx=""> <a href="#" class="nav-link dropdown-toggle" id="pages-dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" data-astro-cid-wu5dj4rx=""> <i class="fas fa-fw fa-file" data-astro-cid-wu5dj4rx=""></i> Page  <span class="caret" data-astro-cid-wu5dj4rx=""></span> </a> <ul class="dropdown-menu" aria-labelledby="pages-dropdown" data-astro-cid-wu5dj4rx=""> <li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item" href="/en/page/archive/index.html" data-astro-cid-wu5dj4rx=""> Posts </a> </li><li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item" href="/en/page/himawari/index.html" data-astro-cid-wu5dj4rx=""> Himawari </a> </li><li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item" href="/en/page/dn42/index.html" data-astro-cid-wu5dj4rx=""> DN42 </a> </li> </ul> </li> </ul> <ul class="navbar-nav ms-auto" data-astro-cid-wu5dj4rx=""> <li class="nav-item dropdown" data-astro-cid-wu5dj4rx=""> <a href="#" class="nav-link dropdown-toggle" id="languages-dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" data-astro-cid-wu5dj4rx=""> <i class="fas fa-fw fa-language" data-astro-cid-wu5dj4rx=""></i> Language <span class="caret" data-astro-cid-wu5dj4rx=""></span> </a> <ul class="dropdown-menu" aria-labelledby="languages-dropdown" data-astro-cid-wu5dj4rx=""> <li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item" href="/article/modify-website/serve-dn42-whois-with-nginx.lantian/" data-astro-cid-wu5dj4rx=""> <span class="flag-icon flag-icon-cn" data-astro-cid-wu5dj4rx=""></span> Chinese Simplified / 简体中文 </a> </li><li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item active" href="/en/article/modify-website/serve-dn42-whois-with-nginx.lantian/" data-astro-cid-wu5dj4rx=""> <span class="flag-icon flag-icon-us" data-astro-cid-wu5dj4rx=""></span> English </a> </li> <li data-astro-cid-wu5dj4rx=""><hr class="dropdown-divider" data-astro-cid-wu5dj4rx=""></li> <li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item disabled" href="#" data-astro-cid-wu5dj4rx="">Not all pages have translations.</a> </li> <li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item disabled" href="#" data-astro-cid-wu5dj4rx="">You may see 404 - this is normal.</a> </li> </ul> </li> <li class="nav-item dropdown" data-astro-cid-wu5dj4rx=""> <a href="#" class="nav-link dropdown-toggle" id="color-scheme-dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" data-astro-cid-wu5dj4rx=""> <i class="fas fa-fw fa-adjust" data-astro-cid-wu5dj4rx=""></i> Night Mode </a> <ul class="dropdown-menu" aria-labelledby="color-scheme-dropdown" data-astro-cid-wu5dj4rx=""> <li data-astro-cid-wu5dj4rx=""> <a id="color-scheme-auto" class="dropdown-item" href="#" data-astro-cid-wu5dj4rx=""><i class="fas fa-fw fa-adjust" data-astro-cid-wu5dj4rx=""></i> Auto </a> </li> <li data-astro-cid-wu5dj4rx=""><hr class="dropdown-divider" data-astro-cid-wu5dj4rx=""></li> <li data-astro-cid-wu5dj4rx=""> <a id="color-scheme-light" class="dropdown-item" href="#" data-astro-cid-wu5dj4rx=""><i class="fas fa-fw fa-sun" data-astro-cid-wu5dj4rx=""></i> Light</a> </li> <li data-astro-cid-wu5dj4rx=""> <a id="color-scheme-dark" class="dropdown-item" href="#" data-astro-cid-wu5dj4rx=""><i class="fas fa-fw fa-moon" data-astro-cid-wu5dj4rx=""></i> Dark</a> </li> </ul> </li> </ul> </div> </div> </nav> <script type="module">const m="user-color-scheme",s="data-user-color-scheme",u=(e,t)=>{try{localStorage.setItem(e,t)}catch{}},i=e=>{try{return localStorage.getItem(e)}catch{return null}},c=e=>{const t={dark:!0,light:!0,auto:!0},o=e===null||!Object.keys(t).includes(e)?"auto":e;u(m,o);for(const l in t){const n=document.getElementById("color-scheme-"+l);n&&(l==o?n.classList.add("active"):n.classList.remove("active"))}o!="auto"?document.documentElement.setAttribute(s,o):document.documentElement.removeAttribute(s)};c(i(m));const r=document.getElementById("color-scheme-auto");r&&r.addEventListener("click",()=>c("auto"));const a=document.getElementById("color-scheme-light");a&&a.addEventListener("click",()=>c("light"));const d=document.getElementById("color-scheme-dark");d&&d.addEventListener("click",()=>c("dark"));</script>  <div class="d-flex" data-astro-cid-porej7z2=""> <div id="content" data-astro-cid-porej7z2="">  <article> <div class="d-flex"> <div class="post-info-wrap" data-astro-cid-dckccua4=""> <div class="post-info" data-astro-cid-dckccua4=""> <div class="post-meta-wrap"> <div class="post-meta"> <p> <span class="fas fa-clock"></span> <br> <small>04-19</small> </p> <div class="post-meta-value"> Published on<span class="badge badge-tag" data-astro-cid-dckccua4=""> 2021-04-19 02:12 </span>  </div> </div> </div> <div class="post-meta-wrap"> <div class="post-meta"> <p> <span class="fas fa-file-alt"></span> <br> <small>Website and Servers</small> </p> <div class="post-meta-value"> Category <a class="badge badge-tag" href="/en/category/modify-website" data-astro-cid-dckccua4=""> Website and Servers </a>  </div> </div> </div> <div class="post-meta-wrap"> <div class="post-meta"> <p> <span class="fas fa-tag"></span> <br> <small>3 tags</small> </p> <div class="post-meta-value"> Tags  <a class="badge badge-tag" href="/en/tag/nginx" data-astro-cid-dckccua4=""> nginx </a>  <a class="badge badge-tag" href="/en/tag/WHOIS" data-astro-cid-dckccua4=""> WHOIS </a>  <a class="badge badge-tag" href="/en/tag/DN42" data-astro-cid-dckccua4=""> DN42 </a>  </div> </div> </div> <div class="post-meta-wrap"> <div class="post-meta"> <p> <span class="fas fa-list"></span> <br> <small>ToC</small> </p> <div class="post-meta-value">  <ol data-astro-cid-nj3qel45=""> <li class="toc-item toc-level-2" data-astro-cid-nj3qel45=""> <a class="toc-link" href="#the-whois-protocol" data-astro-cid-nj3qel45=""> <span class="toc-text" data-astro-cid-nj3qel45="">The WHOIS Protocol</span> </a> </li><li class="toc-item toc-level-2" data-astro-cid-nj3qel45=""> <a class="toc-link" href="#categorizing-queries" data-astro-cid-nj3qel45=""> <span class="toc-text" data-astro-cid-nj3qel45="">Categorizing Queries</span> </a> </li><li class="toc-item toc-level-2" data-astro-cid-nj3qel45=""> <a class="toc-link" href="#matching-smallest-ip-block" data-astro-cid-nj3qel45=""> <span class="toc-text" data-astro-cid-nj3qel45="">Matching Smallest IP Block</span> </a> </li><li class="toc-item toc-level-2" data-astro-cid-nj3qel45=""> <a class="toc-link" href="#final-effects" data-astro-cid-nj3qel45=""> <span class="toc-text" data-astro-cid-nj3qel45="">Final Effects</span> </a> </li> </ol>   </div> </div> </div> </div>  </div>  <div class="post-wrap">  <h1 class="post-title"> <a href="/en/article/modify-website/serve-dn42-whois-with-nginx.lantian/" rel="bookmark" title="Setting up DN42 WHOIS Server with Nginx">Setting up DN42 WHOIS Server with Nginx</a> </h1> <div class="post-text">   <p>In my previous post,
"<a href="/en/article/modify-website/serve-gopher-with-nginx.lantian/">Setting up Gopher Site with Nginx</a>",
I mentioned that the Gopher service is a byproduct of my original plan:
modifying Nginx into a WHOIS server for DN42. This post will explore into
details of that process.</p>
<h2 id="the-whois-protocol">The WHOIS Protocol</h2>
<p>First, we can find a WHOIS server to observe its response. Choose the WHOIS
server for <code>.pub</code> domain as an example, and run <code>telnet whois.nic.pub 43</code>:</p>
<pre class="shiki shiki-themes dark-plus light-plus" style="--shiki-dark:#D4D4D4;--shiki-light:#000000;--shiki-dark-bg:#1E1E1E;--shiki-light-bg:#FFFFFF" tabindex="0"><code><span class="line"><span style="--shiki-dark:#6A9955;--shiki-light:#008000"># Type following line and hit enter</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">lantian.pub</span></span>
<span class="line"><span style="--shiki-dark:#6A9955;--shiki-light:#008000"># WHOIS server responded with:</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">Domain</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Name:</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> lantian.pub</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">Registry</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Domain</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> ID:</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> c69e5ccf9d834900be26f88fddc5c9e4-DONUTS</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">Registrar</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> WHOIS</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Server:</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> whois.dnspod.cn</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">Registrar</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> URL:</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> https://www.dnspod.cn</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">Updated</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Date:</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> 2021-01-07T14:09:11Z</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">Creation</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Date:</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> 2016-10-23T08:36:41Z</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">Registry</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Expiry</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Date:</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> 2029-10-23T08:36:41Z</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">Registrar:</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> DNSPod,</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Inc.</span></span>
<span class="line"><span style="--shiki-dark:#6A9955;--shiki-light:#008000"># Snip</span></span>
<span class="line"><span style="--shiki-dark:#6A9955;--shiki-light:#008000"># Then WHOIS server closes connection</span></span></code></pre>
<p>This is exactly the same as Gopher, another protocol that creates one response
to each request. Therefore, I can simply reuse my Gopher codebase for my WHOIS
server instead of adding extra modifications.</p>
<h2 id="categorizing-queries">Categorizing Queries</h2>
<p>Since our nginx already had support for WHOIS, all we have to do is to add data.
However, "adding data" to a WHOIS server is not an easy task. Take the
<a href="https://git.dn42.dev/dn42/registry" rel="noopener noreferrer" target="_blank">DN42 Registry</a> for example. Its data is
categorized into:</p>
<ul>
<li><code>as-block</code>: Range of ASN, defining allocation policies.</li>
<li><code>as-set</code>: Group of ASNs, managed by each AS individually. It's used to label
peered AS and downstream customers for automated routing policy generation on
the Internet, but is not that useful in DN42.</li>
<li><code>aut-num</code>: Information for the AS itself.</li>
<li><code>dns</code>: Domains.</li>
<li><code>inet6num</code>: <strong>Allocation</strong> of IPv6 address blocks. This is not the same as
routing information.</li>
<li><code>inetnum</code>: Allocation of IPv4 addresses blocks.</li>
<li><code>key-cert</code>: User's GPG keys. Users can store their GPG public keys here, if
the use of a keyserver is unfeasible or impossible.</li>
<li><code>mntner</code>: Information of network maintainers.</li>
<li><code>organisation</code>: Information of organizations. For example, there's a professor
participating in DN42, who asks his students to peer in DN42 as networking
practices. He can form an organization with his students in this case.</li>
<li><code>person</code>: Information of users. What's different from <code>mntner</code> it that
<code>person</code> is more focused on contact information.</li>
<li><code>registry</code>: Information of registries. A "registry", including RIPE or APNIC,
manages IP and ASN. Information of interconnected networks is also here, for
example ChaosVPN and NeoNetwork.</li>
<li><code>role</code>: User role information for permission granting purposes. Rarely used in
DN42.</li>
<li><code>route</code>: <strong>Routing</strong> information for IPv4 blocks. An IP block can be split to
smaller blocks for announcements.</li>
<li><code>route6</code>: Routing information for IPv6 blocks.</li>
<li><code>route-set</code>: Defines the IP space of DN42.</li>
<li><code>schema</code>: Defines file format in the registry.</li>
<li><code>tinc-key</code>: Public keys of Tinc VPN.</li>
</ul>
<p>When users perform a query, they will only provide the query target itself, not
category/type information. Example queries are <code>lantian.dn42</code>, <code>172.22.76.185</code>
or <code>LANTIAN-MNT</code>. Luckily, files in the DN42 registry are named after
conventions different for each type, so a query type can be inferred, and we
will know which folder to check.</p>
<blockquote>
<p>Of course, no one's stopping you from putting everything into a single folder.
It will definitely create a mess, though.</p>
</blockquote>
<p>So I wrote a tiny bit of regular expressions:</p>
<pre class="shiki shiki-themes dark-plus light-plus" style="--shiki-dark:#D4D4D4;--shiki-light:#000000;--shiki-dark-bg:#1E1E1E;--shiki-light-bg:#FFFFFF" tabindex="0"><code><span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">rewrite</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "^/([0-9]{1})$"</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /aut-num/AS424242000</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$1</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> last</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">rewrite</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "^/([0-9]{2})$"</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /aut-num/AS42424200</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$1</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> last</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">rewrite</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "^/([0-9]{3})$"</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /aut-num/AS4242420</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$1</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> last</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">rewrite</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "^/([0-9]{4})$"</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /aut-num/AS424242</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$1</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> last</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">rewrite</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "^/([Aa][Ss]|)([0-9]+)$"</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /aut-num/AS</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$2</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> last</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">rewrite</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "^/([0-9]+)\.([0-9]+)\.([0-9]+)\.([0-9]+)/([0-9]+)$"</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /inetnum/</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$1</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">.</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$2</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">.</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$3</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">.</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$4_$5</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> last</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">rewrite</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "^/([0-9]+)\.([0-9]+)\.([0-9]+)\.([0-9]+)$"</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /inetnum/</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$1</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">.</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$2</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">.</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$3</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">.</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$4_32</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> last</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">rewrite</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "^/([0-9a-fA-F:]+)/([0-9]+)$"</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /inet6num/</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$1_$2</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> last</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">rewrite</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "^/([0-9a-fA-F:]+)$"</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /inet6num/</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$1_128</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> last</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">rewrite</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "^/([^/]+)-([Dd][Nn]42)$"</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /person/</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$1</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">-DN42</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> last</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">rewrite</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "^/([^/]+)-([Mm][Nn][Tt])$"</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /mntner/</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$1</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">-MNT</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> last</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">rewrite</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "^/([^/]+)-([Ss][Cc][Hh][Ee][Mm][Aa])$"</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /schema/</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$1</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">-SCHEMA</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> last</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">rewrite</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "^/([Oo][Rr][Gg])-(.+)$"</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /organisation/ORG-</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$2</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> last</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">rewrite</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "^/([Ss][Ee][Tt])-(.+)-([Tt][Ii][Nn][Cc])$"</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /tinc-keyset/SET-</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$2</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">-TINC</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> last</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">rewrite</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "^/([^/]+)-([Tt][Ii][Nn][Cc])$"</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /tinc-key/</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$1</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">-TINC</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> last</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">rewrite</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "^/([Rr][Ss])-(.+)$"</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /route-set/RS-</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$2</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> last</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">rewrite</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "^/([Aa][Ss])([0-9]+)-([Aa][Ss])([0-9]+)$"</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /as-block/</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$1$2</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">-</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$3$4</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> last</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">rewrite</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "^/[Aa][Ss](.+)$"</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /as-set/AS</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$1</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> last</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">rewrite</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "^/([^/]+)$"</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /dns/</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$1</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> last</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span></code></pre>
<p>We aren't done yet, since the ext4 filesystem of Linux is case sensitive. If a
file is named <code>LANTIAN-MNT</code> in the registry, you will get 404 when you look for
<code>lantian-mnt</code>. The WHOIS client in Linux, for example, converts all queries to
lower case. Therefore, we have to convert upper/lower case for each folder, for
example:</p>
<blockquote>
<p>I'm using Lua here since Nginx itself isn't capable of transforming
upper/lower cases.</p>
<p>You will need to replace Nginx with <a href="https://openresty.org" rel="noopener noreferrer" target="_blank">OpenResty</a> to use
Lua.</p>
</blockquote>
<pre class="shiki shiki-themes dark-plus light-plus" style="--shiki-dark:#D4D4D4;--shiki-light:#000000;--shiki-dark-bg:#1E1E1E;--shiki-light-bg:#FFFFFF" tabindex="0"><code><span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">location</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> ~</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF">*</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "^/(dns)/(.*)$"</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> {</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">    set_by_lua</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> $uri_norm</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "return '/' .. ngx.arg[1]:lower() .. '/' .. ngx.arg[2]:lower()"</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> $1</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> $2</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">    try_files</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> $uri_norm</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> $uri</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> =</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658">404</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">location</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> ~</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF">*</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "^/(aut-num|person|mntner|schema|organisation|tinc-keyset|tinc-key|as-set|route-set|as-block)/(.*)$"</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> {</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">    set_by_lua</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> $uri_norm</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "return '/' .. ngx.arg[1]:lower() .. '/' .. ngx.arg[2]:upper()"</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> $1</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> $2</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">    try_files</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> $uri_norm</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> $uri</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> =</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658">404</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">}</span></span></code></pre>
<h2 id="matching-smallest-ip-block">Matching Smallest IP Block</h2>
<p>The regular expressions and case conversion can handle many of the contents in
the registry, but the most important piece is missing: IP addresses. The user
may be looking up single IP addresses or IP blocks, and the WHOIS server needs
to return the information for a larger (or equal) IP block containing the target
IP. Suppose we have three IP blocks in our registry:</p>
<ul>
<li><code>192.168.0.0/16</code></li>
<li><code>192.168.16.0/20</code></li>
<li><code>192.168.18.0/24</code></li>
</ul>
<p>Users should get different responses when looking up different IPs and blocks:</p>
<ul>
<li><code>192.168.18.18</code> -> <code>192.168.18.0/24</code></li>
<li><code>192.168.18.18/24</code> -> <code>192.168.18.0/24</code></li>
<li><code>192.168.18.18/20</code> -> <code>192.168.16.0/20</code></li>
<li><code>192.168.17.1</code> -> <code>192.168.16.0/20</code></li>
<li><code>192.168.17.1/16</code> -> <code>192.168.0.0/16</code></li>
</ul>
<p>Such logic cannot be implemented in simple regular expressions and case
conversions. We need more complicated logic in Lua, with the following steps:</p>
<p><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--><!-- Generated by graphviz version 14.0.2 (0)
 --><!-- Pages: 1 -->
<svg width="376pt" height="425pt" viewBox="0.00 0.00 376.00 425.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 420.8)">
<polygon fill="white" stroke="none" points="-4,4 -4,-420.8 371.78,-420.8 371.78,4 -4,4"></polygon><!-- S -->
<g id="node1" class="node">
<title>S</title>
<polygon fill="none" stroke="black" points="233.81,-416.8 179.81,-416.8 179.81,-380.8 233.81,-380.8 233.81,-416.8"></polygon>
<text xml:space="preserve" text-anchor="middle" x="206.81" y="-394.6" font-family="Times,serif" font-size="14.00">Start</text>
</g><!-- A -->
<g id="node2" class="node">
<title>A</title>
<polygon fill="none" stroke="black" points="273.14,-343.8 140.49,-343.8 140.49,-307.8 273.14,-307.8 273.14,-343.8"></polygon>
<text xml:space="preserve" text-anchor="middle" x="206.81" y="-321.6" font-family="Times,serif" font-size="14.00">Calc first IP in block</text>
</g><!-- S&#45;&gt;A -->
<g id="edge1" class="edge">
<title>S->A</title>
<path fill="none" stroke="black" d="M206.81,-380.61C206.81,-373.03 206.81,-363.9 206.81,-355.34"></path>
<polygon fill="black" stroke="black" points="210.31,-355.34 206.81,-345.34 203.31,-355.34 210.31,-355.34"></polygon>
</g><!-- B -->
<g id="node3" class="node">
<title>B</title>
<polygon fill="none" stroke="black" points="367.78,-270.8 45.85,-270.8 45.85,-234.8 367.78,-234.8 367.78,-270.8"></polygon>
<text xml:space="preserve" text-anchor="middle" x="206.81" y="-248.6" font-family="Times,serif" font-size="14.00">Decrease block size n from user input size (default 32)</text>
</g><!-- A&#45;&gt;B -->
<g id="edge2" class="edge">
<title>A->B</title>
<path fill="none" stroke="black" d="M206.81,-307.61C206.81,-300.03 206.81,-290.9 206.81,-282.34"></path>
<polygon fill="black" stroke="black" points="210.31,-282.34 206.81,-272.34 203.31,-282.34 210.31,-282.34"></polygon>
</g><!-- C -->
<g id="node4" class="node">
<title>C</title>
<polygon fill="none" stroke="black" points="251.63,-197.8 0,-197.8 0,-161.8 251.63,-161.8 251.63,-197.8"></polygon>
<text xml:space="preserve" text-anchor="middle" x="125.81" y="-175.6" font-family="Times,serif" font-size="14.00">Only keep first n bits in IP, zero other bits</text>
</g><!-- B&#45;&gt;C -->
<g id="edge3" class="edge">
<title>B->C</title>
<path fill="none" stroke="black" d="M187.21,-234.61C177.23,-225.87 164.93,-215.08 153.96,-205.47"></path>
<polygon fill="black" stroke="black" points="156.49,-203.03 146.66,-199.07 151.87,-208.3 156.49,-203.03"></polygon>
</g><!-- D -->
<g id="node5" class="node">
<title>D</title>
<polygon fill="none" stroke="black" points="206.81,-124.8 91.84,-106.8 206.81,-88.8 321.79,-106.8 206.81,-124.8"></polygon>
<text xml:space="preserve" text-anchor="middle" x="206.81" y="-102.6" font-family="Times,serif" font-size="14.00">IP/size file exists?</text>
</g><!-- C&#45;&gt;D -->
<g id="edge4" class="edge">
<title>C->D</title>
<path fill="none" stroke="black" d="M145.42,-161.61C156.32,-152.06 169.99,-140.08 181.66,-129.85"></path>
<polygon fill="black" stroke="black" points="183.77,-132.65 188.98,-123.43 179.16,-127.39 183.77,-132.65"></polygon>
</g><!-- D&#45;&gt;B -->
<g id="edge6" class="edge">
<title>D->B</title>
<path fill="none" stroke="black" d="M227.56,-121.94C239.75,-131.57 254.07,-145.51 260.81,-161.8 266.94,-176.58 266.94,-183.02 260.81,-197.8 256.29,-208.73 248.35,-218.61 239.94,-226.83"></path>
<polygon fill="black" stroke="black" points="237.66,-224.16 232.59,-233.47 242.36,-229.36 237.66,-224.16"></polygon>
<text xml:space="preserve" text-anchor="middle" x="273.96" y="-175.6" font-family="Times,serif" font-size="14.00">No</text>
</g><!-- E -->
<g id="node6" class="node">
<title>E</title>
<polygon fill="none" stroke="black" points="270.02,-36 143.61,-36 143.61,0 270.02,0 270.02,-36"></polygon>
<text xml:space="preserve" text-anchor="middle" x="206.81" y="-13.8" font-family="Times,serif" font-size="14.00">Return file contents</text>
</g><!-- D&#45;&gt;E -->
<g id="edge5" class="edge">
<title>D->E</title>
<path fill="none" stroke="black" d="M206.81,-88.65C206.81,-76.96 206.81,-61.19 206.81,-47.62"></path>
<polygon fill="black" stroke="black" points="210.31,-47.92 206.81,-37.92 203.31,-47.92 210.31,-47.92"></polygon>
<text xml:space="preserve" text-anchor="middle" x="217.7" y="-58.2" font-family="Times,serif" font-size="14.00">Yes</text>
</g>
</g>
</svg>
</p>
<p>In other words, we're bruteforcing from /32, /31, and so on, until we got the
target. This is not an efficient approach, but what's good is that it doesn't
need any preprocessing or caching on the registry data.</p>
<p>The code is available at
<a href="https://gist.github.com/xddxdd/53efacf5b750c0f38759beff8e7b070d" rel="noopener noreferrer" target="_blank">this GitHub Gist</a>.</p>
<h2 id="final-effects">Final Effects</h2>
<p>My WHOIS server is deployed to <a href="/en/page/dn42/">all my DN42 nodes</a>, which can be
queried over either the Internet or DN42:</p>
<pre class="shiki shiki-themes dark-plus light-plus" style="--shiki-dark:#D4D4D4;--shiki-light:#000000;--shiki-dark-bg:#1E1E1E;--shiki-light-bg:#FFFFFF" tabindex="0"><code><span class="line"><span style="--shiki-dark:#6A9955;--shiki-light:#008000"># User command input</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">whois</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -h</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 185.186.147.110</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "172.22.76.185"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A9955;--shiki-light:#008000"># Returned WHOIS results</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">%</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Lan</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Tian</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Nginx-based</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> WHOIS</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Server</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Lua</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Logic</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">%</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> GET</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /172.22.76.185</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">inetnum:</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658">            172.22.76.184</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> -</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 172.22.76.191</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">netname:</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">            LANTIAN-IPV4</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">descr:</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">              Lan</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Tian's IP space</span></span>
<span class="line"><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">remarks:            My network is open to peering; see https://lantian.pub/page/dn42</span></span>
<span class="line"><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">remarks:            or directly contact me at dn42@lantian.pub</span></span>
<span class="line"><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">country:            CN</span></span>
<span class="line"><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"># Snip</span></span></code></pre>
<p>You may have a try yourself, to lookup DN42 IPs, domains, and users with the
WHOIS server.</p>  </div>  <div class="clearfix" id="post-navi" data-astro-cid-gfbmwgei=""> <div class="float-end text-end" data-astro-cid-gfbmwgei=""> <a href="/en/article/modify-website/serve-gopher-with-nginx.lantian/" title="Setting up Gopher Site with Nginx" data-astro-cid-gfbmwgei=""> Setting up Gopher Site with Nginx </a> <br data-astro-cid-gfbmwgei=""> Next post »
</div> <div class="float-start text-start position-absolute" data-astro-cid-gfbmwgei="">
« Previous post <br data-astro-cid-gfbmwgei=""> <a href="/en/article/modify-website/dn42-experimental-network-2020.lantian/" title="DN42 Experimental Network: Intro and Registration (Updated 2022-12)" data-astro-cid-gfbmwgei=""> DN42 Experimental Network: Intro and Registration (Updated 2022-12) </a> </div> </div>  <div id="waline" data-waline-language="en-US" data-waline-path="/en/article/modify-website/serve-dn42-whois-with-nginx.lantian"></div> <script type="module" src="/assets/WalineComment.astro_astro_type_script_index_0_lang.Dqib3X1E.js"></script>  </div> </div> </article>  </div> <aside class="d-none d-xl-block"> <section class="widget"> <h3>Latest posts</h3> <ul class="list-unstyled"> <li> 07-20  <a href="/en/article/modify-computer/legal-lte-network-at-home-with-open5gs.lantian/">Legal LTE Network at Home with Open5GS</a> </li><li> 06-27  <a href="/en/article/modify-computer/sidestore-without-stosvpn-across-lan.lantian/">Using SideStore without StosVPN across your LAN</a> </li><li> 05-19  <a href="/en/article/modify-computer/nix-logarithmetic-math-library-from-zero.lantian/">Nix Logarithmic Math Library from Ground Zero</a> </li><li> 04-06  <a href="/en/article/modify-computer/legal-lte-network-at-home-for-100-bucks.lantian/">Legal LTE Network at Home for $100</a> </li><li> 02-10  <a href="/en/article/modify-computer/build-custom-android-kernel-with-nix.lantian/">Building Custom Android Kernel with Nix</a> </li><li> 04-20  <a href="/en/article/modify-website/migrate-blog-to-astro-js.lantian/">Migrating My Blog to Astro.js</a> </li><li> 12-16  <a href="/en/article/modify-computer/nixos-low-ram-vps.lantian/">NixOS Series 5: Creating Disk Image for Low RAM VPS</a> </li><li> 09-20  <a href="/en/article/modify-computer/nix-trigonometric-math-library-from-zero.lantian/">Nix Trigonometric Math Library from Ground Zero</a> </li><li> 05-29  <a href="/en/article/random-notes/pipewire-sigkill-fix.lantian/">Preventing Pipewire from being SIGKILLed</a> </li><li> 05-12  <a href="/en/article/modify-website/how-to-kill-the-dn42-network.lantian/">How to Kill the DN42 Network (Updated 2023-05-12)</a> </li><li> 05-08  <a href="/en/article/modify-computer/laptop-muxed-nvidia-passthrough.lantian/">NVIDIA GPU Passthrough on an Optimus MUXed Laptop (Updated 2023-05)</a> </li><li> 04-17  <a href="/en/article/random-notes/fix-china-telecom-roaming-no-4g-on-aosp-rom.lantian/">Fix China Telecom 4G Roaming on AOSP ROM by Changing APN</a> </li><li> 03-26  <a href="/en/article/random-notes/old-hp-workstation-as-all-in-one.lantian/">Notes on Setting Up NAS+Router on Old HP Workstation</a> </li><li> 01-14  <a href="/en/article/modify-computer/nixos-impermanence.lantian/">NixOS Series 4: &quot;Stateless&quot; Operating System</a> </li><li> 06-21  <a href="/en/article/modify-computer/nixos-packaging.lantian/">NixOS Series 3: Software Packaging 101</a> </li> </ul> </section> <section class="widget"> <h3>Latest comments</h3> <ul class="list-unstyled" id="recent-comments">  <li><a href="#">Loading...</a></li>  </ul> </section> <script type="module">const i=window.location.hostname=="localhost"?"https://comments.lantian.pub":window.location.origin;fetch(`${i}/api/comment?type=recent&count=10`).then(t=>{if(t.status!==200)throw new Error(`Server returned bad HTTP status ${t.status}`);return t.json()}).then(t=>{const e=document.getElementById("recent-comments");e&&(e.innerHTML=t.data.map(n=>{const o=n.comment.replace(/(<([^>]+)>)/gi,"");return"<li>"+n.nick+' <a href="'+n.url+'">'+o+"</a></li>"}).join(""))});</script> <section class="widget"> <h3>Others</h3> <ul class="list-unstyled">  <li> <i class="fas fa-fw fa-rss"></i>  <a href="/rss2.xml" target="_blank">RSS Feed</a> |  <a href="/feed.xml" target="_blank">Atom</a> |  <a href="/feed.json" target="_blank">JSON</a> </li> <li> <i class="fas fa-fw fa-globe"></i>  <a href="https://stats.uptimerobot.com/BLK6VsRkR" target="_blank"> Sever Status </a> </li> <li> <i class="fas fa-fw fa-sitemap"></i>  <a href="https://lg.lantian.pub" target="_blank">DN42 Looking Glass</a> </li> <li> <i class="fas fa-fw fa-link"></i>  <a href="gopher://lantian.pub" target="_blank">Access with Gopher protocol</a> </li>  </ul> </section> <section class="widget"> <h3>Links</h3> <ul class="list-unstyled"> <li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://0x7f.cc"> 0x7f Blog 🐑 </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="http://foreverblog.cn"> 10 Year&#39;s Promise (Forever Blog) </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://alanyhq.com"> Alanyhq </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://blog.baoshuo.ren/?utm_source=friends"> Baoshuo&#39;s Blog </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://blog.cas7.moe"> Blog of Moecast </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://jerryxiao.cc"> JerryXiao </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://sangsir.com"> SangSir </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://snli.org"> Shucheng Li </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://yuetau.net"> YuetAu&#39;s Spot </a> </li> </ul> </section> </aside> </div> <footer class="lantian clearfix" data-astro-cid-w3csb3e3="">  <div id="copyright" class="float-end text-end" data-astro-cid-w3csb3e3=""> <i class="fas fa-copyright" data-astro-cid-w3csb3e3=""></i> 2012-2025 Lan Tian @ Blog<br data-astro-cid-w3csb3e3=""> <small data-astro-cid-w3csb3e3=""> Powered by Astro v5.15.1 @ 2025-10-25 23:46:38 </small> </div> <script type="module">function v(c,o,r){const h=/^localhost$|^127(?:\.[0-9]+){0,2}\.[0-9]+$|^(?:0*:)*?:?0*1$/.test(location.hostname)||location.protocol==="file:";if(!o.trackLocalhost&&h)return console.warn("[Plausible] Ignoring event because website is running locally");try{if(window.localStorage.plausible_ignore==="true")return console.warn('[Plausible] Ignoring event because "plausible_ignore" is set to "true" in localStorage')}catch{}const p={n:c,u:o.url,d:o.domain,r:o.referrer,w:o.deviceWidth,h:o.hashMode?1:0,p:r&&r.props?JSON.stringify(r.props):void 0},s=new XMLHttpRequest;s.open("POST",`${o.apiHost}/api/event`,!0),s.setRequestHeader("Content-Type","text/plain"),s.send(JSON.stringify(p)),s.onreadystatechange=()=>{s.readyState===4&&r&&r.callback&&r.callback()}}function b(c){const o=()=>({hashMode:!1,trackLocalhost:!1,url:location.href,domain:location.hostname,referrer:document.referrer||null,deviceWidth:window.innerWidth,apiHost:"https://plausible.io",...c}),r=(t,n,i)=>{v(t,{...o(),...i},n)},h=(t,n)=>{r("pageview",n,t)};return{trackEvent:r,trackPageview:h,enableAutoPageviews:()=>{const t=()=>h(),n=history.pushState;return n&&(history.pushState=function(i,l,u){n.apply(this,[i,l,u]),t()},addEventListener("popstate",t)),c&&c.hashMode&&addEventListener("hashchange",t),h(),function(){n&&(history.pushState=n,removeEventListener("popstate",t)),c&&c.hashMode&&removeEventListener("hashchange",t)}},enableAutoOutboundTracking:(t=document,n={subtree:!0,childList:!0,attributes:!0,attributeFilter:["href"]})=>{function i(e){r("Outbound Link: Click",{props:{url:this.href}}),typeof process<"u"&&process,setTimeout(()=>{location.href=this.href},150),e.preventDefault()}const l=new Set;function u(e){e instanceof HTMLAnchorElement?e.host!==location.host&&(e.addEventListener("click",i),l.add(e)):"querySelectorAll"in e&&e.querySelectorAll("a").forEach(u)}function f(e){e instanceof HTMLAnchorElement?(e.removeEventListener("click",i),l.delete(e)):"querySelectorAll"in e&&e.querySelectorAll("a").forEach(f)}const d=new MutationObserver(e=>{e.forEach(a=>{a.type==="attributes"?(f(a.target),u(a.target)):a.type==="childList"&&(a.addedNodes.forEach(u),a.removedNodes.forEach(f))})});return t.querySelectorAll("a").forEach(u),d.observe(t,n),function(){l.forEach(a=>{a.removeEventListener("click",i)}),l.clear(),d.disconnect()}}}}const g=b({domain:"lantian.pub",trackLocalhost:!0,apiHost:""});g.trackPageview();</script> </footer>  </div>  </body> </html>