<!DOCTYPE html><html lang="en-US" itemscope="" itemtype="https://schema.org/Article" data-astro-cid-porej7z2=""> <head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Running Anycast DNS with Docker in DN42 - Lan Tian @ Blog</title><script>
  ;(() => {
    try {
      const mode = localStorage.getItem('user-color-scheme')
      if (mode == 'dark' || mode == 'light') {
        document.documentElement.setAttribute('data-user-color-scheme', mode)
      }
    } catch {
      // Ignore errors
    }
  })()
</script><link rel="stylesheet" href="/assets/index.CUlf1-Vz.css"><style>#post-navi[data-astro-cid-gfbmwgei]{padding:5px;border-top:1px solid var(--lt-border-weak);border-bottom:1px solid var(--lt-border-weak)}
ol[data-astro-cid-nj3qel45]{margin:0;padding:0;line-height:1.5}ol[data-astro-cid-nj3qel45] .toc-item[data-astro-cid-nj3qel45]{list-style:none}ol[data-astro-cid-nj3qel45] .toc-child[data-astro-cid-nj3qel45],ol[data-astro-cid-nj3qel45] .toc[data-astro-cid-nj3qel45]{padding:0}ol[data-astro-cid-nj3qel45] .toc-link[data-astro-cid-nj3qel45]{display:block;margin-left:1em;padding:.25em 0}ol[data-astro-cid-nj3qel45] .toc-level-1[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-2[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-3[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-4[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-5[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-6[data-astro-cid-nj3qel45]:before{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;width:1em;padding:.25em 0;float:left;font-style:normal;font-variant:normal;font-weight:900;font-family:Font Awesome\ 6 Free;font-feature-settings:normal;text-align:center}ol[data-astro-cid-nj3qel45] .toc-level-1[data-astro-cid-nj3qel45]:before{content:""}ol[data-astro-cid-nj3qel45] .toc-level-2[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-3[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-4[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-5[data-astro-cid-nj3qel45]:before,ol[data-astro-cid-nj3qel45] .toc-level-6[data-astro-cid-nj3qel45]:before{content:""}.post-info-wrap[data-astro-cid-dckccua4]{-ms-flex:0 0 2.5em;flex:0 0 2.5em;background-color:var(--lt-component-bg-emphasis)}@media(min-width:768px){.post-info[data-astro-cid-dckccua4]{position:sticky;top:0}}@media(max-width:767.98px){.post-info[data-astro-cid-dckccua4]{position:absolute}}
</style><script type="module" src="/assets/PageLayout.astro_astro_type_script_index_0_lang.C1wfUPs6.js"></script><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta http-equiv="Referrer-Policy" content="no-referrer, strict-origin-when-cross-origin"><meta name="renderer" content="webkit|ie-comp|ie-stand"><meta name="imagemode" content="force"><meta name="nightmode" content="disable"><meta name="wap-font-scale" content="no"><meta name="title" content="Running Anycast DNS with Docker in DN42 - Lan Tian @ Blog"><meta name="keywords" content=""><meta name="author" content="Lan Tian"><link rel="canonical" href="https://lantian.pub/en/article/modify-website/dn42-docker-anycast-dns.lantian/"><link rel="alternate" type="application/rss+xml" title="Lan Tian @ Blog" href="https://lantian.pub/rss2.xml"><link rel="alternate" type="application/atom+xml" title="Lan Tian @ Blog" href="https://lantian.pub/feed.xml"><link rel="alternate" href="https://lantian.pub/article/modify-website/dn42-docker-anycast-dns.lantian/" hreflang="zh"><link rel="alternate" href="https://lantian.pub/en/article/modify-website/dn42-docker-anycast-dns.lantian/" hreflang="en"><meta name="copyright" content="Copyright 2012-2025 Lan Tian @ Blog"><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="48x48" href="/favicon-48x48.png"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="manifest" href="/manifest.webmanifest"><meta name="mobile-web-app-capable" content="yes"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#03a9f4"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#212121"><meta name="application-name" content="Lan Tian @ Blog"><link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="167x167" href="/apple-touch-icon-167x167.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png"><link rel="apple-touch-icon" sizes="1024x1024" href="/apple-touch-icon-1024x1024.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-precomposed.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#03a9f4"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-title" content="Lan Tian @ Blog"><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-640x1136.png"><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-1136x640.png"><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-750x1334.png"><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-1334x750.png"><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1125x2436.png"><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2436x1125.png"><link rel="apple-touch-startup-image" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1170x2532.png"><link rel="apple-touch-startup-image" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2532x1170.png"><link rel="apple-touch-startup-image" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1179x2556.png"><link rel="apple-touch-startup-image" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2556x1179.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-828x1792.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-1792x828.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1242x2688.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2688x1242.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1242x2208.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2208x1242.png"><link rel="apple-touch-startup-image" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1284x2778.png"><link rel="apple-touch-startup-image" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2778x1284.png"><link rel="apple-touch-startup-image" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1290x2796.png"><link rel="apple-touch-startup-image" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2796x1290.png"><link rel="apple-touch-startup-image" media="(device-width: 744px) and (device-height: 1133px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1488x2266.png"><link rel="apple-touch-startup-image" media="(device-width: 744px) and (device-height: 1133px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2266x1488.png"><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1536x2048.png"><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2048x1536.png"><link rel="apple-touch-startup-image" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1620x2160.png"><link rel="apple-touch-startup-image" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2160x1620.png"><link rel="apple-touch-startup-image" media="(device-width: 820px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1640x2160.png"><link rel="apple-touch-startup-image" media="(device-width: 820px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2160x1640.png"><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1668x2388.png"><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2388x1668.png"><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1668x2224.png"><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2224x1668.png"><link rel="apple-touch-startup-image" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-2048x2732.png"><link rel="apple-touch-startup-image" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2732x2048.png"><meta name="msapplication-TileColor" content="#bbdefb"><meta name="msapplication-TileImage" content="/mstile-144x144.png"><meta name="msapplication-config" content="/browserconfig.xml"><link rel="yandex-tableau-widget" href="/yandex-browser-manifest.json"><meta property="og:url" content="https://lantian.pub/en/article/modify-website/dn42-docker-anycast-dns.lantian/"><meta property="og:type" content="website"><meta property="og:title" content="Running Anycast DNS with Docker in DN42 - Lan Tian @ Blog"><meta property="og:image" content="https://lantian.pub/apple-touch-icon.png"><meta content="2020-03-16 Notes There is an updated scheme compared to this post, see Sharing Network Namespace Among Docker Containers for Bird Anycasting . It is suggested to read only the concept explanations in this post, and use the above scheme instead for deployment. What's Anycast The commonly used routing protocol on Internet, the BGP, works like this: I own an IP range, 172.22.76.104/29, on DN42. With a BGP software like BIRD, I &#34;announce&#34; that my server has access to IP range 172.22.76.104/29. Servers with peering to me will record this message: &#34;Over this path, I can access 172.22.76.104/29 which is 1 step away.&#34; These servers continue to announce to others with peering to them: &#34;This server is 1 step away from the source of 172.22.76.104/29.&#34; Similarly,..."><meta property="og:site_name" content="Lan Tian @ Blog"><meta property="og:locale" content="en"><meta name="twitter:card" content="summary"><meta name="twitter:url" content="https://lantian.pub/en/article/modify-website/dn42-docker-anycast-dns.lantian/"><meta name="twitter:title" content="Running Anycast DNS with Docker in DN42 - Lan Tian @ Blog"><meta property="twitter:image" content="https://lantian.pub/apple-touch-icon.png"><meta content="2020-03-16 Notes There is an updated scheme compared to this post, see Sharing Network Namespace Among Docker Containers for Bird Anycasting . It is suggested to read only the concept explanations in this post, and use the above scheme instead for deployment. What's Anycast The commonly used routing protocol on Internet, the BGP, works like this: I own an IP range, 172.22.76.104/29, on DN42. With a BGP software like BIRD, I &#34;announce&#34; that my server has access to IP range 172.22.76.104/29. Servers with peering to me will record this message: &#34;Over this path, I can access 172.22.76.104/29 which is 1 step away.&#34; These servers continue to announce to others with peering to them: &#34;This server is 1 step away from the source of 172.22.76.104/29.&#34; Similarly,..."><meta name="twitter:dnt" content="on"><meta itemprop="name" content="Running Anycast DNS with Docker in DN42 - Lan Tian @ Blog"><meta property="image" content="https://lantian.pub/apple-touch-icon.png"><meta content="2020-03-16 Notes There is an updated scheme compared to this post, see Sharing Network Namespace Among Docker Containers for Bird Anycasting . It is suggested to read only the concept explanations in this post, and use the above scheme instead for deployment. What's Anycast The commonly used routing protocol on Internet, the BGP, works like this: I own an IP range, 172.22.76.104/29, on DN42. With a BGP software like BIRD, I &#34;announce&#34; that my server has access to IP range 172.22.76.104/29. Servers with peering to me will record this message: &#34;Over this path, I can access 172.22.76.104/29 which is 1 step away.&#34; These servers continue to announce to others with peering to them: &#34;This server is 1 step away from the source of 172.22.76.104/29.&#34; Similarly,..."><meta content="2020-03-16 Notes There is an updated scheme compared to this post, see Sharing Network Namespace Among Docker Containers for Bird Anycasting . It is suggested to read only the concept explanations in this post, and use the above scheme instead for deployment. What's Anycast The commonly used routing protocol on Internet, the BGP, works like this: I own an IP range, 172.22.76.104/29, on DN42. With a BGP software like BIRD, I &#34;announce&#34; that my server has access to IP range 172.22.76.104/29. Servers with peering to me will record this message: &#34;Over this path, I can access 172.22.76.104/29 which is 1 step away.&#34; These servers continue to announce to others with peering to them: &#34;This server is 1 step away from the source of 172.22.76.104/29.&#34; Similarly,..."><link rel="me" href="https://mastodon.social/@lantian"></head> <body data-astro-cid-porej7z2=""> <div id="bg" data-astro-cid-j6vmxtef=""></div>   <div id="container" class="container" data-astro-cid-porej7z2=""> <nav class="lantian navbar navbar-expand-lg" data-astro-cid-wu5dj4rx=""> <div class="container-fluid" data-astro-cid-wu5dj4rx=""> <a class="navbar-brand" href="/en/" data-astro-cid-wu5dj4rx="">Lan Tian @ Blog</a> <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#lantian-navbar" aria-controls="lantian-navbar" aria-expanded="false" aria-label="Toggle navigation" data-astro-cid-wu5dj4rx=""> <span class="navbar-toggler-icon" data-astro-cid-wu5dj4rx=""></span> </button> <div class="collapse navbar-collapse" id="lantian-navbar" data-astro-cid-wu5dj4rx=""> <ul class="navbar-nav" data-astro-cid-wu5dj4rx=""> <li class="nav-item d-none d-lg-block" data-astro-cid-wu5dj4rx=""> <a class="nav-link" href="/en/page/archive/index.html" data-astro-cid-wu5dj4rx=""> Posts </a> </li><li class="nav-item d-none d-lg-block" data-astro-cid-wu5dj4rx=""> <a class="nav-link" href="/en/page/himawari/index.html" data-astro-cid-wu5dj4rx=""> Himawari </a> </li><li class="nav-item d-none d-lg-block" data-astro-cid-wu5dj4rx=""> <a class="nav-link" href="/en/page/dn42/index.html" data-astro-cid-wu5dj4rx=""> DN42 </a> </li> <li class="nav-item dropdown d-block d-lg-none" data-astro-cid-wu5dj4rx=""> <a href="#" class="nav-link dropdown-toggle" id="pages-dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" data-astro-cid-wu5dj4rx=""> <i class="fas fa-fw fa-file" data-astro-cid-wu5dj4rx=""></i> Page  <span class="caret" data-astro-cid-wu5dj4rx=""></span> </a> <ul class="dropdown-menu" aria-labelledby="pages-dropdown" data-astro-cid-wu5dj4rx=""> <li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item" href="/en/page/archive/index.html" data-astro-cid-wu5dj4rx=""> Posts </a> </li><li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item" href="/en/page/himawari/index.html" data-astro-cid-wu5dj4rx=""> Himawari </a> </li><li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item" href="/en/page/dn42/index.html" data-astro-cid-wu5dj4rx=""> DN42 </a> </li> </ul> </li> </ul> <ul class="navbar-nav ms-auto" data-astro-cid-wu5dj4rx=""> <li class="nav-item dropdown" data-astro-cid-wu5dj4rx=""> <a href="#" class="nav-link dropdown-toggle" id="languages-dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" data-astro-cid-wu5dj4rx=""> <i class="fas fa-fw fa-language" data-astro-cid-wu5dj4rx=""></i> Language <span class="caret" data-astro-cid-wu5dj4rx=""></span> </a> <ul class="dropdown-menu" aria-labelledby="languages-dropdown" data-astro-cid-wu5dj4rx=""> <li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item" href="/article/modify-website/dn42-docker-anycast-dns.lantian/" data-astro-cid-wu5dj4rx=""> <span class="flag-icon flag-icon-cn" data-astro-cid-wu5dj4rx=""></span> Chinese Simplified / 简体中文 </a> </li><li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item active" href="/en/article/modify-website/dn42-docker-anycast-dns.lantian/" data-astro-cid-wu5dj4rx=""> <span class="flag-icon flag-icon-us" data-astro-cid-wu5dj4rx=""></span> English </a> </li> <li data-astro-cid-wu5dj4rx=""><hr class="dropdown-divider" data-astro-cid-wu5dj4rx=""></li> <li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item disabled" href="#" data-astro-cid-wu5dj4rx="">Not all pages have translations.</a> </li> <li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item disabled" href="#" data-astro-cid-wu5dj4rx="">You may see 404 - this is normal.</a> </li> </ul> </li> <li class="nav-item dropdown" data-astro-cid-wu5dj4rx=""> <a href="#" class="nav-link dropdown-toggle" id="color-scheme-dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" data-astro-cid-wu5dj4rx=""> <i class="fas fa-fw fa-adjust" data-astro-cid-wu5dj4rx=""></i> Night Mode </a> <ul class="dropdown-menu" aria-labelledby="color-scheme-dropdown" data-astro-cid-wu5dj4rx=""> <li data-astro-cid-wu5dj4rx=""> <a id="color-scheme-auto" class="dropdown-item" href="#" data-astro-cid-wu5dj4rx=""><i class="fas fa-fw fa-adjust" data-astro-cid-wu5dj4rx=""></i> Auto </a> </li> <li data-astro-cid-wu5dj4rx=""><hr class="dropdown-divider" data-astro-cid-wu5dj4rx=""></li> <li data-astro-cid-wu5dj4rx=""> <a id="color-scheme-light" class="dropdown-item" href="#" data-astro-cid-wu5dj4rx=""><i class="fas fa-fw fa-sun" data-astro-cid-wu5dj4rx=""></i> Light</a> </li> <li data-astro-cid-wu5dj4rx=""> <a id="color-scheme-dark" class="dropdown-item" href="#" data-astro-cid-wu5dj4rx=""><i class="fas fa-fw fa-moon" data-astro-cid-wu5dj4rx=""></i> Dark</a> </li> </ul> </li> </ul> </div> </div> </nav> <script type="module">const m="user-color-scheme",s="data-user-color-scheme",u=(e,t)=>{try{localStorage.setItem(e,t)}catch{}},i=e=>{try{return localStorage.getItem(e)}catch{return null}},c=e=>{const t={dark:!0,light:!0,auto:!0},o=e===null||!Object.keys(t).includes(e)?"auto":e;u(m,o);for(const l in t){const n=document.getElementById("color-scheme-"+l);n&&(l==o?n.classList.add("active"):n.classList.remove("active"))}o!="auto"?document.documentElement.setAttribute(s,o):document.documentElement.removeAttribute(s)};c(i(m));const r=document.getElementById("color-scheme-auto");r&&r.addEventListener("click",()=>c("auto"));const a=document.getElementById("color-scheme-light");a&&a.addEventListener("click",()=>c("light"));const d=document.getElementById("color-scheme-dark");d&&d.addEventListener("click",()=>c("dark"));</script>  <div class="d-flex" data-astro-cid-porej7z2=""> <div id="content" data-astro-cid-porej7z2="">  <article> <div class="d-flex"> <div class="post-info-wrap" data-astro-cid-dckccua4=""> <div class="post-info" data-astro-cid-dckccua4=""> <div class="post-meta-wrap"> <div class="post-meta"> <p> <span class="fas fa-clock"></span> <br> <small>03-14</small> </p> <div class="post-meta-value"> Published on<span class="badge badge-tag" data-astro-cid-dckccua4=""> 2019-03-14 22:54 </span>  </div> </div> </div> <div class="post-meta-wrap"> <div class="post-meta"> <p> <span class="fas fa-file-alt"></span> <br> <small>Website and Servers</small> </p> <div class="post-meta-value"> Category <a class="badge badge-tag" href="/en/category/modify-website" data-astro-cid-dckccua4=""> Website and Servers </a>  </div> </div> </div> <div class="post-meta-wrap"> <div class="post-meta"> <p> <span class="fas fa-tag"></span> <br> <small>3 tags</small> </p> <div class="post-meta-value"> Tags  <a class="badge badge-tag" href="/en/tag/DN42" data-astro-cid-dckccua4=""> DN42 </a>  <a class="badge badge-tag" href="/en/tag/Anycast" data-astro-cid-dckccua4=""> Anycast </a>  <a class="badge badge-tag" href="/en/tag/BGP" data-astro-cid-dckccua4=""> BGP </a>  </div> </div> </div> <div class="post-meta-wrap"> <div class="post-meta"> <p> <span class="fas fa-list"></span> <br> <small>ToC</small> </p> <div class="post-meta-value">  <ol data-astro-cid-nj3qel45=""> <li class="toc-item toc-level-2" data-astro-cid-nj3qel45=""> <a class="toc-link" href="#2020-03-16-notes" data-astro-cid-nj3qel45=""> <span class="toc-text" data-astro-cid-nj3qel45="">2020-03-16 Notes</span> </a> </li><li class="toc-item toc-level-2" data-astro-cid-nj3qel45=""> <a class="toc-link" href="#whats-anycast" data-astro-cid-nj3qel45=""> <span class="toc-text" data-astro-cid-nj3qel45="">What&#39;s Anycast</span> </a> </li><li class="toc-item toc-level-2" data-astro-cid-nj3qel45=""> <a class="toc-link" href="#what-im-trying-to-achieve" data-astro-cid-nj3qel45=""> <span class="toc-text" data-astro-cid-nj3qel45="">What I&#39;m Trying to Achieve</span> </a> </li><li class="toc-item toc-level-2" data-astro-cid-nj3qel45=""> <a class="toc-link" href="#problems-with-existing-solutions" data-astro-cid-nj3qel45=""> <span class="toc-text" data-astro-cid-nj3qel45="">Problems with Existing Solutions</span> </a> </li><li class="toc-item toc-level-2" data-astro-cid-nj3qel45=""> <a class="toc-link" href="#adding-ips-to-containers" data-astro-cid-nj3qel45=""> <span class="toc-text" data-astro-cid-nj3qel45="">Adding IPs to Containers</span> </a> </li><li class="toc-item toc-level-2" data-astro-cid-nj3qel45=""> <a class="toc-link" href="#announcing-ip-from-containers" data-astro-cid-nj3qel45=""> <span class="toc-text" data-astro-cid-nj3qel45="">Announcing IP from Containers</span> </a> </li><li class="toc-item toc-level-2" data-astro-cid-nj3qel45=""> <a class="toc-link" href="#dn42-demonstrations" data-astro-cid-nj3qel45=""> <span class="toc-text" data-astro-cid-nj3qel45="">DN42 Demonstrations</span> </a> </li> </ol>   </div> </div> </div> </div>  </div>  <div class="post-wrap">  <h1 class="post-title"> <a href="/en/article/modify-website/dn42-docker-anycast-dns.lantian/" rel="bookmark" title="Running Anycast DNS with Docker in DN42">Running Anycast DNS with Docker in DN42</a> </h1> <div class="post-text">   <h2 id="2020-03-16-notes">2020-03-16 Notes</h2>
<p>There is an updated scheme compared to this post, see
<a href="/en/article/modify-website/docker-share-network-namespace-bird-high-availability.lantian">Sharing Network Namespace Among Docker Containers for Bird Anycasting</a>.</p>
<p>It is suggested to read only the concept explanations in this post, and use the
above scheme instead for deployment.</p>
<hr>
<h2 id="whats-anycast">What's Anycast</h2>
<p>The commonly used routing protocol on Internet, the BGP, works like this:</p>
<ul>
<li>I own an IP range, 172.22.76.104/29, on DN42.</li>
<li>With a BGP software like BIRD, I "announce" that my server has access to IP
range 172.22.76.104/29.</li>
<li>Servers with peering to me will record this message: "Over this path, I can
access 172.22.76.104/29 which is 1 step away."</li>
<li>These servers continue to announce to others with peering to them: "This
server is 1 step away from the source of 172.22.76.104/29."</li>
<li>Similarly, other servers announce that they are 2, 3, 4... steps away from
172.22.76.104/29.</li>
<li>All servers will take the shortest route to send data to my server.</li>
</ul>
<p>In this case, only one server is announcing that it's the source for
172.22.76.104/29, which is called Unicast. By contrast, Anycast is announcing
the source of 172.22.76.104/29 on multiple servers (usually in different
locations, such as Hong Kong, Los Angeles, Paris, etc.), while other servers
still count steps to send data to the closest servers. Therefore, visitors in
Mainland China are more likely to hit my Hong Kong server, since usually there
are much fewer steps from Mainland China to Hong Kong compared to other
locations; similarly, German visitors will access my Paris server, and Chicago
users will connect to my Los Angeles server.</p>
<p>(P.S. There are some simplifications done in the previous explanation. Actual
BGP route selection is more complex than that.)</p>
<p>In the config above, all servers are sharing one IP range, and users are
automatically directed to their closest server, without the assistance of client
side software, by simply accessing IPs in the range.</p>
<p>However, Anycast has its limitations: since each server is still independent,
the network connection status is not shared among them. The routing situation on
the Internet changes rapidly, and every user may be redirected to another server
at any time. Since everything happens on the network layer (L3), the application
layer (L7) is unaware of the change. This means that stateful protocols (like
TCP) cannot work reliably. Therefore, Anycast is more commonly used for
stateless services, like DNS.</p>
<h2 id="what-im-trying-to-achieve">What I'm Trying to Achieve</h2>
<ol>
<li>Unifying the IP address of services to ease configuration. For example, I set
the DNS service's IP to 172.18.53.53, and set up Anycast on every server, so
requests will end up in the nearest server. Then, while configuring services
that require DNS, I could simply hard code 172.18.53.53, and copy config
files to every server for mass deployment.</li>
<li>Fast recovery from failures: sometimes, my services, such as DNS, may stop
running on one server for an erroneous config change or an upstream provider
issue. With the DNS stop running on the server, it will stop announcing its
access to the DNS IP. Requests to DNS services are automatically sent to
other servers. Services that are still up won't die together with DNS
anymore.</li>
<li>Lower latency: in DN42, European users can reach my France server, United
States users can reach my Los Angeles server, and Asian users can reach my
Hong Kong server. The latencies are minimized, and therefore the stability is
improved.</li>
</ol>
<p>Extra requirements: I must use Docker for the whole deployment.</p>
<h2 id="problems-with-existing-solutions">Problems with Existing Solutions</h2>
<p>There are some common solutions that all have some shortcomings:</p>
<ol>
<li>Directly assign the IP in the OS and do BGP announcements. When the DNS
service crashes, BGP announcements will still continue, directing external
requests to this server. Since DNS service is dead, it will be unavailable in
the region.</li>
<li>Directly assign the IP in the OS, and use ExaBGP along with monitoring
scripts to withdraw BGP announcements on a service crash. Now while routes
are removed, the IP address will still be present in the OS. If DNS requests
go through this server (even though they're heading for other servers), they
will be handled by this server. Therefore, DNS service will still be down in
the region.</li>
</ol>
<p>In addition, neither of them supports Docker.</p>
<p>As for my final solution, I added IPs in Docker containers, and installed Bird
to communicate with the host Bird instance via OSPF, to do the announcements. If
the container crashed, the announcement will automatically stop. As the IP isn't
configured on the host OS, it will forward the packets correctly, instead of
stopping them halfway.</p>
<h2 id="adding-ips-to-containers">Adding IPs to Containers</h2>
<p>Docker's default network driver, <code>bridge</code>, creates a virtual network card on the
host OS, adds an IP block, and routes relevant traffic to them. But if I take
this approach, there will always be a route to send relevant traffic to the
virtual card, causing request loss during downtime. Therefore, I need a network
isolated from the host OS.</p>
<p>An isolated network can be created with Docker's <code>macvlan</code> driver, with
<code>internal</code> option enabled.</p>
<pre class="shiki shiki-themes dark-plus light-plus" style="--shiki-dark:#D4D4D4;--shiki-light:#000000;--shiki-dark-bg:#1E1E1E;--shiki-light-bg:#FFFFFF" tabindex="0"><code><span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">networks:</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">  anycast_ip:</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">    driver: macvlan</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">    internal: true</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">    enable_ipv6: true</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">    ipam:</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">      config:</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">        - subnet: 172.22.76.104/29</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">        - subnet: fdbc:f9dc:67ad:2547::/64</span></span></code></pre>
<p>This network is only responsible for adding IPs, and containers still access the
network via Docker's default bridge network. Therefore, containers need to be
configured like:</p>
<pre class="shiki shiki-themes dark-plus light-plus" style="--shiki-dark:#D4D4D4;--shiki-light:#000000;--shiki-dark-bg:#1E1E1E;--shiki-light-bg:#FFFFFF" tabindex="0"><code><span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">services:</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">  dnsmasq:</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">    image: xddxdd/dnsmasq-bird</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">    [...]</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">    networks:</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">      default:</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">        ipv4_address: 172.18.1.53</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">        ipv6_address: fcf9:a876:ed8b:c606:ba01::53</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">      anycast_ip:</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">        ipv4_address: 172.22.76.110</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">        ipv6_address: fdbc:f9dc:67ad:2547::53</span></span></code></pre>
<p>In the example above, 172.18.1.53 is the container's IP in <code>bridge</code> network, and
172.22.76.110 is the container's Anycast IP address.</p>
<p>Once we start the container, we can check that the container indeed has two IPs:</p>
<pre class="shiki shiki-themes dark-plus light-plus" style="--shiki-dark:#D4D4D4;--shiki-light:#000000;--shiki-dark-bg:#1E1E1E;--shiki-light-bg:#FFFFFF" tabindex="0"><code><span class="line"><span style="--shiki-dark:#6A9955;--shiki-light:#008000"># docker exec -it dnsmasq ip addr</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">[...]</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">391:</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> eth1@if302:</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> &#x3C;</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">BROADCAST,MULTICAST,UP,LOWER_UP,M-DOW</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">N> </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">mtu</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 1500</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> qdisc</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> noqueue</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> state</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> UP</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">    link/ether</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> 02:42:ac:16:4c:6e</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> brd</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> ff:ff:ff:ff:ff:ff</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">    inet</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> 172.22.76.110/29</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> brd</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 172.22.76.111</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> scope</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> global</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> eth1</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">       valid_lft</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> forever</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> preferred_lft</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> forever</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">    inet6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> fdbc:f9dc:67ad:2547::53/64</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> scope</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> global</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> flags</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 02</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">       valid_lft</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> forever</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> preferred_lft</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> forever</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">392:</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> eth0@if393:</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> &#x3C;</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">BROADCAST,MULTICAST,UP,LOWER_UP,M-DOW</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">N> </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">mtu</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 1500</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> qdisc</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> noqueue</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> state</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> UP</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">    link/ether</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> 02:42:ac:12:01:35</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> brd</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> ff:ff:ff:ff:ff:ff</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">    inet</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> 172.18.1.53/24</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> brd</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 172.18.1.255</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> scope</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> global</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> eth0</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">       valid_lft</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> forever</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> preferred_lft</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> forever</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">    inet6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> fcf9:a876:ed8b:c606:ba01::53/80</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> scope</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> global</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> flags</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 02</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">       valid_lft</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> forever</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> preferred_lft</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> forever</span></span></code></pre>
<p>And the container will still use the <code>bridge</code> network by default, thus not
affecting network access:</p>
<pre class="shiki shiki-themes dark-plus light-plus" style="--shiki-dark:#D4D4D4;--shiki-light:#000000;--shiki-dark-bg:#1E1E1E;--shiki-light-bg:#FFFFFF" tabindex="0"><code><span class="line"><span style="--shiki-dark:#6A9955;--shiki-light:#008000"># docker exec -it dnsmasq ip route</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">default</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> via</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 172.18.1.1</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> dev</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> eth0</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">172.18.1.0/24</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> dev</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> eth0</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> scope</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> link</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">  src</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 172.18.1.53</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">172.22.76.104/29</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> dev</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> eth1</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> scope</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> link</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">  src</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 172.22.76.110</span></span></code></pre>
<h2 id="announcing-ip-from-containers">Announcing IP from Containers</h2>
<p>The next step is installing Bird and announcing owned IPs. An example of
Dockerfile can be seen in <a href="https://github.com/xddxdd/dockerfiles/tree/0b36ccecc7f8da33e994a479686bb78e918a969f/dnsmasq-bird" rel="noopener noreferrer" target="_blank">this commit</a>. The changes are mostly relevant to
installing Bird and Supervisord and starting Bird and Dnsmasq with Supervisord.
In addition, put a simple Bird configuration to the container, so it will
announce its IPs via OSPF.</p>
<p>Note that BGP isn't used, since an ASN needs to be manually allocated, which in
addition to complexity, may cause problems if they're assigned incorrectly. But
for OSPF, there is no unique identifiers for each device, so it's easier to
deploy.</p>
<p>The configuration looks like: (Alpine uses Bird 2.0)</p>
<pre class="shiki shiki-themes dark-plus light-plus" style="--shiki-dark:#D4D4D4;--shiki-light:#000000;--shiki-dark-bg:#1E1E1E;--shiki-light-bg:#FFFFFF" tabindex="0"><code><span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">log</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> syslog</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> all</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">protocol</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> device</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> {}</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">protocol</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> ospf</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> {</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">    ipv4</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> {</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        import</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> none</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF">        export</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> all</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">    };</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">    area</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 0.0.0.0</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> {</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        interface</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "eth*"</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> {</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">            type</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> broadcast</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">            cost</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 1</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">            hello</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 2</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">            retransmit</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 2</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">            dead</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> count</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 2</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">        };</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">    };</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">}</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">protocol</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> ospf</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> v3</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> {</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">    ipv6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> {</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        import</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> none</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF">        export</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080"> all</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">    };</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">    area</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 0.0.0.0</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> {</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        interface</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "eth*"</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> {</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">            type</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> broadcast</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">            cost</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 1</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">            hello</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 2</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">            retransmit</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 2</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">            dead</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> count</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 2</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">        };</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">    };</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">include</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "/etc/bird-static.conf"</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span></code></pre>
<p>But with this config alone, Bird only announces routes obtained from the
container itself, or only 172.22.76.104/29. But what we expect is an independent
route for 172.22.76.110/32, so we need a static route in <code>bird-static.conf</code>.
This file is in place so that it can be easily replaced with Volumes.</p>
<pre class="shiki shiki-themes dark-plus light-plus" style="--shiki-dark:#D4D4D4;--shiki-light:#000000;--shiki-dark-bg:#1E1E1E;--shiki-light-bg:#FFFFFF" tabindex="0"><code><span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">protocol</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> static</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> {</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">    ipv4</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">    route</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> 172.22.76.110/32</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> unreachable</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">protocol</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> static</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> {</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">    ipv6</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">    route</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> fdbc:f9dc:67ad:2547::53/128</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> unreachable</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">}</span></span></code></pre>
<p>This config tells Bird to announce these two IPs on every network card via OSPF.</p>
<p>Then, add OSPF protocol to Bird's host OS: (Host OS is using Bird 1.6)</p>
<pre class="shiki shiki-themes dark-plus light-plus" style="--shiki-dark:#D4D4D4;--shiki-light:#000000;--shiki-dark-bg:#1E1E1E;--shiki-light-bg:#FFFFFF" tabindex="0"><code><span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">protocol</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> ospf</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> lt_docker_ospf</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> {</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">    tick</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 2</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">    rfc1583compat</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> yes</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">    area</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 0.0.0.0</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> {</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        interface</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "docker*"</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> {</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        type</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> broadcast</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        cost</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 1</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        hello</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 2</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        retransmit</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 2</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        dead</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> count</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 2</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">        };</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        interface</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "ltnet"</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> {</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        type</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> broadcast</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        cost</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 1</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        hello</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 2</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        retransmit</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 2</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        dead</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> count</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 2</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">;</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">        };</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">    };</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">}</span></span></code></pre>
<p>Don't forget to add <code>NET_ADMIN</code> capability to the container, or Bird cannot
establish OSPF connection correctly:</p>
<pre class="shiki shiki-themes dark-plus light-plus" style="--shiki-dark:#D4D4D4;--shiki-light:#000000;--shiki-dark-bg:#1E1E1E;--shiki-light-bg:#FFFFFF" tabindex="0"><code><span class="line"><span style="--shiki-dark:#569CD6;--shiki-light:#800000">  dnsmasq</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">:</span></span>
<span class="line"><span style="--shiki-dark:#569CD6;--shiki-light:#800000">    image</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">: </span><span style="--shiki-dark:#CE9178;--shiki-light:#0000FF">xddxdd/dnsmasq-bird</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">    [</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658">...</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">]</span></span>
<span class="line"><span style="--shiki-dark:#569CD6;--shiki-light:#800000">    cap_add</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">:</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">      - </span><span style="--shiki-dark:#CE9178;--shiki-light:#0000FF">NET_ADMIN</span></span></code></pre>
<p>Then the host OS can see announcements from the containers:</p>
<pre class="shiki shiki-themes dark-plus light-plus" style="--shiki-dark:#D4D4D4;--shiki-light:#000000;--shiki-dark-bg:#1E1E1E;--shiki-light-bg:#FFFFFF" tabindex="0"><code><span class="line"><span style="--shiki-dark:#6A9955;--shiki-light:#008000"># birdc show route protocol lt_docker_ospf</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">BIRD</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 1.6.3</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> ready.</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">172.22.76.110/32</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">   via</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 172.18.1.53</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> on</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> ltnet</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [lt_docker_ospf </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">00:00:37]</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> *</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> E2</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> (150/1/10000) [172.18.1.53]</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">172.22.76.109/32</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">   via</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 172.18.1.54</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> on</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> ltnet</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [lt_docker_ospf </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">17:41:06]</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> *</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> E2</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> (150/1/10000) [172.18.1.54]</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">172.22.76.104/29</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">   via</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 172.18.1.54</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> on</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> ltnet</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [lt_docker_ospf </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">01:00:08]</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> *</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> I</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> (150/2) [172.18.1.54]</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">[...]</span></span></code></pre>
<p>Note that the container is still broadcasting the Anycast IP range (which is a
bit hard to filter), but since each Anycast IP generated a <code>/32</code> route that
precedents <code>/29</code> routes, there's no actual impact.</p>
<p>With each server configured identically and peers established between, the host
OS's Bird will announce the container's routes to other servers, so every server
can access the container's services.</p>
<p>When a container is stopped, all traffic will be redirected to another service,
so the service isn't interrupted.</p>
<h2 id="dn42-demonstrations">DN42 Demonstrations</h2>
<p>Currently I have two Anycast services in DN42:</p>
<p>172.22.76.110 - A Dnsmasq-based recursive DNS 172.22.76.109 - A PowerDNS-based
authoritative DNS, for DNS resolution of my IP range and <code>lantian.dn42</code></p>  </div>  <div class="clearfix" id="post-navi" data-astro-cid-gfbmwgei=""> <div class="float-end text-end" data-astro-cid-gfbmwgei=""> <a href="/en/article/modify-website/typecho-performance-optimization.lantian/" title="Typecho Theme Performance Optimization and Caching" data-astro-cid-gfbmwgei=""> Typecho Theme Performance Optimization and Caching </a> <br data-astro-cid-gfbmwgei=""> Next post »
</div> <div class="float-start text-start position-absolute" data-astro-cid-gfbmwgei="">
« Previous post <br data-astro-cid-gfbmwgei=""> <a href="/en/article/modify-computer/cyclone-iv-fpga-development-bugs-resolve.lantian/" title="Cyclone IV FPGA Development Log" data-astro-cid-gfbmwgei=""> Cyclone IV FPGA Development Log </a> </div> </div>  <div id="waline" data-waline-language="en-US" data-waline-path="/en/article/modify-website/dn42-docker-anycast-dns.lantian"></div> <script type="module" src="/assets/WalineComment.astro_astro_type_script_index_0_lang.Dqib3X1E.js"></script>  </div> </div> </article>  </div> <aside class="d-none d-xl-block"> <section class="widget"> <h3>Latest posts</h3> <ul class="list-unstyled"> <li> 07-20  <a href="/en/article/modify-computer/legal-lte-network-at-home-with-open5gs.lantian/">Legal LTE Network at Home with Open5GS</a> </li><li> 06-27  <a href="/en/article/modify-computer/sidestore-without-stosvpn-across-lan.lantian/">Using SideStore without StosVPN across your LAN</a> </li><li> 05-19  <a href="/en/article/modify-computer/nix-logarithmetic-math-library-from-zero.lantian/">Nix Logarithmic Math Library from Ground Zero</a> </li><li> 04-06  <a href="/en/article/modify-computer/legal-lte-network-at-home-for-100-bucks.lantian/">Legal LTE Network at Home for $100</a> </li><li> 02-10  <a href="/en/article/modify-computer/build-custom-android-kernel-with-nix.lantian/">Building Custom Android Kernel with Nix</a> </li><li> 04-20  <a href="/en/article/modify-website/migrate-blog-to-astro-js.lantian/">Migrating My Blog to Astro.js</a> </li><li> 12-16  <a href="/en/article/modify-computer/nixos-low-ram-vps.lantian/">NixOS Series 5: Creating Disk Image for Low RAM VPS</a> </li><li> 09-20  <a href="/en/article/modify-computer/nix-trigonometric-math-library-from-zero.lantian/">Nix Trigonometric Math Library from Ground Zero</a> </li><li> 05-29  <a href="/en/article/random-notes/pipewire-sigkill-fix.lantian/">Preventing Pipewire from being SIGKILLed</a> </li><li> 05-12  <a href="/en/article/modify-website/how-to-kill-the-dn42-network.lantian/">How to Kill the DN42 Network (Updated 2023-05-12)</a> </li><li> 05-08  <a href="/en/article/modify-computer/laptop-muxed-nvidia-passthrough.lantian/">NVIDIA GPU Passthrough on an Optimus MUXed Laptop (Updated 2023-05)</a> </li><li> 04-17  <a href="/en/article/random-notes/fix-china-telecom-roaming-no-4g-on-aosp-rom.lantian/">Fix China Telecom 4G Roaming on AOSP ROM by Changing APN</a> </li><li> 03-26  <a href="/en/article/random-notes/old-hp-workstation-as-all-in-one.lantian/">Notes on Setting Up NAS+Router on Old HP Workstation</a> </li><li> 01-14  <a href="/en/article/modify-computer/nixos-impermanence.lantian/">NixOS Series 4: &quot;Stateless&quot; Operating System</a> </li><li> 06-21  <a href="/en/article/modify-computer/nixos-packaging.lantian/">NixOS Series 3: Software Packaging 101</a> </li> </ul> </section> <section class="widget"> <h3>Latest comments</h3> <ul class="list-unstyled" id="recent-comments">  <li><a href="#">Loading...</a></li>  </ul> </section> <script type="module">const i=window.location.hostname=="localhost"?"https://comments.lantian.pub":window.location.origin;fetch(`${i}/api/comment?type=recent&count=10`).then(t=>{if(t.status!==200)throw new Error(`Server returned bad HTTP status ${t.status}`);return t.json()}).then(t=>{const e=document.getElementById("recent-comments");e&&(e.innerHTML=t.data.map(n=>{const o=n.comment.replace(/(<([^>]+)>)/gi,"");return"<li>"+n.nick+' <a href="'+n.url+'">'+o+"</a></li>"}).join(""))});</script> <section class="widget"> <h3>Others</h3> <ul class="list-unstyled">  <li> <i class="fas fa-fw fa-rss"></i>  <a href="/rss2.xml" target="_blank">RSS Feed</a> |  <a href="/feed.xml" target="_blank">Atom</a> |  <a href="/feed.json" target="_blank">JSON</a> </li> <li> <i class="fas fa-fw fa-globe"></i>  <a href="https://stats.uptimerobot.com/BLK6VsRkR" target="_blank"> Sever Status </a> </li> <li> <i class="fas fa-fw fa-sitemap"></i>  <a href="https://lg.lantian.pub" target="_blank">DN42 Looking Glass</a> </li> <li> <i class="fas fa-fw fa-link"></i>  <a href="gopher://lantian.pub" target="_blank">Access with Gopher protocol</a> </li>  </ul> </section> <section class="widget"> <h3>Links</h3> <ul class="list-unstyled"> <li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://0x7f.cc"> 0x7f Blog 🐑 </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="http://foreverblog.cn"> 10 Year&#39;s Promise (Forever Blog) </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://alanyhq.com"> Alanyhq </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://blog.baoshuo.ren/?utm_source=friends"> Baoshuo&#39;s Blog </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://blog.cas7.moe"> Blog of Moecast </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://jerryxiao.cc"> JerryXiao </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://sangsir.com"> SangSir </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://snli.org"> Shucheng Li </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://yuetau.net"> YuetAu&#39;s Spot </a> </li> </ul> </section> </aside> </div> <footer class="lantian clearfix" data-astro-cid-w3csb3e3="">  <div id="copyright" class="float-end text-end" data-astro-cid-w3csb3e3=""> <i class="fas fa-copyright" data-astro-cid-w3csb3e3=""></i> 2012-2025 Lan Tian @ Blog<br data-astro-cid-w3csb3e3=""> <small data-astro-cid-w3csb3e3=""> Powered by Astro v5.15.1 @ 2025-10-25 23:46:39 </small> </div> <script type="module">function v(c,o,r){const h=/^localhost$|^127(?:\.[0-9]+){0,2}\.[0-9]+$|^(?:0*:)*?:?0*1$/.test(location.hostname)||location.protocol==="file:";if(!o.trackLocalhost&&h)return console.warn("[Plausible] Ignoring event because website is running locally");try{if(window.localStorage.plausible_ignore==="true")return console.warn('[Plausible] Ignoring event because "plausible_ignore" is set to "true" in localStorage')}catch{}const p={n:c,u:o.url,d:o.domain,r:o.referrer,w:o.deviceWidth,h:o.hashMode?1:0,p:r&&r.props?JSON.stringify(r.props):void 0},s=new XMLHttpRequest;s.open("POST",`${o.apiHost}/api/event`,!0),s.setRequestHeader("Content-Type","text/plain"),s.send(JSON.stringify(p)),s.onreadystatechange=()=>{s.readyState===4&&r&&r.callback&&r.callback()}}function b(c){const o=()=>({hashMode:!1,trackLocalhost:!1,url:location.href,domain:location.hostname,referrer:document.referrer||null,deviceWidth:window.innerWidth,apiHost:"https://plausible.io",...c}),r=(t,n,i)=>{v(t,{...o(),...i},n)},h=(t,n)=>{r("pageview",n,t)};return{trackEvent:r,trackPageview:h,enableAutoPageviews:()=>{const t=()=>h(),n=history.pushState;return n&&(history.pushState=function(i,l,u){n.apply(this,[i,l,u]),t()},addEventListener("popstate",t)),c&&c.hashMode&&addEventListener("hashchange",t),h(),function(){n&&(history.pushState=n,removeEventListener("popstate",t)),c&&c.hashMode&&removeEventListener("hashchange",t)}},enableAutoOutboundTracking:(t=document,n={subtree:!0,childList:!0,attributes:!0,attributeFilter:["href"]})=>{function i(e){r("Outbound Link: Click",{props:{url:this.href}}),typeof process<"u"&&process,setTimeout(()=>{location.href=this.href},150),e.preventDefault()}const l=new Set;function u(e){e instanceof HTMLAnchorElement?e.host!==location.host&&(e.addEventListener("click",i),l.add(e)):"querySelectorAll"in e&&e.querySelectorAll("a").forEach(u)}function f(e){e instanceof HTMLAnchorElement?(e.removeEventListener("click",i),l.delete(e)):"querySelectorAll"in e&&e.querySelectorAll("a").forEach(f)}const d=new MutationObserver(e=>{e.forEach(a=>{a.type==="attributes"?(f(a.target),u(a.target)):a.type==="childList"&&(a.addedNodes.forEach(u),a.removedNodes.forEach(f))})});return t.querySelectorAll("a").forEach(u),d.observe(t,n),function(){l.forEach(a=>{a.removeEventListener("click",i)}),l.clear(),d.disconnect()}}}}const g=b({domain:"lantian.pub",trackLocalhost:!0,apiHost:""});g.trackPageview();</script> </footer>  </div>  </body> </html>