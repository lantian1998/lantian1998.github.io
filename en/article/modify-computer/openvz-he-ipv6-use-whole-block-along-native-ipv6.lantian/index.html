<!DOCTYPE html><html lang="en-US" itemscope="" itemtype="https://schema.org/Article" data-astro-cid-porej7z2=""> <head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Configuring Hurricane Electric IPv6 Tunnel on OpenVZ, Enabling the Entire Address Pool and Using it Alongside Native IPv6 - Lan Tian @ Blog</title><script>
  ;(() => {
    try {
      const mode = localStorage.getItem('user-color-scheme')
      if (mode == 'dark' || mode == 'light') {
        document.documentElement.setAttribute('data-user-color-scheme', mode)
      }
    } catch {
      // Ignore errors
    }
  })()
  ;(() => {
    window.lantianImageFallback = (img, src) => {
      img.onerror = null
      img.srcset = src
      img.src = src
      if (img.parentNode.nodeName.toLowerCase() === 'picture') {
        const picture = img.parentNode
        picture.innerHTML = ''
        picture.appendChild(img)
      }
    }
  })()
</script><link rel="stylesheet" href="/assets/index.CN3CN3hr.css"><style>.post-image-wrap[data-astro-cid-potdituc]{margin:0 -5px}.post-image-wrap[data-astro-cid-potdituc] img[data-astro-cid-potdituc]{height:150px;-o-object-fit:cover;object-fit:cover;-o-object-position:center;object-position:center}@media(min-width:768px){.post-image-wrap[data-astro-cid-potdituc]{padding:5px;float:right}.post-image-wrap[data-astro-cid-potdituc] img[data-astro-cid-potdituc]{max-width:200px}}@media(max-width:767.98px){.post-image-wrap[data-astro-cid-potdituc]{text-align:center}.post-image-wrap[data-astro-cid-potdituc] img[data-astro-cid-potdituc]{max-width:100%}}#post-navi[data-astro-cid-gfbmwgei]{padding:5px;border-top:1px solid var(--lt-border-weak);border-bottom:1px solid var(--lt-border-weak)}
</style><link rel="stylesheet" href="/assets/index.DC6W6NZY.css"><script type="module" src="/assets/PageLayout.astro_astro_type_script_index_0_lang.Co1i7321.js"></script><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta http-equiv="Referrer-Policy" content="no-referrer, strict-origin-when-cross-origin"><meta name="renderer" content="webkit|ie-comp|ie-stand"><meta name="imagemode" content="force"><meta name="nightmode" content="disable"><meta name="wap-font-scale" content="no"><meta name="title" content="Configuring Hurricane Electric IPv6 Tunnel on OpenVZ, Enabling the Entire Address Pool and Using it Alongside Native IPv6 - Lan Tian @ Blog"><meta name="keywords" content=""><meta name="author" content="Lan Tian"><link rel="canonical" href="https://lantian.pub/en/article/modify-computer/openvz-he-ipv6-use-whole-block-along-native-ipv6.lantian/"><link rel="alternate" type="application/rss+xml" title="Lan Tian @ Blog" href="https://lantian.pub/rss2.xml"><link rel="alternate" type="application/atom+xml" title="Lan Tian @ Blog" href="https://lantian.pub/feed.xml"><link rel="alternate" href="https://lantian.pub/article/modify-computer/openvz-he-ipv6-use-whole-block-along-native-ipv6.lantian/" hreflang="zh"><link rel="alternate" href="https://lantian.pub/en/article/modify-computer/openvz-he-ipv6-use-whole-block-along-native-ipv6.lantian/" hreflang="en"><meta name="copyright" content="Copyright 2012-2026 Lan Tian @ Blog"><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="48x48" href="/favicon-48x48.png"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="manifest" href="/manifest.webmanifest"><meta name="mobile-web-app-capable" content="yes"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#03a9f4"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#212121"><meta name="application-name" content="Lan Tian @ Blog"><link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="167x167" href="/apple-touch-icon-167x167.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png"><link rel="apple-touch-icon" sizes="1024x1024" href="/apple-touch-icon-1024x1024.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-precomposed.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#03a9f4"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-title" content="Lan Tian @ Blog"><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-640x1136.png"><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-1136x640.png"><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-750x1334.png"><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-1334x750.png"><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1125x2436.png"><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2436x1125.png"><link rel="apple-touch-startup-image" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1170x2532.png"><link rel="apple-touch-startup-image" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2532x1170.png"><link rel="apple-touch-startup-image" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1179x2556.png"><link rel="apple-touch-startup-image" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2556x1179.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-828x1792.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-1792x828.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1242x2688.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2688x1242.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1242x2208.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2208x1242.png"><link rel="apple-touch-startup-image" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1284x2778.png"><link rel="apple-touch-startup-image" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2778x1284.png"><link rel="apple-touch-startup-image" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/apple-touch-startup-image-1290x2796.png"><link rel="apple-touch-startup-image" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/apple-touch-startup-image-2796x1290.png"><link rel="apple-touch-startup-image" media="(device-width: 744px) and (device-height: 1133px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1488x2266.png"><link rel="apple-touch-startup-image" media="(device-width: 744px) and (device-height: 1133px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2266x1488.png"><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1536x2048.png"><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2048x1536.png"><link rel="apple-touch-startup-image" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1620x2160.png"><link rel="apple-touch-startup-image" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2160x1620.png"><link rel="apple-touch-startup-image" media="(device-width: 820px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1640x2160.png"><link rel="apple-touch-startup-image" media="(device-width: 820px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2160x1640.png"><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1668x2388.png"><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2388x1668.png"><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-1668x2224.png"><link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2224x1668.png"><link rel="apple-touch-startup-image" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/apple-touch-startup-image-2048x2732.png"><link rel="apple-touch-startup-image" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/apple-touch-startup-image-2732x2048.png"><meta name="msapplication-TileColor" content="#bbdefb"><meta name="msapplication-TileImage" content="/mstile-144x144.png"><meta name="msapplication-config" content="/browserconfig.xml"><link rel="yandex-tableau-widget" href="/yandex-browser-manifest.json"><meta property="og:url" content="https://lantian.pub/en/article/modify-computer/openvz-he-ipv6-use-whole-block-along-native-ipv6.lantian/"><meta property="og:type" content="website"><meta property="og:title" content="Configuring Hurricane Electric IPv6 Tunnel on OpenVZ, Enabling the Entire Address Pool and Using it Alongside Native IPv6 - Lan Tian @ Blog"><meta property="og:image" content="https://lantian.pub/usr/uploads/2016/08/3015453537.png"><meta content="AlphaRacks is a cost-effective hosting provider, offering VPS with 1 CPU, 512MB RAM, and 10GB storage for just $9.9/year. However, this provider is quite stingy with IPv6 addresses, requiring users to justify their need for IPv6. It's said they provide up to 20 addresses? But they may not allocate the full amount. For example, when I explained I needed IPv6 to serve IPv6-only users, the provider replied: We've added 1 IPv6 address to your VPS. A single IPv6 address is insufficient for my needs. Fortunately, Hurricane Electric in the US offers IPv6 tunneling services , providing each user with 5 tunnels. Each tunnel includes a /64 address pool, and users can instantly activate a /48 address pool with one click. Despite this generous service, using it on OpenVZ VPS requires extra effort...."><meta property="og:site_name" content="Lan Tian @ Blog"><meta property="og:locale" content="en"><meta name="twitter:card" content="summary"><meta name="twitter:url" content="https://lantian.pub/en/article/modify-computer/openvz-he-ipv6-use-whole-block-along-native-ipv6.lantian/"><meta name="twitter:title" content="Configuring Hurricane Electric IPv6 Tunnel on OpenVZ, Enabling the Entire Address Pool and Using it Alongside Native IPv6 - Lan Tian @ Blog"><meta property="twitter:image" content="https://lantian.pub/usr/uploads/2016/08/3015453537.png"><meta content="AlphaRacks is a cost-effective hosting provider, offering VPS with 1 CPU, 512MB RAM, and 10GB storage for just $9.9/year. However, this provider is quite stingy with IPv6 addresses, requiring users to justify their need for IPv6. It's said they provide up to 20 addresses? But they may not allocate the full amount. For example, when I explained I needed IPv6 to serve IPv6-only users, the provider replied: We've added 1 IPv6 address to your VPS. A single IPv6 address is insufficient for my needs. Fortunately, Hurricane Electric in the US offers IPv6 tunneling services , providing each user with 5 tunnels. Each tunnel includes a /64 address pool, and users can instantly activate a /48 address pool with one click. Despite this generous service, using it on OpenVZ VPS requires extra effort...."><meta name="twitter:dnt" content="on"><meta itemprop="name" content="Configuring Hurricane Electric IPv6 Tunnel on OpenVZ, Enabling the Entire Address Pool and Using it Alongside Native IPv6 - Lan Tian @ Blog"><meta property="image" content="https://lantian.pub/usr/uploads/2016/08/3015453537.png"><meta content="AlphaRacks is a cost-effective hosting provider, offering VPS with 1 CPU, 512MB RAM, and 10GB storage for just $9.9/year. However, this provider is quite stingy with IPv6 addresses, requiring users to justify their need for IPv6. It's said they provide up to 20 addresses? But they may not allocate the full amount. For example, when I explained I needed IPv6 to serve IPv6-only users, the provider replied: We've added 1 IPv6 address to your VPS. A single IPv6 address is insufficient for my needs. Fortunately, Hurricane Electric in the US offers IPv6 tunneling services , providing each user with 5 tunnels. Each tunnel includes a /64 address pool, and users can instantly activate a /48 address pool with one click. Despite this generous service, using it on OpenVZ VPS requires extra effort...."><meta content="AlphaRacks is a cost-effective hosting provider, offering VPS with 1 CPU, 512MB RAM, and 10GB storage for just $9.9/year. However, this provider is quite stingy with IPv6 addresses, requiring users to justify their need for IPv6. It's said they provide up to 20 addresses? But they may not allocate the full amount. For example, when I explained I needed IPv6 to serve IPv6-only users, the provider replied: We've added 1 IPv6 address to your VPS. A single IPv6 address is insufficient for my needs. Fortunately, Hurricane Electric in the US offers IPv6 tunneling services , providing each user with 5 tunnels. Each tunnel includes a /64 address pool, and users can instantly activate a /48 address pool with one click. Despite this generous service, using it on OpenVZ VPS requires extra effort...."><link rel="me" href="https://mastodon.social/@lantian"></head> <body data-astro-cid-porej7z2=""> <div id="bg" data-astro-cid-j6vmxtef=""></div>   <div id="container" class="container" data-astro-cid-porej7z2=""> <nav class="lantian navbar navbar-expand-lg" data-astro-cid-wu5dj4rx=""> <div class="container-fluid" data-astro-cid-wu5dj4rx=""> <a class="navbar-brand" href="/en/" data-astro-cid-wu5dj4rx="">Lan Tian @ Blog</a> <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#lantian-navbar" aria-controls="lantian-navbar" aria-expanded="false" aria-label="Toggle navigation" data-astro-cid-wu5dj4rx=""> <span class="navbar-toggler-icon" data-astro-cid-wu5dj4rx=""></span> </button> <div class="collapse navbar-collapse" id="lantian-navbar" data-astro-cid-wu5dj4rx=""> <ul class="navbar-nav" data-astro-cid-wu5dj4rx=""> <li class="nav-item d-none d-lg-block" data-astro-cid-wu5dj4rx=""> <a class="nav-link" href="/en/page/archive/index.html" data-astro-cid-wu5dj4rx=""> Posts </a> </li><li class="nav-item d-none d-lg-block" data-astro-cid-wu5dj4rx=""> <a class="nav-link" href="/en/page/himawari/index.html" data-astro-cid-wu5dj4rx=""> Himawari </a> </li><li class="nav-item d-none d-lg-block" data-astro-cid-wu5dj4rx=""> <a class="nav-link" href="/en/page/dn42/index.html" data-astro-cid-wu5dj4rx=""> DN42 </a> </li> <li class="nav-item dropdown d-block d-lg-none" data-astro-cid-wu5dj4rx=""> <a href="#" class="nav-link dropdown-toggle" id="pages-dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" data-astro-cid-wu5dj4rx=""> <i class="fas fa-fw fa-file" data-astro-cid-wu5dj4rx=""></i> Page  <span class="caret" data-astro-cid-wu5dj4rx=""></span> </a> <ul class="dropdown-menu" aria-labelledby="pages-dropdown" data-astro-cid-wu5dj4rx=""> <li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item" href="/en/page/archive/index.html" data-astro-cid-wu5dj4rx=""> Posts </a> </li><li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item" href="/en/page/himawari/index.html" data-astro-cid-wu5dj4rx=""> Himawari </a> </li><li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item" href="/en/page/dn42/index.html" data-astro-cid-wu5dj4rx=""> DN42 </a> </li> </ul> </li> </ul> <ul class="navbar-nav ms-auto" data-astro-cid-wu5dj4rx=""> <li class="nav-item dropdown" data-astro-cid-wu5dj4rx=""> <a href="#" class="nav-link dropdown-toggle" id="languages-dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" data-astro-cid-wu5dj4rx=""> <i class="fas fa-fw fa-language" data-astro-cid-wu5dj4rx=""></i> Language <span class="caret" data-astro-cid-wu5dj4rx=""></span> </a> <ul class="dropdown-menu" aria-labelledby="languages-dropdown" data-astro-cid-wu5dj4rx=""> <li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item" href="/article/modify-computer/openvz-he-ipv6-use-whole-block-along-native-ipv6.lantian/" data-astro-cid-wu5dj4rx=""> <span class="flag-icon flag-icon-cn" data-astro-cid-wu5dj4rx=""></span> Chinese Simplified / 简体中文 </a> </li><li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item active" href="/en/article/modify-computer/openvz-he-ipv6-use-whole-block-along-native-ipv6.lantian/" data-astro-cid-wu5dj4rx=""> <span class="flag-icon flag-icon-us" data-astro-cid-wu5dj4rx=""></span> English </a> </li> <li data-astro-cid-wu5dj4rx=""><hr class="dropdown-divider" data-astro-cid-wu5dj4rx=""></li> <li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item disabled" href="#" data-astro-cid-wu5dj4rx="">Not all pages have translations.</a> </li> <li data-astro-cid-wu5dj4rx=""> <a class="dropdown-item disabled" href="#" data-astro-cid-wu5dj4rx="">You may see 404 - this is normal.</a> </li> </ul> </li> <li class="nav-item dropdown" data-astro-cid-wu5dj4rx=""> <a href="#" class="nav-link dropdown-toggle" id="color-scheme-dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" data-astro-cid-wu5dj4rx=""> <i class="fas fa-fw fa-adjust" data-astro-cid-wu5dj4rx=""></i> Night Mode </a> <ul class="dropdown-menu" aria-labelledby="color-scheme-dropdown" data-astro-cid-wu5dj4rx=""> <li data-astro-cid-wu5dj4rx=""> <a id="color-scheme-auto" class="dropdown-item" href="#" data-astro-cid-wu5dj4rx=""><i class="fas fa-fw fa-adjust" data-astro-cid-wu5dj4rx=""></i> Auto </a> </li> <li data-astro-cid-wu5dj4rx=""><hr class="dropdown-divider" data-astro-cid-wu5dj4rx=""></li> <li data-astro-cid-wu5dj4rx=""> <a id="color-scheme-light" class="dropdown-item" href="#" data-astro-cid-wu5dj4rx=""><i class="fas fa-fw fa-sun" data-astro-cid-wu5dj4rx=""></i> Light</a> </li> <li data-astro-cid-wu5dj4rx=""> <a id="color-scheme-dark" class="dropdown-item" href="#" data-astro-cid-wu5dj4rx=""><i class="fas fa-fw fa-moon" data-astro-cid-wu5dj4rx=""></i> Dark</a> </li> </ul> </li> </ul> </div> </div> </nav> <script type="module">const m="user-color-scheme",s="data-user-color-scheme",u=(e,t)=>{try{localStorage.setItem(e,t)}catch{}},i=e=>{try{return localStorage.getItem(e)}catch{return null}},c=e=>{const t={dark:!0,light:!0,auto:!0},o=e===null||!Object.keys(t).includes(e)?"auto":e;u(m,o);for(const l in t){const n=document.getElementById("color-scheme-"+l);n&&(l==o?n.classList.add("active"):n.classList.remove("active"))}o!="auto"?document.documentElement.setAttribute(s,o):document.documentElement.removeAttribute(s)};c(i(m));const r=document.getElementById("color-scheme-auto");r&&r.addEventListener("click",()=>c("auto"));const a=document.getElementById("color-scheme-light");a&&a.addEventListener("click",()=>c("light"));const d=document.getElementById("color-scheme-dark");d&&d.addEventListener("click",()=>c("dark"));</script>  <div class="d-flex" data-astro-cid-porej7z2=""> <div id="content" data-astro-cid-porej7z2="">  <article> <div class="d-flex"> <div class="post-info-wrap" data-astro-cid-dckccua4=""> <div class="post-info" data-astro-cid-dckccua4=""> <div class="post-meta-wrap" data-astro-cid-tde7heiu=""> <div class="post-meta" data-astro-cid-tde7heiu=""> <p data-astro-cid-tde7heiu=""> <span class="fas fa-clock" data-astro-cid-tde7heiu=""></span> <br data-astro-cid-tde7heiu=""> <small data-astro-cid-tde7heiu="">08-09</small> </p> <div class="post-meta-value" data-astro-cid-tde7heiu=""> Published on<span class="badge badge-tag" data-astro-cid-dckccua4=""> 2016-08-09 23:19 </span>  </div> </div> </div>   <div class="post-meta-wrap" data-astro-cid-tde7heiu=""> <div class="post-meta" data-astro-cid-tde7heiu=""> <p data-astro-cid-tde7heiu=""> <span class="fas fa-file-alt" data-astro-cid-tde7heiu=""></span> <br data-astro-cid-tde7heiu=""> <small data-astro-cid-tde7heiu="">Computers and Clients</small> </p> <div class="post-meta-value" data-astro-cid-tde7heiu=""> Category <a class="badge badge-tag" href="/en/category/modify-computer" data-astro-cid-dckccua4=""> Computers and Clients </a>  </div> </div> </div>   <div class="post-meta-wrap" data-astro-cid-tde7heiu=""> <div class="post-meta" data-astro-cid-tde7heiu=""> <p data-astro-cid-tde7heiu=""> <span class="fas fa-tag" data-astro-cid-tde7heiu=""></span> <br data-astro-cid-tde7heiu=""> <small data-astro-cid-tde7heiu="">4 tags</small> </p> <div class="post-meta-value" data-astro-cid-tde7heiu=""> Tags  <a class="badge badge-tag" href="/en/tag/OpenVZ" data-astro-cid-dckccua4=""> OpenVZ </a>  <a class="badge badge-tag" href="/en/tag/Hurricane-Electric" data-astro-cid-dckccua4=""> Hurricane Electric </a>  <a class="badge badge-tag" href="/en/tag/IPv6" data-astro-cid-dckccua4=""> IPv6 </a>  <a class="badge badge-tag" href="/en/tag/VPS" data-astro-cid-dckccua4=""> VPS </a>  </div> </div> </div>   <div class="post-meta-wrap" data-astro-cid-tde7heiu=""> <div class="post-meta" data-astro-cid-tde7heiu=""> <p data-astro-cid-tde7heiu=""> <span class="fas fa-list" data-astro-cid-tde7heiu=""></span> <br data-astro-cid-tde7heiu=""> <small data-astro-cid-tde7heiu="">ToC</small> </p> <div class="post-meta-value" data-astro-cid-tde7heiu="">  <ol data-astro-cid-nj3qel45=""> <li class="toc-item toc-level-2" data-astro-cid-nj3qel45=""> <a class="toc-link" href="#enabling-he-tunnel-on-openvz" data-astro-cid-nj3qel45=""> <span class="toc-text" data-astro-cid-nj3qel45="">Enabling HE Tunnel on OpenVZ</span> </a> </li><li class="toc-item toc-level-2" data-astro-cid-nj3qel45=""> <a class="toc-link" href="#enabling-the-entire-address-pool" data-astro-cid-nj3qel45=""> <span class="toc-text" data-astro-cid-nj3qel45="">Enabling the Entire Address Pool</span> </a> </li><li class="toc-item toc-level-2" data-astro-cid-nj3qel45=""> <a class="toc-link" href="#using-native-ipv6-and-tunnel-simultaneously" data-astro-cid-nj3qel45=""> <span class="toc-text" data-astro-cid-nj3qel45="">Using Native IPv6 and Tunnel Simultaneously</span> </a> </li> </ol>   </div> </div> </div>   </div>  </div>  <div class="post-wrap"> <div class="post-image-wrap" data-astro-cid-potdituc=""><picture data-astro-cid-potdituc=""><source srcset="/usr/uploads/2016/08/3015453537.png.thumb.png.webp" type="image/webp" data-astro-cid-potdituc=""><source srcset="/usr/uploads/2016/08/3015453537.png.thumb.png.avif" type="image/avif" data-astro-cid-potdituc=""><source srcset="/usr/uploads/2016/08/3015453537.png.thumb.png.jxl" type="image/jxl" data-astro-cid-potdituc=""><img src="/usr/uploads/2016/08/3015453537.png.thumb.png" alt="Illustration for Configuring Hurricane Electric IPv6 Tunnel on OpenVZ, Enabling the Entire Address Pool and Using it Alongside Native IPv6" height="150" onerror="window.lantianImageFallback(this, '/usr/uploads/2016/08/3015453537.png.thumb.png')" data-astro-cid-potdituc=""></picture></div> <h1 class="post-title"> <a href="/en/article/modify-computer/openvz-he-ipv6-use-whole-block-along-native-ipv6.lantian/" rel="bookmark" title="Configuring Hurricane Electric IPv6 Tunnel on OpenVZ, Enabling the Entire Address Pool and Using it Alongside Native IPv6">Configuring Hurricane Electric IPv6 Tunnel on OpenVZ, Enabling the Entire Address Pool and Using it Alongside Native IPv6</a> </h1> <div class="post-text">   <blockquote> <p>
This post is automatically translated with LLM. The translation content has
    NOT been reviewed and may contain errors.
</p> </blockquote><p>AlphaRacks is a cost-effective hosting provider, offering VPS with 1 CPU, 512MB RAM, and 10GB storage for just $9.9/year. However, this provider is quite stingy with IPv6 addresses, requiring users to justify their need for IPv6. It's said they provide up to 20 addresses? But they may not allocate the full amount. For example, when I explained I needed IPv6 to serve IPv6-only users, the provider replied:</p>
<blockquote>
<p>We've added 1 IPv6 address to your VPS.</p>
</blockquote>
<p>A single IPv6 address is insufficient for my needs. Fortunately, Hurricane Electric in the US offers <a href="https://tunnelbroker.net/" rel="noopener noreferrer" target="_blank">IPv6 tunneling services</a>, providing each user with 5 tunnels. Each tunnel includes a /64 address pool, and users can instantly activate a /48 address pool with one click.</p>
<p>Despite this generous service, using it on OpenVZ VPS requires extra effort. OpenVZ kernels are often version 2.6.32, which lacks native tunnel support. The newer 3.10 kernel that supports this feature has just been released, and many providers haven't updated yet.</p>
<h2 id="enabling-he-tunnel-on-openvz">Enabling HE Tunnel on OpenVZ</h2>
<p>We need a third-party utility that converts Hurricane Electric tunnels into Tun/Tap tunnels (similar to OpenVPN's network adapter in Windows) and configures them on the server. Download and install as follows:</p>
<pre class="shiki shiki-themes dark-plus light-plus" style="--shiki-dark:#D4D4D4;--shiki-light:#000000;--shiki-dark-bg:#1E1E1E;--shiki-light-bg:#FFFFFF" tabindex="0"><code><span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">apt-get</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> install</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> iproute</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> gcc</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">wget</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> http://tb-tun.googlecode.com/files/tb-tun_r18.tar.gz</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">tar</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -xf</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> tb-tun_r18.tar.gz</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">gcc</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> tb_userspace.c</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -l</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> pthread</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -o</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> tb_userspace</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">mv</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> tb_userspace</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /usr/bin/tb_userspace</span></span></code></pre>
<p>Then create <code>/etc/init.d/ipv6tb</code> and input the startup script below (adapted from <a href="https://www.cybermilitia.net/2013/07/22/ipv6-tunnel-on-openvz/" rel="noopener noreferrer" target="_blank">https://www.cybermilitia.net/2013/07/22/ipv6-tunnel-on-openvz/</a>):</p>
<p>(Note: Replace the IP addresses accordingly)</p>
<pre class="shiki shiki-themes dark-plus light-plus" style="--shiki-dark:#D4D4D4;--shiki-light:#000000;--shiki-dark-bg:#1E1E1E;--shiki-light-bg:#FFFFFF" tabindex="0"><code><span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">touch</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /etc/init.d/ipv6tb</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">chmod</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> +x</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /etc/init.d/ipv6tb</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">nano</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /etc/init.d/ipv6tb</span></span></code></pre>
<pre class="shiki shiki-themes dark-plus light-plus" style="--shiki-dark:#D4D4D4;--shiki-light:#000000;--shiki-dark-bg:#1E1E1E;--shiki-light-bg:#FFFFFF" tabindex="0"><code><span class="line"><span style="--shiki-dark:#6A9955;--shiki-light:#008000">#!/bin/sh</span></span>
<span class="line"><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB">case</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$1</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">"</span><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB"> in</span></span>
<span class="line"><span style="--shiki-dark:#D16969;--shiki-light:#811F3F">  start</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">)</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">    echo</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "Starting ipv6tb"</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">      setsid</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /usr/bin/tb_userspace</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> tb</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [HE </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">Tunnel</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Server</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> IPv4</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address]</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">VPS</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> IPv4</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address]</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> sit</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> > </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">/dev/null</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> 2>&#x26;1 &#x26;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">      sleep</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> 1s</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">      ifconfig</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> tb</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> up</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">      ifconfig</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> tb</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> inet6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">HE</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Tunnel</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Client</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> IPv6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address]/128</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">      ifconfig</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> tb</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> inet6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">Assigned</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /64</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Pool]::1/64</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">      ifconfig</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> tb</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> inet6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">Assigned</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /48</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Pool</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> -</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> delete</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> if</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> unavailable]::1/48</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">      ifconfig</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> tb</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> mtu</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 1480</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">      route</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -A</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> inet6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> ::/0</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> dev</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> tb</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">      route</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -A</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> inet6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> del</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> ::/0</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> dev</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> venet0</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">    ;;</span></span>
<span class="line"><span style="--shiki-dark:#D16969;--shiki-light:#811F3F">  stop</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">)</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">    echo</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "Stopping ipv6tb"</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">      ifconfig</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> tb</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> down</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">      route</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -A</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> inet6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> del</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> ::/0</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> dev</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> tb</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">      killall</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> tb_userspace</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">    ;;</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">  *)</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">    echo</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "Usage: /etc/init.d/ipv6tb {start|stop}"</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">    exit</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 1</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">    ;;</span></span>
<span class="line"><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB">esac</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">exit</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 0</span></span></code></pre>
<p>Then execute:</p>
<pre class="shiki shiki-themes dark-plus light-plus" style="--shiki-dark:#D4D4D4;--shiki-light:#000000;--shiki-dark-bg:#1E1E1E;--shiki-light-bg:#FFFFFF" tabindex="0"><code><span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">/etc/init.d/ipv6tb</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> start</span></span></code></pre>
<p>The tunnel will activate. However, you'll notice two issues:</p>
<ol>
<li>Although you have an entire /64 (and possibly /48) pool, only addresses ending with ::1 are usable;</li>
<li>The VPS's native IPv6 stops working as all traffic routes through the tunnel.</li>
</ol>
<p>We'll resolve these step by step.</p>
<h2 id="enabling-the-entire-address-pool">Enabling the Entire Address Pool</h2>
<p>Linux kernel supports an AnyIP feature, allowing you to assign entire address ranges to a network interface without manual configuration.</p>
<p>As an aside, a /64 address pool contains 18,446,744,073,709,551,616 IPs.</p>
<p>Enable it with:</p>
<pre class="shiki shiki-themes dark-plus light-plus" style="--shiki-dark:#D4D4D4;--shiki-light:#000000;--shiki-dark-bg:#1E1E1E;--shiki-light-bg:#FFFFFF" tabindex="0"><code><span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">ip</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> route</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> local</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">Assigned</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /64</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Pool]/64</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> dev</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> lo</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">ip</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> route</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> local</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">Assigned</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /48</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Pool</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> -</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> delete</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> if</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> unavailable]/48</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> dev</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> lo</span></span></code></pre>
<p>After execution, all IPs in your address pool become usable.</p>
<h2 id="using-native-ipv6-and-tunnel-simultaneously">Using Native IPv6 and Tunnel Simultaneously</h2>
<p>When multiple IPv6 connections coexist on a VPS, you'll find only one works at a time. Linux routes response packets through the default interface instead of the originating path.</p>
<p>Fortunately, Linux supports policy-based routing. Configure it as follows:</p>
<ul>
<li>Create routing table and stop existing tunnel:</li>
</ul>
<pre class="shiki shiki-themes dark-plus light-plus" style="--shiki-dark:#D4D4D4;--shiki-light:#000000;--shiki-dark-bg:#1E1E1E;--shiki-light-bg:#FFFFFF" tabindex="0"><code><span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">echo</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 200</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> ipv6tb</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> >> </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">/etc/iproute2/rt_tables</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">/etc/init.d/ipv6tb</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> stop</span></span></code></pre>
<ul>
<li>Replace the contents of <code>/etc/init.d/ipv6tb</code> with the following (modified from <a href="http://itkia.com/ipv6-policy-routing-linux-gotchas/" rel="noopener noreferrer" target="_blank">http://itkia.com/ipv6-policy-routing-linux-gotchas/</a>):</li>
</ul>
<pre class="shiki shiki-themes dark-plus light-plus" style="--shiki-dark:#D4D4D4;--shiki-light:#000000;--shiki-dark-bg:#1E1E1E;--shiki-light-bg:#FFFFFF" tabindex="0"><code><span class="line"><span style="--shiki-dark:#6A9955;--shiki-light:#008000">#! /bin/sh</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">touch</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /var/lock/ipv6tb</span></span>
<span class="line"><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB">case</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "</span><span style="--shiki-dark:#9CDCFE;--shiki-light:#001080">$1</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">"</span><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB"> in</span></span>
<span class="line"><span style="--shiki-dark:#D16969;--shiki-light:#811F3F">    start</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">)</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        setsid</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /usr/bin/tb_userspace</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> tb</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [HE </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">Tunnel</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Server</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> IPv4</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address]</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">VPS</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> IPv4</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address]</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> sit</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> > </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">/dev/null</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> 2>&#x26;1 &#x26;</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        sleep</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> 1s</span></span>
<span class="line"><span style="--shiki-dark:#6A9955;--shiki-light:#008000">        # bring up the tunnel interface &#x26; set mtu</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ifconfig</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> tb</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> up</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ifconfig</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> tb</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> mtu</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 1480</span></span>
<span class="line"><span style="--shiki-dark:#6A9955;--shiki-light:#008000">        # hack: show ip in ifconfig</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ifconfig</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> tb</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> inet6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">HE</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Tunnel</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Client</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> IPv6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address]/128</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ifconfig</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> tb</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> inet6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">Assigned</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /64</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Pool]::1/64</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ifconfig</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> tb</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> inet6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">Assigned</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /48</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Pool</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> -</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> delete</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> if</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> unavailable]::1/48</span></span>
<span class="line"><span style="--shiki-dark:#6A9955;--shiki-light:#008000">        # make use of the whole ipv6 block</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ip</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> route</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> local</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">VPS</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Native</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> IPv6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address]/128</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> dev</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> lo</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ip</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> route</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> local</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">HE</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Tunnel</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Client</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> IPv6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address]/128</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> dev</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> lo</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ip</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> route</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> local</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">Assigned</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /64</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Pool]/64</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> dev</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> lo</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ip</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> route</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> local</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">Assigned</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /48</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Pool</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> -</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> delete</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> if</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> unavailable]/48</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> dev</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> lo</span></span>
<span class="line"><span style="--shiki-dark:#6A9955;--shiki-light:#008000">        # nullroute native ipv6 to prevent sending via wrong interface</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ip</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> route</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> unreachable</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">VPS</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Native</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> IPv6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address]/128</span></span>
<span class="line"><span style="--shiki-dark:#6A9955;--shiki-light:#008000">        # nullroute ipv6 tunnel to prevent sending via wrong interface</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ip</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> route</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> unreachable</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">HE</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Tunnel</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Client</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> IPv6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address]/128</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ip</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> route</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> unreachable</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">Assigned</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /64</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Pool]/64</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ip</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> route</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> unreachable</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">Assigned</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /48</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Pool</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> -</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> delete</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> if</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> unavailable]/48</span></span>
<span class="line"><span style="--shiki-dark:#6A9955;--shiki-light:#008000">        # flush route table &#x26; route the interfaces</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ip</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> route</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> flush</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> table</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> ipv6tb</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ip</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> route</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> 2000::/3</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> dev</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> venet0</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> src</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">VPS</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Native</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> IPv6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address]</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ip</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> route</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> 2000::/3</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> dev</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> tb</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> src</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">HE</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Tunnel</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Client</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> IPv6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address]</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> table</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> ipv6tb</span></span>
<span class="line"><span style="--shiki-dark:#6A9955;--shiki-light:#008000">        # flush rule table</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ip</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> rule</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> flush</span></span>
<span class="line"><span style="--shiki-dark:#6A9955;--shiki-light:#008000">        # restore routing in ipv6 tunnel address block</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ip</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> rule</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> priority</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 200</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> to</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">HE</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Tunnel</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Client</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> IPv6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address]/128</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> table</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> main</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ip</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> rule</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> priority</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 201</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> to</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">Assigned</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /64</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Pool]/64</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> table</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> main</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ip</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> rule</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> priority</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 202</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> to</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">Assigned</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /48</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Pool</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> -</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> delete</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> if</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> unavailable]/48</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> table</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> main</span></span>
<span class="line"><span style="--shiki-dark:#6A9955;--shiki-light:#008000">        # restore routing in native ipv6 address block</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ip</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> rule</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> priority</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 210</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> to</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">VPS</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Native</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> IPv6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address]/128</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> table</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> main</span></span>
<span class="line"><span style="--shiki-dark:#6A9955;--shiki-light:#008000">        # restore routing to reserved ipv6 range</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ip</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> rule</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> priority</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 1000</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> to</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> 2001:db8::/32</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> table</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> main</span></span>
<span class="line"><span style="--shiki-dark:#6A9955;--shiki-light:#008000">        # route packets from tunnel back to the tunnel</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ip</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> rule</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> priority</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 30000</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> from</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">HE</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Tunnel</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Client</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> IPv6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address]/128</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> to</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> 2000::/3</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> table</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> ipv6tb</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ip</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> rule</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> priority</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 30001</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> from</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">Assigned</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /64</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Pool]/64</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> to</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> 2000::/3</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> table</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> ipv6tb</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ip</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> rule</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> priority</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 30002</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> from</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000"> [Your </span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515">Assigned</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> /48</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Address</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> Pool</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> -</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> delete</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> if</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> unavailable]/48</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> to</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> 2000::/3</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> table</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> ipv6tb</span></span>
<span class="line"><span style="--shiki-dark:#6A9955;--shiki-light:#008000">        # restore ipv6 main route &#x26; flush cache</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ip</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> rule</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> priority</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 32766</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> from</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> all</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> table</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> main</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ip</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> route</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> flush</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> cache</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">    ;;</span></span>
<span class="line"><span style="--shiki-dark:#D16969;--shiki-light:#811F3F">    stop</span><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">)</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ifconfig</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> tb</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> down</span></span>
<span class="line"><span style="--shiki-dark:#6A9955;--shiki-light:#008000">        # restore rule table</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ip</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> rule</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> flush</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        ip</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -6</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> rule</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> add</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> priority</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 32766</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> from</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> all</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> table</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> main</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        pkill</span><span style="--shiki-dark:#569CD6;--shiki-light:#0000FF"> -9</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> tb_userspace</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">    ;;</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">    *)</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        echo</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> "Usage: /etc/init.d/ipv6tb {start|stop}"</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">        exit</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 1</span></span>
<span class="line"><span style="--shiki-dark:#D4D4D4;--shiki-light:#000000">        ;;</span></span>
<span class="line"><span style="--shiki-dark:#C586C0;--shiki-light:#AF00DB">esac</span></span>
<span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">exit</span><span style="--shiki-dark:#B5CEA8;--shiki-light:#098658"> 0</span></span></code></pre>
<ul>
<li>Restart the tunnel:</li>
</ul>
<pre class="shiki shiki-themes dark-plus light-plus" style="--shiki-dark:#D4D4D4;--shiki-light:#000000;--shiki-dark-bg:#1E1E1E;--shiki-light-bg:#FFFFFF" tabindex="0"><code><span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">/etc/init.d/ipv6tb</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> start</span></span></code></pre>
<ul>
<li>(Optional) Auto-start on boot: Edit <code>/etc/rc.local</code>, add before <code>exit 0</code>:</li>
</ul>
<pre class="shiki shiki-themes dark-plus light-plus" style="--shiki-dark:#D4D4D4;--shiki-light:#000000;--shiki-dark-bg:#1E1E1E;--shiki-light-bg:#FFFFFF" tabindex="0"><code><span class="line"><span style="--shiki-dark:#DCDCAA;--shiki-light:#795E26">/etc/init.d/ipv6tb</span><span style="--shiki-dark:#CE9178;--shiki-light:#A31515"> start</span></span></code></pre>
<p>After modification, the file should resemble:</p>
<p><picture><source srcset="/usr/uploads/2016/08/3015453537.png.webp" type="image/webp"><source srcset="/usr/uploads/2016/08/3015453537.png.avif" type="image/avif"><source srcset="/usr/uploads/2016/08/3015453537.png.jxl" type="image/jxl"><img src="/usr/uploads/2016/08/3015453537.png" alt="/usr/uploads/2016/08/3015453537.png"></picture></p>
<p>The tunnel will now auto-start. This configuration allows peaceful coexistence between IPv6 tunnel and native IPv6. System operations (e.g., software updates) use native IPv6 instead of the tunnel, significantly improving stability and speed.</p>
<pre><code></code></pre>  </div>  <script type="module" src="/assets/WalineComment.astro_astro_type_script_index_0_lang.Cd-Au78J.js"></script> <div class="clearfix" id="post-navi" data-astro-cid-gfbmwgei=""> <div class="float-end text-end" data-astro-cid-gfbmwgei=""> <a href="/en/article/modify-website/canvas-nest-js-background.lantian/" title="Adding a Cool Web Background with Canvas-Nest.js" data-astro-cid-gfbmwgei=""> Adding a Cool Web Background with Canvas-Nest.js </a> <br data-astro-cid-gfbmwgei=""> Next post »
</div> <div class="float-start text-start position-absolute" data-astro-cid-gfbmwgei="">
« Previous post <br data-astro-cid-gfbmwgei=""> <a href="/en/article/modify-website/ie-firefox-webp-support.lantian/" title="Support WebP on IE and Firefox" data-astro-cid-gfbmwgei=""> Support WebP on IE and Firefox </a> </div> </div>  <div id="waline" data-waline-language="en-US" data-waline-path="/en/article/modify-computer/openvz-he-ipv6-use-whole-block-along-native-ipv6.lantian"></div>   </div> </div> </article>  </div> <aside class="d-none d-xl-block" data-astro-cid-porej7z2=""> <section class="widget"> <h3>Latest posts</h3> <ul class="list-unstyled"> <li> 12-07  <a href="/en/article/modify-website/dn42-flapalerted-reduce-flapping.lantian/">Using FlapAlerted to Suppress flapping in DN42</a> </li><li> 07-20  <a href="/en/article/modify-computer/legal-lte-network-at-home-with-open5gs.lantian/">Legal LTE Network at Home with Open5GS</a> </li><li> 06-27  <a href="/en/article/modify-computer/sidestore-without-stosvpn-across-lan.lantian/">Using SideStore without StosVPN across your LAN</a> </li><li> 05-19  <a href="/en/article/modify-computer/nix-logarithmetic-math-library-from-zero.lantian/">Nix Logarithmic Math Library from Ground Zero</a> </li><li> 04-06  <a href="/en/article/modify-computer/legal-lte-network-at-home-for-100-bucks.lantian/">Legal LTE Network at Home for $100</a> </li><li> 02-10  <a href="/en/article/modify-computer/build-custom-android-kernel-with-nix.lantian/">Building Custom Android Kernel with Nix</a> </li><li> 04-20  <a href="/en/article/modify-website/migrate-blog-to-astro-js.lantian/">Migrating My Blog to Astro.js</a> </li><li> 12-16  <a href="/en/article/modify-computer/nixos-low-ram-vps.lantian/">NixOS Series 5: Creating Disk Image for Low RAM VPS</a> </li><li> 09-20  <a href="/en/article/modify-computer/nix-trigonometric-math-library-from-zero.lantian/">Nix Trigonometric Math Library from Ground Zero</a> </li><li> 05-29  <a href="/en/article/random-notes/pipewire-sigkill-fix.lantian/">Preventing Pipewire from being SIGKILLed</a> </li><li> 05-12  <a href="/en/article/modify-website/how-to-kill-the-dn42-network.lantian/">How to Kill the DN42 Network (Updated 2023-05-12)</a> </li><li> 05-08  <a href="/en/article/modify-computer/laptop-muxed-nvidia-passthrough.lantian/">NVIDIA GPU Passthrough on an Optimus MUXed Laptop (Updated 2023-05)</a> </li><li> 04-17  <a href="/en/article/random-notes/fix-china-telecom-roaming-no-4g-on-aosp-rom.lantian/">Fix China Telecom 4G Roaming on AOSP ROM by Changing APN</a> </li><li> 03-26  <a href="/en/article/random-notes/old-hp-workstation-as-all-in-one.lantian/">Notes on Setting Up NAS+Router on Old HP Workstation</a> </li><li> 01-14  <a href="/en/article/modify-computer/nixos-impermanence.lantian/">NixOS Series 4: &quot;Stateless&quot; Operating System</a> </li> </ul> </section>  <section class="widget"> <h3>Latest comments</h3> <ul class="list-unstyled" id="recent-comments">  <li><a href="#">Loading...</a></li>  </ul> </section>  <script type="module" src="/assets/WalineRecentComments.astro_astro_type_script_index_0_lang.Cu-GBWyK.js"></script> <section class="widget"> <h3>Others</h3> <ul class="list-unstyled">  <li> <i class="fas fa-fw fa-rss"></i>  <a href="/rss2.xml" target="_blank">RSS Feed</a> |  <a href="/feed.xml" target="_blank">Atom</a> |  <a href="/feed.json" target="_blank">JSON</a> </li> <li> <i class="fas fa-fw fa-globe"></i>  <a href="https://stats.uptimerobot.com/NLYPbrSal6" target="_blank"> Sever Status </a> </li> <li> <i class="fas fa-fw fa-sitemap"></i>  <a href="https://lg.lantian.pub" target="_blank">DN42 Looking Glass</a> </li> <li> <i class="fas fa-fw fa-link"></i>  <a href="gopher://lantian.pub" target="_blank">Access with Gopher protocol</a> </li>  </ul> </section>  <section class="widget"> <h3>Links</h3> <ul class="list-unstyled"> <li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://0x7f.cc"> 0x7f Blog 🐑 </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="http://foreverblog.cn"> 10 Year&#39;s Promise (Forever Blog) </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://alanyhq.com"> Alanyhq </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://blog.baoshuo.ren/?utm_source=friends"> Baoshuo&#39;s Blog </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://blog.cas7.moe"> Blog of Moecast </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://jerryxiao.cc"> JerryXiao </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://sangsir.com"> SangSir </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://snli.org"> Shucheng Li </a> </li><li> <i class="fas fa-fw fa-link"></i>  <a target="_blank" href="https://yuetau.net"> YuetAu&#39;s Spot </a> </li> </ul> </section>  </aside> </div> <footer class="clearfix" data-astro-cid-w3csb3e3="">  <div id="copyright" class="float-end text-end" data-astro-cid-w3csb3e3=""> <i class="fas fa-copyright" data-astro-cid-w3csb3e3=""></i> 2012-2026 Lan Tian @ Blog<br data-astro-cid-w3csb3e3=""> <small data-astro-cid-w3csb3e3=""> Powered by Astro v5.17.1 @ 2026-02-12 02:27:10 </small> </div> <script type="module" src="/assets/PlausibleAnalytics.astro_astro_type_script_index_0_lang.C6V0cCkY.js"></script> </footer>  </div>  </body> </html>